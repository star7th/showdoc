import{d as q,r as ee,o as d,c as f,a as i,n as N,u as te,b as A,t as L,e as F,f as U,w as W,g as D,F as P,h as G,i as z,j as X,k as oe,l as I,m as Z,p as de,q as re,v as ge,T as He,s as ie,x as Pe,y as Be,z as le,A as se,B as ne,C as ve,D as Ae,E as _e,G as We,H as be,I as ze,J as Ue}from"./vendor-vue-f1f9849c.js";import{g as ue,c as me,d as fe,u as Fe,a as Ge,b as Re,e as Ye,s as Je,f as Xe,h as Ze,i as Ne,r as Qe}from"./core-31cf74c4.js";import{S as et,V as tt}from"./vendor-8fa27e24.js";const ot={class:"header-left"},nt={key:0,class:"icon"},st={class:"header-right"},at=q({__name:"ModalHeader",props:{icon:{},title:{},useClose:{type:Boolean,default:!0},useLine:{type:Boolean,default:!0}},emits:["close"],setup(n,{emit:c}){const t=n,o=c;return(a,l)=>{const e=ee("a-tooltip");return d(),f("div",{class:N(["modal-header text-default",{"use-line":t.useLine}])},[i("div",ot,[t.icon?(d(),f("div",nt,[i("i",{class:N(te(ue)(t.icon))},null,2)])):A("",!0),t.title?(d(),f("span",{key:1,class:N({marginLeftDefault:!t.icon})},L(t.title),3)):A("",!0),F(a.$slots,"left",{},void 0,!0)]),i("div",st,[F(a.$slots,"right",{},void 0,!0),U(e,{mouseEnterDelay:.3,destroyTooltipOnHide:!0,title:"关闭"},{default:W(()=>[i("div",{class:"icon clickable",onClick:l[0]||(l[0]=r=>o("close"))},[i("i",{class:N(te(ue)(["fas","xmark"]))},null,2)])]),_:1})])],2)}}});const K=(n,c)=>{const t=n.__vccOpts||n;for(const[o,a]of c)t[o]=a;return t},lt=K(at,[["__scopeId","data-v-7fbd3215"]]),it={key:0,class:"header-buttons"},rt={class:"modal-body"},ct={key:0,class:"modal-footer"},ut=q({__name:"CommonModal",props:{show:{type:Boolean,default:!1},icon:{},title:{},useClose:{type:Boolean,default:!0},useLine:{type:Boolean,default:!0},width:{},maxWidth:{},minWidth:{},height:{},headerButtons:{}},emits:["close"],setup(n,{emit:c}){const t=n,o=c,a=D(()=>{const e={};return t.width?e.width=t.width:(t.maxWidth&&(e["--max-width"]=t.maxWidth),t.minWidth&&(e["--min-width"]=t.minWidth)),t.height&&(e.height=t.height),e});function l(e){if(Array.isArray(e)){const r=e[0],$=e[1];return $.startsWith("fa-")?`${r} ${$}`:`${r} fa-${$}`}return e}return(e,r)=>{const $=ee("a-button");return d(),f("div",{class:N(["common-modal",{show:n.show}]),onWheel:r[2]||(r[2]=z(()=>{},["stop"]))},[i("div",{class:"modal-content",onClick:r[1]||(r[1]=z(()=>{},["stop"])),style:X(a.value)},[U(lt,{icon:t.icon,title:t.title,useClose:t.useClose,useLine:t.useLine,onClose:r[0]||(r[0]=C=>o("close"))},{left:W(()=>[F(e.$slots,"left",{},void 0,!0)]),right:W(()=>[n.headerButtons&&n.headerButtons.length>0?(d(),f("div",it,[(d(!0),f(P,null,G(n.headerButtons,(C,h)=>(d(),oe($,{key:h,type:C.type||"default",size:C.size||"small",danger:C.danger,onClick:z(C.onClick,["stop"])},{default:W(()=>[C.icon?(d(),f("i",{key:0,class:N(l(C.icon))},null,2)):A("",!0),C.text?(d(),f("span",{key:1,class:N({"ml-1":C.icon})},L(C.text),3)):A("",!0)]),_:2},1032,["type","size","danger","onClick"]))),128))])):A("",!0),F(e.$slots,"right",{},void 0,!0)]),_:3},8,["icon","title","useClose","useLine"]),i("div",rt,[F(e.$slots,"default",{},void 0,!0)]),e.$slots.footer?(d(),f("div",ct,[F(e.$slots,"footer",{},void 0,!0)])):A("",!0)],4)],34)}}});const Te=K(ut,[["__scopeId","data-v-03b82cdb"]]),dt={class:"my-modal"},mt={class:"modal-content"},ft=["innerHTML"],pt={class:"modal-footer"},ht=q({__name:"index",props:{onClose:{type:Function},msg:{},dangerouslyUseHTMLString:{type:Boolean}},setup(n){const c=n,t=I(!1);Z(()=>{setTimeout(()=>{t.value=!0})});function o(){t.value=!1,setTimeout(()=>{c.onClose()},300)}return(a,l)=>(d(),f("div",dt,[U(Te,{class:N({show:t.value}),title:a.$t("common.tips"),icon:["fas","circle-info"],onClose:o},{default:W(()=>[i("div",mt,[i("div",{class:"text",innerHTML:(n.dangerouslyUseHTMLString,n.msg)},null,8,ft)]),i("div",pt,[i("div",{class:"primary-button",onClick:o},L(a.$t("common.confirm")),1)])]),_:1},8,["class","title"])]))}});const vt=K(ht,[["__scopeId","data-v-da82f992"]]);let $e=!1;function ds(n="",c){return new Promise(t=>{if($e){t();return}$e=!0;const{app:o,mountNode:a}=me(vt,{msg:n,dangerouslyUseHTMLString:c==null?void 0:c.dangerouslyUseHTMLString,onClose:()=>{c!=null&&c.callback&&c.callback(),$e=!1,t(),fe(o,a)}});o.mount(a)})}const gt=q({__name:"CommonTop",props:{visibilityHeight:{default:100},right:{default:40},bottom:{default:40},target:{type:[String,Function],default:()=>window}},setup(n){const c=n,t=I(!1),o=()=>typeof c.target=="function"?c.target():typeof c.target=="string"&&document.querySelector(c.target)||window,a=()=>{const e=o();e===window?window.scrollTo({top:0,behavior:"smooth"}):e.scrollTo({top:0,behavior:"smooth"})},l=()=>{const e=o();let r=0;e===window?r=window.pageYOffset||document.documentElement.scrollTop:r=e.scrollTop,t.value=r>=c.visibilityHeight};return Z(()=>{o().addEventListener("scroll",l)}),de(()=>{o().removeEventListener("scroll",l)}),(e,r)=>(d(),oe(He,{name:"fade-up"},{default:W(()=>[re(i("div",{class:"common-top",style:X({right:`${n.right}px`,bottom:`${n.bottom}px`}),onClick:a},[...r[0]||(r[0]=[i("i",{class:"fas fa-arrow-up"},null,-1)])],4),[[ge,t.value]])]),_:1}))}});const ms=K(gt,[["__scopeId","data-v-16ea6f08"]]),_t=q({__name:"ThemeToggle",setup(n,{expose:c}){const t=Fe(),o=()=>{t.toggleTheme()};return c({appStore:t,handleToggle:o}),(a,l)=>(d(),f("div",{class:"theme-toggle",onClick:o},[F(a.$slots,"default",{},()=>[l[0]||(l[0]=i("i",{class:"fas fa-circle-half-stroke theme-icon"},null,-1))],!0)]))}});const fs=K(_t,[["__scopeId","data-v-315fcfff"]]),yt={class:"language-text"},wt=q({__name:"LanguageToggle",setup(n,{expose:c}){const{locale:t}=ie(),o=D(()=>t.value==="zh-CN"?"中":"EN"),a=()=>{t.value=t.value==="zh-CN"?"en-US":"zh-CN",localStorage.setItem("locale",t.value),document.documentElement.lang=t.value},l=()=>{const e=localStorage.getItem("locale");if(e){t.value=e,document.documentElement.lang=e;return}const r=Ge();t.value=r,localStorage.setItem("locale",t.value),document.documentElement.lang=t.value};return l(),c({locale:t,handleToggle:a,initLanguage:l}),(e,r)=>(d(),f("div",{class:"language-toggle",onClick:a},[F(e.$slots,"default",{},()=>[r[0]||(r[0]=i("i",{class:"fas fa-globe language-icon"},null,-1)),i("span",yt,L(o.value),1)],!0)]))}});const ps=K(wt,[["__scopeId","data-v-1b987677"]]),kt=["value"],bt=q({__name:"CommonInput",props:{modelValue:{}},emits:["update:modelValue"],setup(n,{emit:c}){const t=n,o=c;function a(l){const e=l.target;o("update:modelValue",e.value)}return(l,e)=>(d(),f("input",Pe({class:"common-input",type:"text",value:t.modelValue},l.$attrs,{onInput:a}),null,16,kt))}});const hs=K(bt,[["__scopeId","data-v-e2094272"]]),$t={class:"common-button-text"},Ct={key:1},xt=q({__name:"CommonButton",props:{text:{},theme:{default:"light"},leftIcon:{},rightIcon:{},disabled:{type:Boolean,default:!1},spinning:{type:Boolean,default:!1},bold:{type:Boolean,default:!0},fullWidth:{type:Boolean,default:!1},type:{default:"default"},danger:{type:Boolean,default:!1}},setup(n){const c=n;function t(o){if(Array.isArray(o)){const a=o[0],l=o[1];return l.startsWith("fa-")?`${a} ${l}`:`${a} fa-${l}`}return o}return(o,a)=>{const l=ee("a-spin");return d(),f("div",null,[U(l,{spinning:c.spinning,size:"small",delay:300},{default:W(()=>[i("div",{class:N(["common-button center",[c.theme,{disabled:c.disabled,"full-width":c.fullWidth}]]),style:X({fontWeight:c.bold?"600":"normal"})},[c.leftIcon?(d(),f("i",{key:0,class:N(["icon",t(c.leftIcon)])},null,2)):A("",!0),i("div",$t,[o.$slots.default?F(o.$slots,"default",{key:0},void 0,!0):(d(),f("span",Ct,L(c.text),1))]),c.rightIcon?(d(),f("i",{key:1,class:N(["icon",t(c.rightIcon)])},null,2)):A("",!0)],6)]),_:3},8,["spinning"])])}}});const Ve=K(xt,[["__scopeId","data-v-3b4674b2"]]),Tt={class:"my-modal"},St={class:"modal-content"},Mt={class:"text"},It={class:"modal-footer"},Lt=q({__name:"index",props:{onClose:{type:Function},msg:{},title:{},OkText:{},cancelText:{},maxWidth:{}},setup(n){const{t:c}=ie(),t=n,o=D(()=>t.OkText||c("common.confirm")),a=D(()=>t.cancelText||c("common.cancel")),l=I(!1);Z(()=>{setTimeout(()=>{l.value=!0})});function e(r){l.value=!1,setTimeout(()=>{t.onClose(r)},300)}return(r,$)=>(d(),f("div",Tt,[U(Te,{class:N({show:l.value}),title:t.title||r.$t("common.tips"),icon:["fas","circle-info"],maxWidth:t.maxWidth||"450px",onClose:e},{default:W(()=>[i("div",St,[i("div",Mt,L(n.msg),1)]),i("div",It,[i("div",{class:"secondary-button",onClick:$[0]||($[0]=C=>e(!1))},L(a.value),1),i("div",{class:"primary-button",onClick:$[1]||($[1]=C=>e(!0))},L(o.value),1)])]),_:1},8,["class","title","maxWidth"])]))}});const Et=K(Lt,[["__scopeId","data-v-834cb563"]]);let Ce=!1;function Vt(n,c){let t="",o,a,l;return typeof n=="string"?(t=n,a=c):(t=n.msg,o=n.title,a=n.confirmText,l=n.cancelText),new Promise(e=>{if(Ce){console.warn("[ConfirmModal] 已经有弹窗在显示，忽略新的调用"),e(!1);return}Ce=!0;const{app:r,mountNode:$}=me(Et,{msg:t,title:o,OkText:a,cancelText:l,onClose:(C=!1)=>{Ce=!1,e(C),fe(r,$)}});r.mount($)})}const vs=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),Ht=["innerHTML"],Bt=q({__name:"Index",props:{message:{},timer:{},position:{},onCancel:{type:Function}},setup(n,{expose:c}){const t=n,o=I(!1);let a=null;Z(()=>{setTimeout(()=>{o.value=!0,t.timer&&(a=setTimeout(()=>{l()},t.timer))})});function l(){a&&(clearTimeout(a),a=null),o.value=!1,setTimeout(()=>{var e;(e=t.onCancel)==null||e.call(t)},300)}return c({hide:l}),(e,r)=>(d(),f("div",{class:N(["message",{show:o.value,"message-top":n.position==="top","message-bottom":n.position==="bottom"}]),onClick:l},[i("span",{class:"message-text",innerHTML:n.message},null,8,Ht),i("div",{class:"close-icon",onClick:z(l,["stop"])},[...r[0]||(r[0]=[i("i",{class:"fas fa-xmark"},null,-1)])])],2))}});const At=K(Bt,[["__scopeId","data-v-b88b7dfb"]]);function he(n){return new Promise(c=>{const{app:t,mountNode:o}=me(At,{message:n.message,timer:n.timer??3e3,position:n.position??"top",onCancel:()=>{c(),fe(t,o)}});t.mount(o)})}const gs={success:(n,c,t)=>he({message:n,timer:c,position:t}),error:(n,c,t)=>he({message:n,timer:c,position:t}),info:(n,c,t)=>he({message:n,timer:c,position:t}),show:n=>he(n)},Rt={class:"my-modal"},Nt={class:"modal-content"},jt={class:"input-wrapper"},Dt=["placeholder"],qt={class:"modal-footer"},Ot=q({__name:"index",props:{onClose:{},input:{default:""},title:{default:"请输入"},desc:{default:""},placeholder:{default:"请输入内容"}},setup(n){ie();const c=n,t=I(!1),o=I(""),a=I();Z(()=>{o.value=c.input||"",setTimeout(()=>{t.value=!0,setTimeout(()=>{var e;(e=a.value)==null||e.focus()},100)})});function l(e=""){t.value=!1,setTimeout(()=>{c.onClose(e)},300)}return(e,r)=>(d(),f("div",Rt,[U(Te,{class:N({show:t.value}),title:c.title,icon:["fas","circle-info"],onClose:l},{default:W(()=>[i("div",Nt,[i("div",jt,[re(i("input",{ref_key:"inputRef",ref:a,type:"text","onUpdate:modelValue":r[0]||(r[0]=$=>o.value=$),placeholder:n.placeholder,class:"prompt-input"},null,8,Dt),[[Be,o.value]])])]),i("div",qt,[i("div",{class:"secondary-button",onClick:r[1]||(r[1]=$=>l())},L(e.$t("common.cancel")),1),i("div",{class:"primary-button",onClick:r[2]||(r[2]=$=>l(o.value))},L(e.$t("common.confirm")),1)])]),_:1},8,["class","title"])]))}});const Kt=K(Ot,[["__scopeId","data-v-ba3f4f99"]]);let xe=!1;function _s(n="",c="",t=""){return new Promise(o=>{if(xe){console.warn("[PromptModal] 已经有弹窗在显示，忽略新的调用"),o("");return}xe=!0;const{app:a,mountNode:l}=me(Kt,{title:n,input:c,placeholder:t,onClose:e=>{xe=!1,o(e||""),fe(a,l)}});a.mount(l)})}const Pt={key:0,class:"text-secondary"},Wt={key:0,class:"loading-container"},zt={class:"loading-text"},Ut={key:1,class:"empty-container"},Ft={class:"empty-text"},Gt={key:2,class:"table-container"},Yt={key:0,class:"selection-col"},Jt=["checked","indeterminate"],Xt=["onClick"],Zt=["checked","onChange"],Qt={key:0,class:"tools"},eo=["onClick"],to={key:1,class:"pagination-container"},oo={class:"pagination-info"},no={class:"pagination-controls"},so=["disabled"],ao={class:"pagination-page"},lo=["disabled"],io=q({__name:"CommonTable",props:{tableHeader:{},tableData:{},pagination:{type:[Object,Boolean],default:!1},rowSelection:{type:[Object,Boolean],default:!1},loading:{type:Boolean,default:!1},rowKey:{},rowClickable:{type:Boolean,default:!1},maxHeight:{default:"calc(100vh - 400px)"},typeField:{default:""},typeFieldMapping:{default:()=>({})},emptyText:{},dataSource:{default:"server"}},emits:["rowClick","pageChange","selectionChange"],setup(n,{emit:c}){const{t}=ie(),o=n,a=c,l=D(()=>o.pagination?o.pagination:null),e=D(()=>l.value?Math.ceil(l.value.total/l.value.pageSize):1),r=D(()=>l.value?(l.value.current-1)*l.value.pageSize+1:1),$=D(()=>{if(!l.value)return o.tableData.length;const w=l.value.current*l.value.pageSize;return Math.min(w,l.value.total)}),C=D(()=>typeof o.emptyText=="function"?o.emptyText():o.emptyText||t("common.no_data")),h=D(()=>{if(o.dataSource==="server"||!l.value)return o.tableData;const{current:w,pageSize:T}=l.value,g=(w-1)*T,y=g+T;return o.tableData.slice(g,y)}),_=D(()=>o.rowSelection?o.rowSelection:null),m=D(()=>_.value?_.value.selectedRowKeys||[]:[]),v=D(()=>!_.value||h.value.length===0?!1:h.value.every((w,T)=>b(w,T))),S=D(()=>{if(!_.value)return!1;const w=h.value.filter((T,g)=>b(T,g)).length;return w>0&&w<h.value.length});function B(w,T){return typeof o.rowKey=="function"?o.rowKey(w,T):typeof o.rowKey=="string"?w[o.rowKey]:T}function b(w,T){if(!_.value)return!1;const g=B(w,T);return m.value.includes(g)}function M(w,T,g){if(!_.value)return;const y=g.target.checked,u=B(w,T);let p=[...m.value];y?p.includes(u)||p.push(u):p=p.filter(R=>R!==u);const E=o.tableData.filter((R,j)=>{const O=B(R,j);return p.includes(O)});_.value.onChange&&_.value.onChange(p,E),a("selectionChange",p,E)}function s(w){if(!_.value)return;const T=w.target.checked;let g=[];if(T)g=h.value.map((u,p)=>B(u,p)),g=Array.from(new Set([...m.value,...g]));else{const u=h.value.map((p,E)=>B(p,E));g=m.value.filter(p=>!u.includes(p))}const y=o.tableData.filter((u,p)=>{const E=B(u,p);return g.includes(E)});_.value.onChange&&_.value.onChange(g,y),a("selectionChange",g,y)}function k(w,T){o.rowClickable&&a("rowClick",w,T)}function x(w){l.value&&a("pageChange",w,l.value.pageSize)}return(w,T)=>(d(),f("div",{class:N(["common-table-wrapper",{"with-pagination":n.pagination}])},[w.$slots.renderHeader?(d(),f("header",Pt,[F(w.$slots,"renderHeader",{},void 0,!0)])):A("",!0),i("main",{style:X({maxHeight:n.maxHeight})},[n.loading?(d(),f("div",Wt,[i("div",zt,L(te(t)("common.loading")),1)])):h.value.length===0?(d(),f("div",Ut,[i("div",Ft,L(C.value),1)])):(d(),f("div",Gt,[i("table",null,[i("thead",null,[i("tr",null,[n.rowSelection?(d(),f("th",Yt,[i("input",{type:"checkbox",checked:v.value,indeterminate:S.value,onChange:s},null,40,Jt)])):A("",!0),(d(!0),f(P,null,G(o.tableHeader,(g,y)=>(d(),f("th",{key:y,style:X(g.width?{"min-width":g.width+"px",width:g.width+"px"}:{}),class:N({center:g.center})},L(g.title),7))),128))])]),i("tbody",null,[(d(!0),f(P,null,G(h.value,(g,y)=>(d(),f("tr",{key:B(g,y),class:N({"row-selected":b(g,y),"row-clickable":n.rowClickable}),onClick:u=>k(g,y)},[n.rowSelection?(d(),f("td",{key:0,class:"selection-col",onClick:T[0]||(T[0]=z(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:b(g,y),onChange:u=>M(g,y,u)},null,40,Zt)])):A("",!0),(d(!0),f(P,null,G(o.tableHeader,(u,p)=>(d(),f("td",{key:`${y}-${p}`,style:X(u.width?{"min-width":u.width+"px",width:u.width+"px"}:{}),class:N({center:u.center})},[F(w.$slots,`cell-${u.key}`,{row:g,column:u,index:y,value:g[u.key]},()=>[u.tools?(d(),f("div",Qt,[(d(!0),f(P,null,G(g.tools,(E,R)=>(d(),f("div",{class:"tools-item clickable",key:`${y}-${p}-${R}`,onClick:j=>E.onclick(g)},L(E.name),9,eo))),128))])):(d(),f(P,{key:1},[le(L(g[u.key]),1)],64))],!0)],6))),128))],10,Xt))),128))])])]))],4),n.pagination?(d(),f("div",to,[i("div",oo,L(te(t)("common.pagination_info",{start:r.value,end:$.value,total:n.pagination.total})),1),i("div",no,[i("button",{class:"pagination-btn",disabled:n.pagination.current===1,onClick:T[1]||(T[1]=g=>x(n.pagination.current-1))},L(te(t)("common.prev_page")),9,so),i("span",ao,L(n.pagination.current)+" / "+L(e.value),1),i("button",{class:"pagination-btn",disabled:n.pagination.current>=e.value,onClick:T[2]||(T[2]=g=>x(n.pagination.current+1))},L(te(t)("common.next_page")),9,lo)])])):A("",!0)],2))}});const ys=K(io,[["__scopeId","data-v-cf0b7051"]]),ro=["onClick"],co={class:"line-container"},uo={class:"item-container"},mo=["src"],fo={class:"text"},po={key:0,class:"checked"},ho={key:1,class:"arrow text-default"},vo=q({__name:"Children",props:{show:Boolean,itemRef:Object,scrollOffset:Number,list:Object},emits:["close","mouseenter","mouseleave"],setup(n,{emit:c}){const t=n,o=c,a=I(),l=I(0),e=I(0);function r(){if(!t.itemRef||!a.value)return;const _=t.itemRef.getBoundingClientRect(),m=a.value.clientWidth,v=a.value.clientHeight,S=document.body.clientWidth,B=document.body.clientHeight;let b=_.right,M=_.top;b+m>S-5&&(b=_.left-m),M+v>B-5&&(M=B-v-5),M<5&&(M=5),l.value=M,e.value=b}se(()=>t.show,_=>{_&&ne(()=>{r()})}),se(()=>t.scrollOffset,()=>{t.show&&r()});function $(){o("mouseenter")}function C(){o("mouseleave")}function h(_){_.children||(_.onclick&&_.onclick(),o("close"))}return(_,m)=>t.show?(d(),f("div",{key:0,class:"children-container",ref_key:"contextmenuRef",ref:a,style:X({top:`${l.value}px`,left:`${e.value}px`}),onClick:m[2]||(m[2]=z(()=>{},["stop"])),onMouseenter:$,onMouseleave:C},[(d(!0),f(P,null,G(t.list,(v,S)=>re((d(),f("div",{class:"contextmenu-item bgColor-select",key:S,onClick:B=>h(v),onDblclick:m[0]||(m[0]=z(()=>{},["stop"])),onContextmenu:m[1]||(m[1]=z(()=>{},["stop"]))},[i("div",co,[i("div",uo,[v.img?(d(),f("img",{key:0,class:"img",src:v.img},null,8,mo)):A("",!0),v.icon?(d(),f("div",{key:1,class:"icon",style:X(v.iconStyle)},[i("i",{class:N(te(ue)(v.icon))},null,2)],4)):A("",!0),i("div",fo,L(v.text),1)]),v.checked?(d(),f("div",po,[...m[3]||(m[3]=[i("i",{class:"fas fa-check"},null,-1)])])):A("",!0),v.children&&v.children.length?(d(),f("div",ho,[...m[4]||(m[4]=[i("i",{class:"fas fa-angle-right"},null,-1)])])):A("",!0)])],40,ro)),[[ge,!v.hidden]])),128))],36)):A("",!0)}});const go=K(vo,[["__scopeId","data-v-b32906a2"]]),_o={class:"column"},yo=["onClick","onMouseenter","onMouseleave"],wo={class:"line-container text-default"},ko={class:"item-container"},bo=["src"],$o={key:1,class:"icon"},Co={class:"text"},xo={key:0,class:"shortcut text-secondary"},To={key:1,class:"checked"},So={key:2,class:"arrow text-secondary"},Mo=q({__name:"index",props:{x:Number,y:Number,list:Object,onCancel:Function},setup(n){const c=n,t=I(!1),o=I(),a=I(0),l=I(0),e=I(0),r=I(0),$=new Map,C=I(null);let h=null;function _(y,u){y?$.set(u,y):$.delete(u)}function m(y){h&&(clearTimeout(h),h=null),h=window.setTimeout(()=>{C.value=y},200)}function v(y){h&&(clearTimeout(h),h=null),h=window.setTimeout(()=>{C.value===y&&(C.value=null)},100)}function S(y){h&&(clearTimeout(h),h=null),C.value=y}function B(y){h&&(clearTimeout(h),h=null),h=window.setTimeout(()=>{C.value===y&&(C.value=null)},100)}function b(y){const u=new Set,p=[];return y.forEach(E=>{if(E.shortcut&&!E.children){const R=E.shortcut.toLowerCase().replace(/^ctrl\+|^shift\+|^alt\+/g,"");/^[a-z]$/.test(R)&&u.add(R)}}),y.forEach(E=>{const R={...E};if(E.children&&E.children.length>0){p.push(R);return}if(E.shortcut){p.push(R);return}let j=null;const V=(E.text||"").match(/[a-zA-Z]/);if(V){const H=V[0].toLowerCase();u.has(H)||(j=H,u.add(H))}if(!j)for(let H=0;H<26;H++){const J=String.fromCharCode(97+H);if(!u.has(J)){j=J,u.add(J);break}}j&&(R.shortcut=j),p.push(R)}),p}const M=D(()=>{const u=(c.list||[]).filter(p=>!p.hidden);return b(u)});function s(y){return y.replace(/Ctrl\+/gi,"Ctrl+").replace(/Shift\+/gi,"Shift+").replace(/Alt\+/gi,"Alt+").replace(/Delete/gi,"Del").replace(/Enter/gi,"Enter")}function k(y){const u=y.toLowerCase().split("+").map(O=>O.trim()),p=u[u.length-1],E=u.includes("ctrl"),R=u.includes("shift"),j=u.includes("alt");return O=>{if(/^[a-z]$/.test(p))return O.key.toLowerCase()===p.toLowerCase()?!E&&!R&&!j?!O.ctrlKey&&!O.shiftKey&&!O.altKey&&!O.metaKey:(!E||O.ctrlKey)&&(!R||O.shiftKey)&&(!j||O.altKey):!1;const H=O.key.toLowerCase(),J=p.toLowerCase();let Y=!1;return J==="delete"||J==="del"?Y=H==="delete"||H==="del":Y=H===J,Y&&O.ctrlKey===E&&O.shiftKey===R&&O.altKey===j}}function x(y){if(t.value&&!(y.key==="Control"||y.key==="Shift"||y.key==="Alt"||y.key==="Meta")){for(const u of M.value)if(u.shortcut&&!u.children&&u.onclick&&k(u.shortcut)(y)){y.preventDefault(),y.stopPropagation(),w(u);return}}}Z(()=>{const y=document.body.clientWidth||window.innerWidth,u=document.body.clientHeight||window.innerHeight;let p=c.y||0,E=c.x||0;o.value&&(o.value.clientHeight+p>u-5&&(p=u-o.value.clientHeight-5),o.value.clientWidth+E>y-5&&(E=y-o.value.clientWidth-5),e.value=o.value.clientWidth),a.value=p,l.value=E,setTimeout(()=>{t.value=!0}),document.addEventListener("keydown",x)}),de(()=>{document.removeEventListener("keydown",x),h&&(clearTimeout(h),h=null)});function w(y){y.children||(T(),y.onclick&&y.onclick())}function T(){t.value=!1,setTimeout(()=>{var y;(y=c.onCancel)==null||y.call(c)},100)}function g(y){const u=y.target;r.value=u.scrollTop}return(y,u)=>(d(),f("div",{class:N(["contextmenu-modal",{show:t.value}]),onClick:z(T,["stop"]),onDblclick:z(T,["stop"]),onContextmenu:z(T,["stop"])},[i("div",{class:"container",ref_key:"contextmenuRef",ref:o,style:X({top:`${a.value}px`,left:`${l.value}px`}),onClick:u[2]||(u[2]=z(()=>{},["stop"])),onScroll:g},[i("div",_o,[(d(!0),f(P,null,G(M.value,(p,E)=>re((d(),f("div",{class:"contextmenu-item bgColor-select",key:E,onClick:R=>w(p),onDblclick:u[0]||(u[0]=z(()=>{},["stop"])),onContextmenu:u[1]||(u[1]=z(()=>{},["stop"])),ref_for:!0,ref:R=>_(R,E),onMouseenter:()=>m(E),onMouseleave:()=>v(E)},[i("div",wo,[i("div",ko,[p.img?(d(),f("img",{key:0,class:"img",src:p.img},null,8,bo)):A("",!0),p.icon?(d(),f("div",$o,[i("i",{class:N(te(ue)(p.icon))},null,2)])):A("",!0),i("div",Co,L(p.text),1),p.children&&p.children.length?(d(),oe(ve,{key:2,to:"body"},[U(go,{show:C.value===E,itemRef:te($).get(E),scrollOffset:r.value,list:p.children,onClose:T,onMouseenter:()=>S(E),onMouseleave:()=>B(E)},null,8,["show","itemRef","scrollOffset","list","onMouseenter","onMouseleave"])])):A("",!0)]),p.shortcut&&!p.children?(d(),f("div",xo,L(s(p.shortcut)),1)):A("",!0),p.checked?(d(),f("div",To,[...u[3]||(u[3]=[i("i",{class:"fas fa-check"},null,-1)])])):A("",!0),p.children&&p.children.length?(d(),f("div",So,[...u[4]||(u[4]=[i("i",{class:"fas fa-angle-right"},null,-1)])])):A("",!0)])],40,yo)),[[ge,!p.hidden]])),128))])],36)],34))}});const Io=K(Mo,[["__scopeId","data-v-9867a233"]]);function je({x:n=0,y:c=0,list:t=[]}){const{app:o,mountNode:a}=me(Io,{x:n,y:c,list:t,onCancel:()=>{fe(o,a)}});o.mount(a)}const Lo={class:"common-type-selector"},Eo=q({__name:"CommonSelector",props:{selectorLabel:{},selectorValue:{type:[String,Number,Boolean]},options:{},placeholder:{},value:{type:[String,Number,Boolean,Array]},showSearch:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},searchThreshold:{default:10}},emits:["update:selectorLabel","update:selectorValue","update:value","change"],setup(n,{emit:c}){const t=n,o=c,a=D(()=>{var b;return t.multiple||t.showSearch||(((b=t.options)==null?void 0:b.length)||0)>t.searchThreshold}),l=D(()=>t.options.map(b=>({label:b.label,value:String(b.value),originalValue:b.value}))),e=D(()=>{if(!a.value){if(t.selectorLabel)return t.selectorLabel;const b=t.value!==void 0?t.value:t.selectorValue;if(b!==void 0){const M=m(b);if(M)return M.label}return t.placeholder||"点此选择"}return""}),r=D(()=>(t.multiple,"请选择")),$=D({get:()=>{if(a.value){if(t.value!==void 0)return t.multiple&&Array.isArray(t.value)?t.value.map(b=>C(b)):C(t.value);if(t.selectorValue!==void 0)return C(t.selectorValue)}},set:b=>{if(!a.value)return;const M=h(b);if(o("update:value",M),!t.multiple){const s=m(M);s&&(o("update:selectorLabel",s.label),o("update:selectorValue",s.value))}}});function C(b){return String(b)}function h(b){return Array.isArray(b)?b.map(M=>_(M)):_(b)}function _(b){const M=t.options.find(k=>C(k.value)===b);if(M)return M.value;if(b==="true")return!0;if(b==="false")return!1;const s=Number(b);return!isNaN(s)&&b!==""?s:b}function m(b){const M=C(b);return t.options.find(s=>C(s.value)===M)}function v(b,M){return M.label.toLowerCase().includes(b.toLowerCase())}function S(b){je({x:b.x,y:b.y,list:t.options.map(M=>({text:M.label,onclick:()=>{o("update:selectorLabel",M.label),o("update:selectorValue",M.value),o("update:value",M.value),o("change",M.value,M)}}))})}function B(b,M){const s=h(b);o("change",s,M)}return(b,M)=>{const s=ee("a-select");return d(),f("div",Lo,[a.value?(d(),oe(s,{key:1,value:$.value,"onUpdate:value":M[0]||(M[0]=k=>$.value=k),placeholder:n.placeholder||r.value,"show-search":n.showSearch,mode:n.multiple?"multiple":void 0,options:l.value,"filter-option":v,class:"ant-select-mode",onChange:B},null,8,["value","placeholder","show-search","mode","options"])):(d(),f("div",{key:0,class:"contextmenu-mode text-default clickable center",onClick:S},[le(L(e.value)+"   ",1),M[1]||(M[1]=i("i",{class:"fas fa-angle-down"},null,-1))]))])}}});const ws=K(Eo,[["__scopeId","data-v-22c901a5"]]),Vo={key:0,class:"more-card-header"},Ho={class:"group-bar"},Bo=["onMousedown"],Ao={class:"more-card-item-left"},Ro={class:"more-card-item-icon"},No={class:"more-card-item-right"},jo={class:"right-div"},Do={class:"title"},qo={class:"desc"},Oo=["onMousedown"],Ko={class:"more-card-item-left"},Po={class:"more-card-item-icon"},Wo={class:"more-card-item-right"},zo={class:"right-div"},Uo={class:"title"},Fo={class:"desc"},Go=q({__name:"SDropdown",props:{width:{default:"300px"},title:{default:""},titleIcon:{default:"fas fa-cubes"},placement:{default:"bottomLeft"},menuList:{default:()=>[]},menuListGroup:{default:()=>[]}},setup(n){const c=I(!1),t=o=>{c.value=!1,o.method&&o.method()};return(o,a)=>{const l=ee("a-popover");return d(),oe(l,{open:c.value,"onUpdate:open":a[0]||(a[0]=e=>c.value=e),placement:n.placement,trigger:"hover",overlayStyle:{zIndex:999}},{content:W(()=>[i("div",{class:"more-card",style:X({width:n.width})},[n.title?(d(),f("div",Vo,[i("i",{class:N([n.titleIcon,"mr-3"])},null,2),i("span",null,L(n.title),1)])):A("",!0),n.menuListGroup?(d(!0),f(P,{key:1},G(n.menuListGroup,e=>(d(),f(P,{key:e.group_name},[i("div",Ho,L(e.group_name),1),(d(!0),f(P,null,G(e.listMenu,r=>(d(),f("div",{key:r.title,class:"more-card-item",onMousedown:z($=>t(r),["prevent"])},[i("div",Ao,[i("div",Ro,[i("i",{class:N(r.icon)},null,2)])]),i("div",No,[i("div",jo,[i("div",Do,L(r.title),1),i("div",qo,L(r.desc),1)])])],40,Bo))),128))],64))),128)):A("",!0),n.menuList?(d(!0),f(P,{key:2},G(n.menuList,e=>(d(),f("div",{key:e.title,class:"more-card-item",onMousedown:z(r=>t(e),["prevent"])},[i("div",Ko,[i("div",Po,[i("i",{class:N(e.icon)},null,2)])]),i("div",Wo,[i("div",zo,[i("div",Uo,L(e.title),1),i("div",Fo,L(e.desc),1)])])],40,Oo))),128)):A("",!0)],4)]),default:W(()=>[F(o.$slots,"default",{},void 0,!0)]),_:3},8,["open","placement"])}}});const ks=K(Go,[["__scopeId","data-v-d5568c64"]]),Yo={key:0,class:"common-switch-wrapper"},Jo={key:0,class:"fas fa-toggle-on"},Xo={key:1,class:"fas fa-toggle-off"},Zo={class:"switch-label"},Qo={key:0,class:"fas fa-toggle-on"},en={key:1,class:"fas fa-toggle-off"},tn=q({__name:"CommonSwitch",props:{modelValue:{type:[String,Number,Boolean]},label:{},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(n,{emit:c}){const t=n,o=c,a=D(()=>typeof t.modelValue=="boolean"?t.modelValue:t.modelValue==1);function l(){if(t.disabled)return;let e;typeof t.modelValue=="boolean"?(e=!a.value,o("update:modelValue",e)):typeof t.modelValue=="number"?(e=a.value?0:1,o("update:modelValue",e)):(e=a.value?"0":"1",o("update:modelValue",e)),o("change",e)}return(e,r)=>n.label?(d(),f("div",Yo,[i("div",{class:N(["common-switch text-secondary clickable",{checked:a.value,disabled:n.disabled}]),onClick:l},[a.value?(d(),f("i",Jo)):(d(),f("i",Xo))],2),i("span",Zo,L(n.label),1)])):(d(),f("div",{key:1,class:N(["common-switch text-secondary clickable",{checked:a.value,disabled:n.disabled}]),onClick:l},[a.value?(d(),f("i",Qo)):(d(),f("i",en))],2))}});const bs=K(tn,[["__scopeId","data-v-ae08fb5d"]]),on={class:"dropdown-column"},nn=["onClick"],sn={class:"item-content"},an={key:0,class:"item-icon"},ln={class:"item-text"},$s=q({__name:"CommonDropdownMenu",props:{list:{},trigger:{default:"hover"},placement:{default:"top"},offsetX:{default:0}},emits:["select"],setup(n,{emit:c}){const t=n,o=c,a=I(!1),l=I(null),e=I({top:0,left:0});let r=null,$=!1,C=!1;const h=D(()=>{if(t.placement==="right")return{top:`${e.value.top}px`,left:`${e.value.left}px`,transform:"translateY(-50%)"};let g="-100%";return t.placement==="bottom"&&(g="0"),{top:`${e.value.top}px`,left:`${e.value.left}px`,transform:`translateX(-50%) translateY(${g})`,"--dropdown-translate-y":g}}),_=()=>{if(!l.value)return;const g=l.value.getBoundingClientRect();t.placement==="right"?e.value={top:g.top+g.height/2,left:g.right+8+t.offsetX}:t.placement==="top"?e.value={top:g.top-8,left:g.left+g.width/2+t.offsetX}:e.value={top:g.bottom+8,left:g.left+g.width/2+t.offsetX}},m=()=>{r&&(clearTimeout(r),r=null),_(),a.value=!0},v=()=>{!$&&!C&&(a.value=!1)},S=()=>{r&&clearTimeout(r),r=window.setTimeout(v,100)},B=()=>{t.trigger==="hover"&&($=!0,m())},b=()=>{t.trigger==="hover"&&($=!1,S())},M=()=>{t.trigger==="hover"&&(C=!0,r&&(clearTimeout(r),r=null))},s=()=>{t.trigger==="hover"&&(C=!1,S())},k=()=>{a.value?a.value=!1:(_(),a.value=!0)},x=()=>{a.value=!1},w=g=>{a.value=!1,o("select",g)},T=g=>{if(t.trigger!=="click"||!a.value)return;const y=g.target;!y.closest(".common-dropdown-menu")&&!y.closest(".dropdown-menu-container")&&(a.value=!1)};return Z(()=>{t.trigger==="click"&&document.addEventListener("click",T)}),de(()=>{r&&clearTimeout(r),document.removeEventListener("click",T)}),(g,y)=>(d(),f("div",{ref_key:"containerRef",ref:l,class:"common-dropdown-menu",onMouseenter:B,onMouseleave:b},[i("div",{class:"trigger-button",onClick:y[0]||(y[0]=u=>n.trigger==="click"&&k())},[F(g.$slots,"default",{},()=>[y[1]||(y[1]=i("div",{class:"default-trigger"},[i("i",{class:"fas fa-ellipsis"})],-1))])]),(d(),oe(ve,{to:"body"},[a.value?(d(),f("div",{key:0,class:N(["dropdown-menu-container",`placement-${t.placement}`]),style:X(h.value),onMouseenter:M,onMouseleave:s},[i("div",on,[(d(!0),f(P,null,G(n.list,(u,p)=>(d(),f("div",{class:"dropdown-item",key:p,onClick:E=>w(u)},[i("div",sn,[u.icon?(d(),f("div",an,[i("i",{class:N(te(ue)(u.icon))},null,2)])):A("",!0),i("div",ln,L(u.text),1)])],8,nn))),128))])],38)):A("",!0)])),(d(),oe(ve,{to:"body"},[a.value&&n.trigger==="click"?(d(),f("div",{key:0,class:"dropdown-overlay",onClick:x})):A("",!0)]))],544))}});const rn=["innerHTML"],cn=q({__name:"TextHighlight",props:{queries:{}},setup(n){const c=n,t=Ae(),o=D(()=>{const l=t.default?t.default():"";return Array.isArray(l)&&l.length>0&&l[0].children||""}),a=D(()=>{if(!c.queries||c.queries.length===0)return o.value;let l=o.value;return c.queries.forEach(e=>{if(!e)return;const r=new RegExp(`(${e})`,"gi");l=l.replace(r,"<mark>$1</mark>")}),l});return(l,e)=>(d(),f("span",{innerHTML:a.value},null,8,rn))}});const Cs=K(cn,[["__scopeId","data-v-3c842dc2"]]),un=q({__name:"SortableList",props:{handle:{},animate:{default:100},listClass:{},tag:{default:"div"}},emits:["drag","drop"],setup(n,{emit:c}){const t=n,o=c,a=I(null),l=I(0);let e=null;const r=()=>{var C;if(!a.value)return;const $=t.tag?a.value.querySelector(t.tag):(C=a.value)==null?void 0:C.firstElementChild;$&&(e=et.create($,{handle:t.handle,animation:t.animate,ghostClass:"sortable-ghost",dragClass:"sortable-drag",chosenClass:"sortable-chosen",onStart:()=>{o("drag")},onEnd:h=>{const{newIndex:_,oldIndex:m}=h;o("drop",{oldIndex:m,newIndex:_})}}))};return Z(()=>{ne(()=>{r()})}),se(()=>t.handle,()=>{ne(()=>{e&&e.destroy(),r()})}),se(()=>t.animate,()=>{ne(()=>{e&&e.destroy(),r()})}),se(()=>t.tag,()=>{ne(()=>{e&&e.destroy(),r()})}),_e(()=>{e&&e.destroy()}),($,C)=>(d(),f("div",{class:"sortable-list",ref_key:"wrapper",ref:a},[(d(),f("div",{key:l.value,class:N(n.listClass)},[F($.$slots,"default",{},void 0,!0)],2))],512))}});const xs=K(un,[["__scopeId","data-v-0ddcf022"]]),Ts=q({__name:"Notify",props:{popup:{type:Boolean}},setup(n){const{t:c}=ie(),t=We(),o=Re(),a=n,l=I(a.popup!==void 0?a.popup:!0),e=I(null);let r=I(null);const $=async()=>{try{const v=(await Ye()).data;if(v.remind&&v.remind.id&&(o.setNewMsg(1),l.value)){let S="";if(v.remind.object_type=="vip"){S=c("message.vip_expiring_notice");const s=t.resolve({path:"/user/setting"}).href;h(S,v.remind.from_uid,v.remind.message_content_id,s);return}v.remind.action_type=="comment"||v.remind.action_type=="comment_reply"?S=v.remind.message_content||v.remind.from_name+" "+c("message.publish_comment"):S=v.remind.from_name+" "+c("message.update_the_page")+" "+v.remind.page_data.page_title+" , "+c("message.click_to_view");const b=t.resolve({path:"/message/index",query:{dtab:"remindList"}}).href;h(S,v.remind.from_uid,v.remind.message_content_id,b)}if(v.announce&&v.announce.id&&(o.setNewMsg(1),l.value)){const S=c("message.you_have_unread_announcement"),b=t.resolve({path:"/message/index",query:{dtab:"announcementList"}}).href;h(S,v.announce.from_uid,v.announce.message_content_id,b)}}catch(m){console.error("[Notify] 获取未读消息失败:",m)}},C=(m,v,S,B)=>{const b=v+"_"+S;r.value=b,be.open({message:"ShowDoc "+c("message.notification"),description:m,duration:0,key:b,placement:"topRight",onClick:()=>{window.open(B,"_blank"),be.close(b)},onClose:()=>{_(v,S)}})},h=(m,v,S,B)=>{if(!l.value)return!1;const b="ShowDoc "+c("message.notification"),M={dir:"auto",body:m,requireInteraction:!0,tag:v+"_"+S};if(!("Notification"in window)){console.log("浏览器不支持系统通知，使用 web 弹窗通知"),C(m,v,S,B);return}let s=null;Notification.permission==="granted"?(s=new Notification(b,M),s.onclick=()=>{window.open(B,"_blank"),_(v,S),window.focus(),s.close()}):Notification.permission==="default"?(C(m,v,S,B),Notification.requestPermission().then(k=>{if(k==="granted"){console.log("用户同意授权");const x=v+"_"+S;be.close(x),s=new Notification(b,M),s.onclick=()=>{window.open(B,"_blank"),_(v,S),window.focus(),s.close()}}else k==="default"?console.warn("用户关闭授权 未刷新页面之前 可以再次请求授权"):console.log("用户拒绝授权，继续使用 web 弹窗通知")})):(console.log("用户曾经拒绝显示通知，使用 web 弹窗通知"),C(m,v,S,B))},_=async(m,v)=>{o.setNewMsg(0),setTimeout(async()=>{try{await Je({from_uid:m,message_content_id:v})}catch(S){console.error("设置已读失败:",S)}},2e3)};return Z(()=>{setTimeout(()=>{$()},2e3),e.value=window.setInterval(()=>{$()},60*60*1e3)}),de(()=>{e.value&&clearInterval(e.value)}),(m,v)=>(d(),f("div"))}}),dn={class:"editor-modal-content"},mn=q({__name:"EditorModal",props:{show:{type:Boolean,default:!1},maskClosable:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:c}){const t=n,o=c;se(()=>t.show,l=>{l?document.body.style.overflow="hidden":document.body.style.overflow=""}),_e(()=>{document.body.style.overflow=""});const a=()=>{t.maskClosable&&o("close")};return(l,e)=>(d(),oe(ve,{to:"body"},[U(He,{name:"editor-modal"},{default:W(()=>[n.show?(d(),f("div",{key:0,class:"editor-modal",onWheel:e[0]||(e[0]=z(()=>{},["stop"])),onClick:z(a,["self"])},[i("div",dn,[F(l.$slots,"default",{},void 0,!0)])],32)):A("",!0)]),_:3})]))}});const Ss=K(mn,[["__scopeId","data-v-89a98573"]]),fn={class:"text"},pn=q({__name:"MenuButton",props:{text:{},theme:{default:"light"},list:{},spinning:{type:Boolean,default:!1},leftIcon:{},onClick:{}},setup(n){const c=n;function t(l){if(Array.isArray(l)){const e=l[0],r=l[1];return r.startsWith("fa-")?`${e} ${r}`:`${e} fa-${r}`}return l}function o(l){je({x:l.x,y:l.y,list:c.list})}function a(){c.onClick&&c.onClick()}return(l,e)=>{const r=ee("a-spin");return d(),f("div",null,[U(r,{spinning:c.spinning,size:"small",delay:300},{default:W(()=>[i("div",{class:N(["menu-button center",c.theme])},[i("div",{class:"main-content center clickable bgColor-select",onClick:a},[c.leftIcon?(d(),f("i",{key:0,class:N(t(c.leftIcon))},null,2)):A("",!0),i("div",fn,L(c.text),1)]),i("div",{class:"menu-handle center clickable bgColor-select",onClick:z(o,["stop"])},[...e[0]||(e[0]=[i("i",{class:"icon fas fa-angle-down"},null,-1)])])],2)]),_:1},8,["spinning"])])}}});const Ms=K(pn,[["__scopeId","data-v-88db428d"]]),hn=["id"],vn=q({__name:"index",props:{modelValue:{default:""},id:{default:()=>`editor-md-${Math.random().toString(36).substr(2,9)}`},mode:{default:"editor"},height:{default:"70vh"},taskToggle:{type:Boolean,default:!0},keyword:{default:""},editorPath:{default:""},toolbar:{default:()=>["undo","redo","|","bold","del","italic","quote","|","mindmap","plantuml","mermaid","tasklist","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","center","|","link","reference-link","image","video","code","code-block","table","datetime","html-entities","pagebreak","|","watch","fullscreen","clear","search","|","help"]},features:{default:()=>({})},theme:{default:()=>({})},upload:{default:()=>({})}},emits:["update:modelValue","change","load","task-toggle"],setup(n,{expose:c,emit:t}){const{t:o}=ie(),a=n,l=t;let e=null;const r=I(a.id),$=I(""),C=I(""),h=I(!1),_=new Set,m=s=>new Promise((k,x)=>{if(_.has(s)){k();return}const w=document.createElement("script");w.src=s,w.onload=()=>{_.add(s),k()},w.onerror=()=>{x(new Error(`Failed to load ${s}`))},document.head.appendChild(w)}),v=s=>{if(!s||s.length===0)return"";let k=s;return k=k.replace(/&amp;/g,"&"),k=k.replace(/&lt;/g,"<"),k=k.replace(/&gt;/g,">"),k=k.replace(/&nbsp;/g," "),k=k.replace(/&#39;/g,"'"),k=k.replace(/&quot;/g,'"'),k},S=s=>{const k=document.createElement("a");return k.href=s,{source:s,protocol:k.protocol.replace(":",""),host:k.hostname,hostname:k.hostname,port:k.port,query:k.search,params:(()=>{const x={},w=k.search.replace(/^\?/,"").split("&");for(let T=0;T<w.length;T++)if(w[T]){const g=w[T].split("=");x[g[0]]=g[1]}return x})(),hash:k.hash.replace("#",""),path:k.pathname.replace(/^([^/])/,"/$1"),pathname:k.pathname.replace(/^([^/])/,"/$1")}},B=async()=>{const s=window.$,k=`${$.value}highlight/highlight.min.js?rand=2`;try{await m(k);const x=window.hljs;if(x&&x.highlightAll)try{x.highlightAll(),await new Promise(w=>setTimeout(w,100))}catch{}}catch{}if(s&&s.each)try{s(`#${r.value} table`).each(function(){const x=s(this);x.parent().hasClass("table-wrapper")||x.wrap('<div style="width: 100%; overflow-x: auto;"></div>')})}catch{}if(s&&s(`#${r.value} a[href^="http"]`).click(function(){const w=s(this).attr("href"),T=S(w),g=window.location;return(g.hostname===T.hostname||T.hostname==="www.showdoc.cc")&&g.pathname===T.pathname?(window.location.href=w,T.hash&&window.location.reload()):window.open(w,"_blank"),!1}),s&&s.each)try{s(`#${r.value} table tbody tr`).each(function(){const x=s(this),w=x.find("td"),T=w.eq(1).html()||"",g=w.eq(2).html()||"",y=T==="object"||T==="array[object]"||g==="object"||g==="array[object]";y?x.css({"background-color":"var(--editormd-table-alt-bg)"}):x.css("background-color","var(--editormd-table-row-bg)"),x.off("mouseenter mouseleave").hover(function(){x.css("background-color","var(--editormd-table-alt-bg)")},function(){y?x.css({"background-color":"var(--editormd-table-alt-bg)"}):x.css("background-color","var(--editormd-table-row-bg)")})})}catch{}if(s)try{const x=s(`#${r.value}`).width()||722;s(`#${r.value} table`).each(function(){const w=s(this),T=w.get(0);if(T&&T.rows&&T.rows.length>0){const g=T.rows.item(0);if(g){const y=g.cells.length,u=Math.floor(x/y)-2;y<=5&&w.find("th").css("width",u.toString()+"px")}}})}catch{}if(s){const x=s(`#${r.value}`);x.data("viewer")&&(x.data("viewer").destroy(),x.removeData("viewer"));const w=new tt(x.get(0),{url:"src",title:!1,toolbar:{zoomIn:1,zoomOut:1,oneToOne:1,reset:1,prev:1,play:!1,next:1,rotateLeft:1,rotateRight:1,flipHorizontal:1,flipVertical:1}});x.data("viewer",w)}if(a.keyword&&s&&s.fn&&s.fn.mark)try{const x=s(`#${r.value}`);x.unmark(),x.mark(a.keyword,{separateWordSearch:!0,caseSensitive:!1,accuracy:"partially",ignoreJoiners:!0})}catch{}if(s&&s.fn)try{s(`#${r.value} pre:has(> code)`).each(function(){const w=s(this);w.find(".code-copy-btn").length===0&&s(`<span class="code-copy-btn">${o("common.copy")}</span>`).prependTo(w)}),s(`#${r.value}`).off("click",".code-copy-btn").on("click",".code-copy-btn",function(){const w=s(this),g=w.parent().find("> code").text().trim();navigator.clipboard.writeText(g).then(()=>{w.text(o("common.copy_success")),setTimeout(()=>{w.text(o("common.copy"))},1500)}).catch(()=>{})})}catch{}if((a.mode==="html"||a.mode==="preview")&&s&&s.each){const x=s(`#${r.value}`),w=x.find('input[type="checkbox"]').filter(function(){return s(this).closest("pre, code, .editormd-code-block, .hljs").length===0});x.off("change.tasklist"),a.taskToggle?(w.each(function(T){const g=s(this);g.prop("disabled",!1),g.attr("data-task-index",T.toString())}),x.on("change.tasklist",'input[type="checkbox"]',function(){const T=s(this);if(T.closest("pre, code, .editormd-code-block, .hljs").length>0)return;const g=parseInt(T.attr("data-task-index")||"-1");if(isNaN(g))return;const y=T.is(":checked");l("task-toggle",{index:g,checked:y})})):w.prop("disabled",!0)}},b=async s=>{try{await Promise.all([m(`${s}jquery.min.js`),m(`${s}lib/raphael.min.js`)]),await Promise.all([m(`${s}lib/d3@5.min.js`),m(`${s}lib/flowchart.min.js?v=2`)]),await Promise.all([m(`${s}xss.min.js`),m(`${s}lib/marked.min.js`),m(`${s}lib/underscore.min.js`),m(`${s}lib/sequence-diagram.min.js`),m(`${s}lib/jquery.flowchart.min.js`),m(`${s}lib/jquery.mark.min.js`),m(`${s}lib/plantuml.js?v=2`),m(`${s}lib/view.min.js`),m(`${s}lib/transform.min.js`)]);const k=`${s}editormd.js?v=46`;if(await m(k),!window.editormd)throw new Error("editormd object not found after loading script")}catch(k){throw k}},M=async()=>{try{const s=await Xe();s&&(C.value=s.user_token||"");const k=Ze();$.value=a.editorPath||`${k}editor.md/`,await b($.value);const x=window.editormd;if(!x)return;const w=a.modelValue||"",T=a.mode==="editor"?w:w.replace(/\[TOC\]\s*/gi,""),g={path:`${$.value}lib/`,height:a.height,markdown:T,taskList:!0,atLink:!1,emailLink:!1,tex:!0,flowChart:!0,sequenceDiagram:!0,toc:!1,tocm:!1,tocDropdown:!1,syncScrolling:"single",htmlDecode:"style,script,iframe|filterXSS",imageUpload:!0,imageFormats:["jpg","jpeg","gif","png","bmp","webp","JPG","JPEG","GIF","PNG","BMP","WEBP"],toolbar:a.toolbar,toolbarIcons:()=>a.toolbar,toolbarIconsClass:{toc:"fa-bars ",mindmap:"fa-sitemap ",plantuml:"fa-random ",mermaid:"fa-pie-chart ",video:"fa-file-video-o",center:"fa-align-center",tasklist:"fa-check-square-o"},toolbarHandlers:{video:function(p,E,R,j){p.replaceSelection(`\r
<video src="http://your-site.com/your.mp4" style="width: 100%; height: 100%;" controls="controls"></video>\r
`),j===""&&p.setCursor(R.line,R.ch+1)},tasklist:function(p,E,R,j){const O=`## 任务清单
### 今日
- [ ] 整理站内消息与通知
- [ ] 跟进两条用户反馈
- [x] 合并并审核一个 PR

### 本周
- [ ] 完成文档目录整理与迁移
- [ ] 优化图片加载与懒加载策略

### 待办
- [ ] 编写部署与备份说明
- [ ] 补充接口错误码表
`;p.replaceSelection(O),j===""&&p.setCursor(R.line,R.ch+1)},mindmap:function(p,E,R,j){const O=`\`\`\`mindmap
# 一级
## 二级分支1
### 三级分支1
### 三级分支2
## 二级分支2
### 三级分支3
### 三级分支4
\`\`\``;p.replaceSelection(O),j===""&&p.setCursor(R.line,R.ch+1)},plantuml:function(p,E,R,j){const O="```plantuml\n@startuml\nactor 用户\n用户 -> 系统: 请求\n系统 --> 用户: 响应\n@enduml\n```";p.replaceSelection(O),j===""&&p.setCursor(R.line,R.ch+1)},mermaid:function(p,E,R,j){const O="```mermaid\ngraph LR\n    A[开始] --> B{判断}\n    B -->|是| C[执行]\n    B -->|否| D[结束]\n    C --> D\n```";p.replaceSelection(O),j===""&&p.setCursor(R.line,R.ch+1)},center:function(p,E,R,j){p.replaceSelection("<center>"+j+"</center>"),j===""&&p.setCursor(R.line,R.ch+1)}},lang:{toolbar:{mindmap:"插入思维导图",plantuml:"插入UML图",mermaid:"插入Mermaid图表",video:"插入视频",center:"居中",tasklist:"插入任务列表"}},onchange:()=>{if(e&&e.getMarkdown){const p=e.getMarkdown();l("update:modelValue",p),l("change",p)}B()},previewCodeHighlight:!1,katexURL:{css:"",js:""},onload:()=>{ne(()=>{ne(()=>{B()})})}},y=Ne();if(y.indexOf("?")>-1?g.imageUploadURL=`${y}/api/page/uploadImg&user_token=${C.value}`:g.imageUploadURL=`${y}/api/page/uploadImg?user_token=${C.value}`,g.katexURL={css:`${$.value}katex/katex.min`,js:`${$.value}katex/katex.min`},await ne(),!document.getElementById(r.value)){console.error(`[EditormdEditor] Editor element #${r.value} not found`);return}a.mode==="editor"?(h.value||(await m(`${$.value}lib/mermaid.min.js`),h.value=!0),e=x(r.value,g)):((a.modelValue||"").toLowerCase().indexOf("mermaid")>-1&&!h.value&&(await m(`${$.value}lib/mermaid.min.js`),h.value=!0),e=x.markdownToHTML(r.value,g),setTimeout(()=>{B()},50)),l("load",e)}catch{}};return Z(async()=>{try{await M()}catch{}}),_e(()=>{const s=window.$;if(s&&r.value){const k=s(`#${r.value}`);k.data("viewer")&&(k.data("viewer").destroy(),k.removeData("viewer"))}if(e){try{const k=document.getElementById(r.value);k&&(k.innerHTML="")}catch{}e=null}}),c({getMarkdown:()=>(e==null?void 0:e.getMarkdown())||"",insertValue:s=>{e&&e.insertValue(v(s))},editorUnwatch:()=>{var s;return(s=e==null?void 0:e.unwatch)==null?void 0:s.call(e)},editorWatch:()=>{var s;return(s=e==null?void 0:e.watch)==null?void 0:s.call(e)},setCursorToTop:()=>{var s;return(s=e==null?void 0:e.setCursor)==null?void 0:s.call(e,{line:0,ch:0})},clear:()=>{var s;return(s=e==null?void 0:e.clear)==null?void 0:s.call(e)},getSelection:()=>{var s;return((s=e==null?void 0:e.getSelection)==null?void 0:s.call(e))||""},setCursor:s=>{var k;return(k=e==null?void 0:e.setCursor)==null?void 0:k.call(e,s)},focus:()=>{e!=null&&e.focus?e.focus():e!=null&&e.cm&&e.cm.focus()},blur:()=>{var s;return(s=e==null?void 0:e.blur)==null?void 0:s.call(e)},preview:()=>{var s;return(s=e==null?void 0:e.previewing)==null?void 0:s.call(e)},fullscreen:()=>{var s;return(s=e==null?void 0:e.fullscreen)==null?void 0:s.call(e)},fullscreenExit:()=>{var s;return(s=e==null?void 0:e.fullscreenExit)==null?void 0:s.call(e)},getInstance:()=>e}),(s,k)=>(d(),f("div",{id:r.value,class:"main-editor"},null,8,hn))}});const gn=K(vn,[["__scopeId","data-v-0551e912"]]),_n={syncScroll:!0,toc:!0,autoInsertToc:!0,fullscreen:!0,mermaid:!0,plantuml:!0,mindmap:!0,flowchart:!0,sequenceDiagram:!0,tex:!0,taskList:!0,codeHighlight:!0,imageUpload:!0,video:!0},yn=["undo","redo","|","bold","del","italic","quote","|","toc","mindmap","plantuml","mermaid","tasklist","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","center","|","link","reference-link","image","video","code","code-block","table","datetime","html-entities","pagebreak","|","watch","fullscreen","clear","search","|","help"],wn={class:"editormd-editor-adapter showdoc"},kn={class:"editor-wrapper"},bn=q({__name:"ShowdocAdapter",props:{modelValue:{default:""},id:{default:()=>`editor-md-${Math.random().toString(36).substr(2,9)}`},mode:{default:"editor"},height:{default:"70vh"},taskToggle:{type:Boolean,default:!0},keyword:{default:""},editorPath:{default:""},features:{default:()=>({})},theme:{default:()=>({editor:"light",preview:"light"})},toolbar:{default:()=>yn},upload:{}},emits:["update:modelValue","change","input","load","task-toggle"],setup(n,{expose:c,emit:t}){const o=n,a=t,l=I(),e=I(o.modelValue),r=D(()=>o.id),$=D(()=>({..._n,autoInsertToc:!0,...o.features})),C=D(()=>{const u=document.documentElement.getAttribute("data-theme")==="dark";return{editor:u?"dark":"light",preview:u?"dark":"light",...o.theme}}),h=u=>{a("load",u)},_=u=>{a("update:modelValue",u),a("change",u),a("input",u)},m=u=>{a("task-toggle",u)};return se(()=>o.modelValue,u=>{u!==e.value&&(e.value=u)}),se(()=>document.documentElement.getAttribute("data-theme"),u=>{console.log("Theme changed to:",u==="dark"?"dark":"light")}),c({getValue:()=>{var u;return((u=l.value)==null?void 0:u.getMarkdown())||""},setValue:u=>{var p;(p=l.value)==null||p.setValue(u)},insertValue:u=>{var p;(p=l.value)==null||p.insertValue(u)},getSelection:()=>{var u;return((u=l.value)==null?void 0:u.getSelection())||""},clear:()=>{var u;(u=l.value)==null||u.clear()},setCursor:u=>{var p;(p=l.value)==null||p.setCursor(u)},focus:()=>{var p;const u=(p=l.value)==null?void 0:p.getInstance();u!=null&&u.editor&&u.editor.focus()},blur:()=>{console.log("Editormd blur not implemented")},preview:()=>{var u;return(u=l.value)==null?void 0:u.preview()},unwatch:()=>{var u;return(u=l.value)==null?void 0:u.unwatch()},watch:()=>{var u;return(u=l.value)==null?void 0:u.watch()},getInstance:()=>{var u;return(u=l.value)==null?void 0:u.getInstance()}}),(u,p)=>(d(),f("div",wn,[i("div",kn,[U(gn,{ref_key:"editormdEditorRef",ref:l,modelValue:e.value,"onUpdate:modelValue":p[0]||(p[0]=E=>e.value=E),id:r.value,mode:n.mode,height:n.height,taskToggle:n.taskToggle,keyword:n.keyword,editorPath:n.editorPath,features:$.value,theme:C.value,toolbar:n.toolbar,upload:u.uploadConfig,onLoad:h,onChange:_,onTaskToggle:m},null,8,["modelValue","id","mode","height","taskToggle","keyword","editorPath","features","theme","toolbar","upload"])])]))}});const Is=K(bn,[["__scopeId","data-v-18a0855e"]]),$n=["placeholder","disabled","rows"],Cn=q({__name:"CommonTextarea",props:{modelValue:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},rows:{default:5}},emits:["update:modelValue"],setup(n,{expose:c,emit:t}){const o=n,a=t,l=I("");ze(()=>{l.value=o.modelValue});function e(s){const k=s.target;a("update:modelValue",k.value)}const r=I(!0);function $(){r.value=!0}function C(){r.value=!1}const h=I(!1),_=I("top: 0px; left: 0px;");let m;function v(s){clearTimeout(m),m=setTimeout(()=>{h.value=!0},300)}function S(s){_.value=`top: ${s.offsetY}px; left: ${s.offsetX}px;`}function B(s){clearTimeout(m),h.value=!1}const b=I();function M(){ne(()=>{var k,x;const s=o.modelValue.length;(k=b.value)==null||k.focus(),(x=b.value)==null||x.setSelectionRange(s,s)})}return c({focusAtLast:M}),(s,k)=>(d(),f("div",{class:"common-textarea",style:X({minHeight:`${o.rows*20+26}px`})},[re(i("textarea",{ref_key:"textareaRef",ref:b,placeholder:o.placeholder,disabled:o.disabled,rows:o.rows,onInput:e,onFocus:$,onBlur:C,onMouseenter:v,onMousemove:S,onMouseout:B,"onUpdate:modelValue":k[0]||(k[0]=x=>l.value=x)},null,40,$n),[[Be,l.value]]),re(i("div",{class:"common-textarea-tooltips",style:X(_.value)}," 点击编辑 ",4),[[ge,h.value&&!r.value]])],4))}});const Ls=K(Cn,[["__scopeId","data-v-f5b2d512"]]),xn={class:"tab-header"},Tn={class:"tab-container"},Sn=["onClick"],Mn={class:"tab-content"},In={key:0,class:"tab-icon"},Ln={class:"tab-text"},En={class:"tab-content-wrapper"},Vn=q({__name:"CommonTab",props:{items:{},value:{},type:{default:"segmented"},disabled:{type:Boolean,default:!1}},emits:["updateValue","change"],setup(n,{expose:c,emit:t}){const o=n,a=t,l=D({get:()=>o.value,set:h=>a("updateValue",h)}),e=Ae();D(()=>e.default?Object.keys(e).some(h=>h!=="default"):!1),c({setActive:h=>{a("updateValue",h)}});const $=h=>{o.disabled||h.disabled||(a("updateValue",h.value),a("change",h))};function C(h){if(Array.isArray(h)){const _=h[0],m=h[1];return m.startsWith("fa-")?`${_} ${m}`:`${_} fa-${m}`}return h}return(h,_)=>(d(),f("div",{class:N(["common-tab",[`type-${n.type}`,{disabled:n.disabled}]])},[i("div",xn,[i("div",Tn,[(d(!0),f(P,null,G(n.items,(m,v)=>(d(),f("div",{key:m.value,class:N(["tab-item",{active:l.value===m.value,disabled:m.disabled}]),onClick:S=>$(m)},[i("div",Mn,[m.icon?(d(),f("div",In,[i("i",{class:N(C(m.icon))},null,2)])):A("",!0),i("div",Ln,L(m.text),1)])],10,Sn))),128))])]),i("div",En,[F(h.$slots,"default",{},void 0,!0),(d(!0),f(P,null,G(n.items,m=>(d(),f(P,{key:m.value},[l.value===m.value?F(h.$slots,String(m.value),{key:0},void 0,!0):A("",!0)],64))),128))])],2))}});const Es=K(Vn,[["__scopeId","data-v-4403fa5e"]]),Hn={key:0,class:"toc-container"},Bn={class:"toc-header"},An={class:"toc-content"},Rn=["onClick"],Nn={key:0,class:"toc-empty"},jn={key:1,class:"toc-loading"},Dn=q({__name:"Toc",setup(n){const c=I(!1),t=I(""),o=I([]),a=I(!0),l=()=>{a.value=!0;const h=[".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6",".editormd-preview h1, .editormd-preview h2, .editormd-preview h3, .editormd-preview h4, .editormd-preview h5, .editormd-preview h6",".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6","#page-content-main h1, #page-content-main h2, #page-content-main h3, #page-content-main h4, #page-content-main h5, #page-content-main h6"];let _=null;for(const m of h)if(_=document.querySelectorAll(m),_.length>0)break;if((!_||_.length===0)&&(_=document.querySelectorAll(".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6")),o.value=[],_.forEach(m=>{let v=m.getAttribute("id");v||(v=`heading-${m.tagName.charAt(1)}-${Math.random().toString(36).substr(2,9)}`,m.setAttribute("id",v));const S=m.textContent||"",B=parseInt(m.tagName.charAt(1));v&&S&&o.value.push({id:v,text:S,level:B})}),a.value=!1,o.value.length>0&&(c.value=!0),o.value.length===0){const m=[document.querySelector(".vditor-reset"),document.querySelector(".vditor-preview"),document.querySelector("#page-content-main")];for(const v of m)if(v&&v.innerHTML.trim())break}},e=h=>{const _=document.getElementById(h);if(_){const S=_.getBoundingClientRect().top+window.pageYOffset-120;window.scrollTo({top:S,behavior:"smooth"})}},r=()=>{c.value=!c.value},$=()=>{const h=[".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6",".editormd-preview h1, .editormd-preview h2, .editormd-preview h3, .editormd-preview h4, .editormd-preview h5, .editormd-preview h6",".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6",".vditor-reset h1, .vditor-reset h2, .vditor-reset h3, .vditor-reset h4, .vditor-reset h5, .vditor-reset h6",".vditor-preview h1, .vditor-preview h2, .vditor-preview h3, .vditor-preview h4, .vditor-preview h5, .vditor-preview h6","#page-content-main h1, #page-content-main h2, #page-content-main h3, #page-content-main h4, #page-content-main h5, #page-content-main h6"];let _=null;for(const S of h)if(_=document.querySelectorAll(S),_.length>0)break;(!_||_.length===0)&&(_=document.querySelectorAll(".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6"));const m=window.pageYOffset+150;let v=null;_.forEach(S=>{S.getBoundingClientRect().top+window.pageYOffset<=m&&(v=S)}),v&&(t.value=v.getAttribute("id")||"")};let C=null;return Z(()=>{const h=_=>{setTimeout(()=>{l()},_)};h(500),h(1e3),h(1500),h(2e3),h(3e3),window.addEventListener("scroll",$,{passive:!0}),C=new MutationObserver(()=>{setTimeout(()=>{l()},300)}),setTimeout(()=>{const _=[".editormd-preview-container",".editormd-preview",".markdown-body",".vditor-reset",".vditor-preview","#page-content-main"];let m=null;for(const v of _)if(m=document.querySelector(v),m&&m.innerHTML.trim())break;m&&C?C.observe(m,{childList:!0,subtree:!0}):setTimeout(()=>{for(const v of _)if(m=document.querySelector(v),m&&m.innerHTML.trim())break;m&&C&&C.observe(m,{childList:!0,subtree:!0})},1e3)},500),setTimeout(()=>{const _=[".editormd-preview-container",".editormd-preview",".markdown-body",".vditor-reset",".vditor-preview","#page-content-main"];let m=null;for(const v of _)if(m=document.querySelector(v),m)break;m&&m.querySelectorAll("img").forEach(S=>{const B=S;B.complete?l():B.addEventListener("load",l)})},800)}),_e(()=>{window.removeEventListener("scroll",$),C&&C.disconnect()}),(h,_)=>{const m=ee("a-spin");return o.value.length>0||a.value?(d(),f("div",Hn,[i("div",{class:"toc-toggle",onClick:r},[..._[0]||(_[0]=[i("i",{class:"fas fa-list"},null,-1)])]),i("div",{class:N(["toc-list",{"is-open":c.value}])},[i("div",Bn,[i("span",null,L(h.$t("page.catalog")),1),i("i",{class:"fas fa-times",onClick:r})]),i("div",An,[(d(!0),f(P,null,G(o.value,(v,S)=>(d(),f("div",{key:S,class:N(["toc-item",`toc-level-${v.level}`,{"is-active":t.value===v.id}]),onClick:B=>e(v.id)},[i("span",null,L(v.text),1)],10,Rn))),128)),o.value.length===0&&!a.value?(d(),f("div",Nn,L(h.$t("page.no_catalog")),1)):A("",!0),a.value?(d(),f("div",jn,[U(m,{size:"small"})])):A("",!0)])],2)])):A("",!0)}}});const Vs=K(Dn,[["__scopeId","data-v-dd6166ab"]]),qn={key:0,class:"search-breadcrumb"},On={class:"search-label"},Kn={class:"search-keyword"},Pn=q({__name:"SearchBreadcrumb",props:{keyword:{default:""},pageInfo:{default:()=>({})},itemInfo:{default:()=>({})}},setup(n){return(c,t)=>{const o=ee("router-link"),a=ee("a-breadcrumb-item"),l=ee("a-breadcrumb");return n.keyword?(d(),f("div",qn,[U(l,null,{default:W(()=>[U(a,null,{default:W(()=>{var e,r;return[U(o,{to:`/${((e=n.itemInfo)==null?void 0:e.item_domain)||((r=n.itemInfo)==null?void 0:r.item_id)}`},{default:W(()=>{var $;return[le(L(($=n.itemInfo)==null?void 0:$.item_name),1)]}),_:1},8,["to"])]}),_:1}),U(a,null,{default:W(()=>[i("span",On,L(c.$t("search")),1),i("span",Kn,'"'+L(n.keyword)+'"',1)]),_:1}),n.pageInfo&&n.pageInfo.full_path&&n.pageInfo.full_path.length>0?(d(!0),f(P,{key:0},G(n.pageInfo.full_path,(e,r)=>(d(),oe(a,{key:r},{default:W(()=>[e.cat_name?(d(),f(P,{key:0},[le(L(e.cat_name),1)],64)):e.page_title?(d(),f(P,{key:1},[le(L(e.page_title),1)],64)):A("",!0)]),_:2},1024))),128)):A("",!0),n.pageInfo&&n.pageInfo.page_title&&(!n.pageInfo.full_path||n.pageInfo.full_path.length===0)?(d(),oe(a,{key:1,class:"current-page"},{default:W(()=>[le(L(n.pageInfo.page_title),1)]),_:1})):A("",!0)]),_:1})])):A("",!0)}}});const Hs=K(Pn,[["__scopeId","data-v-f6037437"]]),Wn=["title"],zn={key:1,class:"chat-window"},Un={class:"chat-header"},Fn={class:"header-title"},Gn={class:"header-actions"},Yn=["title"],Jn=["title"],Xn={class:"chat-container"},Zn={class:"message-avatar"},Qn={class:"message-content"},es=["innerHTML"],ts={key:0,class:"message-sources"},os=["onClick"],ns={class:"relevance"},ss={key:0,class:"message assistant"},as={class:"input-area"},ls={class:"input-actions"},is=q({__name:"AiChatDialog",props:{itemId:{},itemName:{default:""}},setup(n,{emit:c}){const t=n,{t:o}=ie(),a=Re(),l=I(!1),e=I(!1),r=I([]),$=I(""),C=I(!1),h=I(null),_=I(null),m=I({dialog_collapsed:!0,welcome_message:""}),v=I(null),S=I(!1),B=D(()=>(t.itemName||o("item.project"))+" - "+o("ai.ai_chat_assistant")),b=D(()=>S.value?100:40),M=()=>{const V=window.pageYOffset||document.documentElement.scrollTop,H=S.value;S.value=V>100,!H&&S.value&&setTimeout(()=>{j()},300)},s=async()=>{try{const V=await Qe("/api/item/getAiKnowledgeBaseConfig",{item_id:t.itemId});V.error_code===0&&V.data?(m.value=V.data,V.data.enabled?(l.value=!0,e.value=!!m.value.dialog_collapsed,e.value||w()):l.value=!1):l.value=!1}catch{l.value=!1}},k=()=>{e.value=!e.value,!e.value&&r.value.length===0&&w(),e.value||setTimeout(()=>{j()},100)},x=()=>{O(),e.value=!0},w=()=>{r.value=[];const V=m.value.welcome_message||o("ai.ai_welcome_message_default");V&&r.value.push({role:"assistant",content:V,sources:[]}),setTimeout(()=>{j()},100)},T=V=>{(V.ctrlKey||V.metaKey)&&V.key==="Enter"&&(V.preventDefault(),g())},g=async()=>{if(!$.value.trim()||C.value)return;const V=$.value.trim();$.value="",r.value.push({role:"user",content:V,sources:[]});const H={role:"assistant",content:"",sources:[]};r.value.push(H),C.value=!0,j();try{await y(V,H)}catch{H.content=o("ai.ai_error_message"),Ue.error(o("ai.ai_error_message"))}finally{C.value=!1,j()}},y=(V,H)=>new Promise(async(J,Y)=>{try{O(),_.value=new AbortController;const ae={item_id:t.itemId,question:V,stream:1};h.value&&(ae.conversation_id=h.value),a.userToken&&(ae.user_token=a.userToken);const ye=Ne()+"/api/ai/chat",ce=await fetch(ye,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"},body:JSON.stringify(ae),signal:_.value.signal});if(!ce.ok)throw new Error(`HTTP ${ce.status}: ${ce.statusText}`);const De=ce.body.getReader(),qe=new TextDecoder("utf-8");let we="";const Se=async()=>{try{const{value:ke,done:Oe}=await De.read();if(Oe){J();return}const Ke=qe.decode(ke,{stream:!0});we+=Ke;const Me=we.split(`

`);we=Me.pop()||"";for(const Ie of Me){if(!Ie.trim())continue;const Le=Ie.match(/^data: (.+)$/m);if(!Le)continue;const Ee=Le[1].trim();if(Ee)try{const Q=JSON.parse(Ee);if(Q.type==="token")H.content+=Q.content||"",j();else if(Q.type==="sources")H.sources=Q.sources||[];else if(Q.type==="done"){Q.conversation_id&&(h.value=Q.conversation_id),J();return}else if(Q.type==="error"){H.content=Q.message||o("ai.ai_error_message"),Y(new Error(Q.message||o("ai.ai_service_error")));return}}catch{}}await Se()}catch(ke){H.content===""&&(H.content=o("ai.ai_error_message")),Y(ke)}};await Se()}catch(ae){H.content===""&&(H.content=o("ai.ai_error_message")),Y(ae)}}),u=V=>V?V.replace(/```(\w*)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/^#\s+(.*)$/gm,"<h1>$1</h1>").replace(/^##\s+(.*)$/gm,"<h2>$1</h2>").replace(/^###\s+(.*)$/gm,"<h3>$1</h3>").replace(/^####\s+(.*)$/gm,"<h4>$1</h4>").replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>").replace(/^######\s+(.*)$/gm,"<h6>$1</h6>").replace(/\n/g,"<br>"):"",p=V=>{if(!V)return"";const H=Math.round(V*5);return"★".repeat(H)+"☆".repeat(5-H)},E=V=>{if(V.page_id&&t.itemId){const H=`/${t.itemId}/${V.page_id}`,J=window.location.origin+H;window.open(J,"_blank")}},R=()=>{r.value=[],h.value=null,w()},j=()=>{setTimeout(()=>{const V=v.value;V&&(V.scrollTop=V.scrollHeight)},100)},O=()=>{_.value&&(_.value.abort(),_.value=null)};return se(()=>t.itemId,V=>{V&&s()}),Z(()=>{t.itemId&&s(),window.addEventListener("scroll",M)}),de(()=>{O(),window.removeEventListener("scroll",M)}),(V,H)=>{const J=ee("a-textarea");return l.value?(d(),f("div",{key:0,class:N(["ai-chat-widget",{collapsed:e.value}]),style:X({bottom:`${b.value}px`})},[e.value?(d(),f("div",{key:0,class:"chat-button",onClick:k,title:V.$t("ai.ai_assistant_tooltip")},[...H[1]||(H[1]=[i("i",{class:"far fa-question-circle"},null,-1)])],8,Wn)):(d(),f("div",zn,[i("div",Un,[i("div",Fn,[H[2]||(H[2]=i("i",{class:"far fa-question-circle"},null,-1)),i("span",null,L(B.value),1)]),i("div",Gn,[i("i",{class:"fas fa-minus",onClick:k,title:V.$t("common.minimize")},null,8,Yn),i("i",{class:"fas fa-times",onClick:x,title:V.$t("common.close")},null,8,Jn)])]),i("div",Xn,[i("div",{class:"messages",ref_key:"messagesContainer",ref:v},[(d(!0),f(P,null,G(r.value,(Y,ae)=>(d(),f("div",{key:ae,class:N(["message",Y.role])},[i("div",Zn,[i("i",{class:N(Y.role==="user"?"fas fa-user":"fas fa-comments")},null,2)]),i("div",Qn,[i("div",{class:"message-text",innerHTML:u(Y.content)},null,8,es),Y.sources&&Y.sources.length>0?(d(),f("div",ts,[(d(!0),f(P,null,G(Y.sources,(pe,ye)=>(d(),f("div",{key:ye,class:"source-item",onClick:ce=>E(pe)},[H[3]||(H[3]=i("i",{class:"fas fa-file-alt"},null,-1)),i("span",null,L(pe.page_title),1),i("span",ns,L(V.$t("ai.ai_relevance"))+": "+L(p(pe.relevance)),1),H[4]||(H[4]=i("i",{class:"fas fa-external-link-alt"},null,-1))],8,os))),128))])):A("",!0)])],2))),128)),C.value?(d(),f("div",ss,[...H[5]||(H[5]=[i("div",{class:"message-avatar"},[i("i",{class:"far fa-question-circle"})],-1),i("div",{class:"message-content"},[i("div",{class:"typing-indicator"},[i("span"),i("span"),i("span")])],-1)])])):A("",!0)],512),i("div",as,[U(J,{value:$.value,"onUpdate:value":H[0]||(H[0]=Y=>$.value=Y),rows:3,placeholder:V.$t("ai.ai_input_placeholder"),onKeydown:T,"auto-size":{minRows:3,maxRows:6}},null,8,["value","placeholder"]),i("div",ls,[U(Ve,{theme:"dark",spinning:C.value,onClick:g,disabled:!$.value.trim()},{default:W(()=>[le(L(V.$t("common.send")),1)]),_:1},8,["spinning","disabled"]),U(Ve,{theme:"light",onClick:R},{default:W(()=>[le(L(V.$t("ai.ai_clear_history")),1)]),_:1})])])])]))],6)):A("",!0)}}});const Bs=K(is,[["__scopeId","data-v-86d35262"]]);export{ds as A,ms as C,Is as E,ps as L,gs as M,_s as P,ks as S,fs as T,K as _,hs as a,Ve as b,Vt as c,Te as d,ys as e,ws as f,bs as g,$s as h,Cs as i,xs as j,Ts as k,Ls as l,Es as m,Ms as n,Ss as o,Vs as p,je as q,Hs as r,Bs as s,vs as t};
