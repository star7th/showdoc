import{d as D,r as ee,o as u,c as m,a as i,n as R,u as te,b as B,t as E,e as F,f as U,w as W,g as j,F as K,h as G,i as z,j as X,k as oe,l as L,m as Z,p as de,q as ie,v as ge,T as He,s as re,x as Pe,y as Be,z as le,A as se,B as ne,C as ve,D as Ae,E as _e,G as We,H as be,I as ze,J as Ue}from"./vendor-vue-f1f9849c.js";import{g as ue,c as me,d as fe,u as Fe,a as Ge,b as Re,e as Ye,s as Je,f as Xe,h as Ze,i as Ne,r as Qe}from"./core-2a040d16.js";import{S as et,V as tt}from"./vendor-8fa27e24.js";const ot={class:"header-left"},nt={key:0,class:"icon"},st={class:"header-right"},at=D({__name:"ModalHeader",props:{icon:{},title:{},useClose:{type:Boolean,default:!0},useLine:{type:Boolean,default:!0}},emits:["close"],setup(s,{emit:c}){const t=s,o=c;return(r,e)=>{const n=ee("a-tooltip");return u(),m("div",{class:R(["modal-header text-default",{"use-line":t.useLine}])},[i("div",ot,[t.icon?(u(),m("div",nt,[i("i",{class:R(te(ue)(t.icon))},null,2)])):B("",!0),t.title?(u(),m("span",{key:1,class:R({marginLeftDefault:!t.icon})},E(t.title),3)):B("",!0),F(r.$slots,"left",{},void 0,!0)]),i("div",st,[F(r.$slots,"right",{},void 0,!0),U(n,{mouseEnterDelay:.3,destroyTooltipOnHide:!0,title:"关闭"},{default:W(()=>[i("div",{class:"icon clickable",onClick:e[0]||(e[0]=d=>o("close"))},[i("i",{class:R(te(ue)(["fas","xmark"]))},null,2)])]),_:1})])],2)}}});const q=(s,c)=>{const t=s.__vccOpts||s;for(const[o,r]of c)t[o]=r;return t},lt=q(at,[["__scopeId","data-v-7fbd3215"]]),it={key:0,class:"header-buttons"},rt={class:"modal-body"},ct={key:0,class:"modal-footer"},ut=D({__name:"CommonModal",props:{show:{type:Boolean,default:!1},icon:{},title:{},useClose:{type:Boolean,default:!0},useLine:{type:Boolean,default:!0},width:{},maxWidth:{},minWidth:{},height:{},headerButtons:{}},emits:["close"],setup(s,{emit:c}){const t=s,o=c,r=j(()=>{const n={};return t.width?n.width=t.width:(t.maxWidth&&(n["--max-width"]=t.maxWidth),t.minWidth&&(n["--min-width"]=t.minWidth)),t.height&&(n.height=t.height),n});function e(n){if(Array.isArray(n)){const d=n[0],C=n[1];return C.startsWith("fa-")?`${d} ${C}`:`${d} fa-${C}`}return n}return(n,d)=>{const C=ee("a-button");return u(),m("div",{class:R(["common-modal",{show:s.show}]),onWheel:d[2]||(d[2]=z(()=>{},["stop"]))},[i("div",{class:"modal-content",onClick:d[1]||(d[1]=z(()=>{},["stop"])),style:X(r.value)},[U(lt,{icon:t.icon,title:t.title,useClose:t.useClose,useLine:t.useLine,onClose:d[0]||(d[0]=b=>o("close"))},{left:W(()=>[F(n.$slots,"left",{},void 0,!0)]),right:W(()=>[s.headerButtons&&s.headerButtons.length>0?(u(),m("div",it,[(u(!0),m(K,null,G(s.headerButtons,(b,v)=>(u(),oe(C,{key:v,type:b.type||"default",size:b.size||"small",danger:b.danger,onClick:z(b.onClick,["stop"])},{default:W(()=>[b.icon?(u(),m("i",{key:0,class:R(e(b.icon))},null,2)):B("",!0),b.text?(u(),m("span",{key:1,class:R({"ml-1":b.icon})},E(b.text),3)):B("",!0)]),_:2},1032,["type","size","danger","onClick"]))),128))])):B("",!0),F(n.$slots,"right",{},void 0,!0)]),_:3},8,["icon","title","useClose","useLine"]),i("div",rt,[F(n.$slots,"default",{},void 0,!0)]),n.$slots.footer?(u(),m("div",ct,[F(n.$slots,"footer",{},void 0,!0)])):B("",!0)],4)],34)}}});const Te=q(ut,[["__scopeId","data-v-03b82cdb"]]),dt={class:"my-modal"},mt={class:"modal-content"},ft=["innerHTML"],ht={class:"modal-footer"},pt=D({__name:"index",props:{onClose:{type:Function},msg:{},dangerouslyUseHTMLString:{type:Boolean}},setup(s){const c=s,t=L(!1);Z(()=>{setTimeout(()=>{t.value=!0})});function o(){t.value=!1,setTimeout(()=>{c.onClose()},300)}return(r,e)=>(u(),m("div",dt,[U(Te,{class:R({show:t.value}),title:r.$t("common.tips"),icon:["fas","circle-info"],onClose:o},{default:W(()=>[i("div",mt,[i("div",{class:"text",innerHTML:(s.dangerouslyUseHTMLString,s.msg)},null,8,ft)]),i("div",ht,[i("div",{class:"primary-button",onClick:o},E(r.$t("common.confirm")),1)])]),_:1},8,["class","title"])]))}});const vt=q(pt,[["__scopeId","data-v-da82f992"]]);let $e=!1;function ds(s="",c){return new Promise(t=>{if($e){t();return}$e=!0;const{app:o,mountNode:r}=me(vt,{msg:s,dangerouslyUseHTMLString:c==null?void 0:c.dangerouslyUseHTMLString,onClose:()=>{c!=null&&c.callback&&c.callback(),$e=!1,t(),fe(o,r)}});o.mount(r)})}const gt=D({__name:"CommonTop",props:{visibilityHeight:{default:100},right:{default:40},bottom:{default:40},target:{type:[String,Function],default:()=>window}},setup(s){const c=s,t=L(!1),o=()=>typeof c.target=="function"?c.target():typeof c.target=="string"&&document.querySelector(c.target)||window,r=()=>{const n=o();n===window?window.scrollTo({top:0,behavior:"smooth"}):n.scrollTo({top:0,behavior:"smooth"})},e=()=>{const n=o();let d=0;n===window?d=window.pageYOffset||document.documentElement.scrollTop:d=n.scrollTop,t.value=d>=c.visibilityHeight};return Z(()=>{o().addEventListener("scroll",e)}),de(()=>{o().removeEventListener("scroll",e)}),(n,d)=>(u(),oe(He,{name:"fade-up"},{default:W(()=>[ie(i("div",{class:"common-top",style:X({right:`${s.right}px`,bottom:`${s.bottom}px`}),onClick:r},[...d[0]||(d[0]=[i("i",{class:"fas fa-arrow-up"},null,-1)])],4),[[ge,t.value]])]),_:1}))}});const ms=q(gt,[["__scopeId","data-v-16ea6f08"]]),_t=D({__name:"ThemeToggle",setup(s,{expose:c}){const t=Fe(),o=()=>{t.toggleTheme()};return c({appStore:t,handleToggle:o}),(r,e)=>(u(),m("div",{class:"theme-toggle",onClick:o},[F(r.$slots,"default",{},()=>[e[0]||(e[0]=i("i",{class:"fas fa-circle-half-stroke theme-icon"},null,-1))],!0)]))}});const fs=q(_t,[["__scopeId","data-v-315fcfff"]]),yt={class:"language-text"},wt=D({__name:"LanguageToggle",setup(s,{expose:c}){const{locale:t}=re(),o=j(()=>t.value==="zh-CN"?"中":"EN"),r=()=>{t.value=t.value==="zh-CN"?"en-US":"zh-CN",localStorage.setItem("locale",t.value),document.documentElement.lang=t.value},e=()=>{const n=localStorage.getItem("locale");if(n){t.value=n,document.documentElement.lang=n;return}const d=Ge();t.value=d,localStorage.setItem("locale",t.value),document.documentElement.lang=t.value};return e(),c({locale:t,handleToggle:r,initLanguage:e}),(n,d)=>(u(),m("div",{class:"language-toggle",onClick:r},[F(n.$slots,"default",{},()=>[d[0]||(d[0]=i("i",{class:"fas fa-globe language-icon"},null,-1)),i("span",yt,E(o.value),1)],!0)]))}});const hs=q(wt,[["__scopeId","data-v-1b987677"]]),kt=["value"],bt=D({__name:"CommonInput",props:{modelValue:{}},emits:["update:modelValue"],setup(s,{emit:c}){const t=s,o=c;function r(e){const n=e.target;o("update:modelValue",n.value)}return(e,n)=>(u(),m("input",Pe({class:"common-input",type:"text",value:t.modelValue},e.$attrs,{onInput:r}),null,16,kt))}});const ps=q(bt,[["__scopeId","data-v-e2094272"]]),$t={class:"common-button-text"},Ct={key:1},xt=D({__name:"CommonButton",props:{text:{},theme:{default:"light"},leftIcon:{},rightIcon:{},disabled:{type:Boolean,default:!1},spinning:{type:Boolean,default:!1},bold:{type:Boolean,default:!0},fullWidth:{type:Boolean,default:!1},type:{default:"default"},danger:{type:Boolean,default:!1}},setup(s){const c=s;function t(o){if(Array.isArray(o)){const r=o[0],e=o[1];return e.startsWith("fa-")?`${r} ${e}`:`${r} fa-${e}`}return o}return(o,r)=>{const e=ee("a-spin");return u(),m("div",null,[U(e,{spinning:c.spinning,size:"small",delay:300},{default:W(()=>[i("div",{class:R(["common-button center",[c.theme,{disabled:c.disabled,"full-width":c.fullWidth}]]),style:X({fontWeight:c.bold?"600":"normal"})},[c.leftIcon?(u(),m("i",{key:0,class:R(["icon",t(c.leftIcon)])},null,2)):B("",!0),i("div",$t,[o.$slots.default?F(o.$slots,"default",{key:0},void 0,!0):(u(),m("span",Ct,E(c.text),1))]),c.rightIcon?(u(),m("i",{key:1,class:R(["icon",t(c.rightIcon)])},null,2)):B("",!0)],6)]),_:3},8,["spinning"])])}}});const Ve=q(xt,[["__scopeId","data-v-3b4674b2"]]),Tt={class:"my-modal"},St={class:"modal-content"},Mt={class:"text"},It={class:"modal-footer"},Lt=D({__name:"index",props:{onClose:{type:Function},msg:{},title:{},OkText:{},cancelText:{},maxWidth:{}},setup(s){const{t:c}=re(),t=s,o=j(()=>t.OkText||c("common.confirm")),r=j(()=>t.cancelText||c("common.cancel")),e=L(!1);Z(()=>{setTimeout(()=>{e.value=!0})});function n(d){e.value=!1,setTimeout(()=>{t.onClose(d)},300)}return(d,C)=>(u(),m("div",Tt,[U(Te,{class:R({show:e.value}),title:t.title||d.$t("common.tips"),icon:["fas","circle-info"],maxWidth:t.maxWidth||"450px",onClose:n},{default:W(()=>[i("div",St,[i("div",Mt,E(s.msg),1)]),i("div",It,[i("div",{class:"secondary-button",onClick:C[0]||(C[0]=b=>n(!1))},E(r.value),1),i("div",{class:"primary-button",onClick:C[1]||(C[1]=b=>n(!0))},E(o.value),1)])]),_:1},8,["class","title","maxWidth"])]))}});const Et=q(Lt,[["__scopeId","data-v-834cb563"]]);let Ce=!1;function Vt(s,c){let t="",o,r,e;return typeof s=="string"?(t=s,r=c):(t=s.msg,o=s.title,r=s.confirmText,e=s.cancelText),new Promise(n=>{if(Ce){console.warn("[ConfirmModal] 已经有弹窗在显示，忽略新的调用"),n(!1);return}Ce=!0;const{app:d,mountNode:C}=me(Et,{msg:t,title:o,OkText:r,cancelText:e,onClose:(b=!1)=>{Ce=!1,n(b),fe(d,C)}});d.mount(C)})}const vs=Object.freeze(Object.defineProperty({__proto__:null,default:Vt},Symbol.toStringTag,{value:"Module"})),Ht=["innerHTML"],Bt=D({__name:"Index",props:{message:{},timer:{},position:{},onCancel:{type:Function}},setup(s,{expose:c}){const t=s,o=L(!1);let r=null;Z(()=>{setTimeout(()=>{o.value=!0,t.timer&&(r=setTimeout(()=>{e()},t.timer))})});function e(){r&&(clearTimeout(r),r=null),o.value=!1,setTimeout(()=>{var n;(n=t.onCancel)==null||n.call(t)},300)}return c({hide:e}),(n,d)=>(u(),m("div",{class:R(["message",{show:o.value,"message-top":s.position==="top","message-bottom":s.position==="bottom"}]),onClick:e},[i("span",{class:"message-text",innerHTML:s.message},null,8,Ht),i("div",{class:"close-icon",onClick:z(e,["stop"])},[...d[0]||(d[0]=[i("i",{class:"fas fa-xmark"},null,-1)])])],2))}});const At=q(Bt,[["__scopeId","data-v-b88b7dfb"]]);function pe(s){return new Promise(c=>{const{app:t,mountNode:o}=me(At,{message:s.message,timer:s.timer??3e3,position:s.position??"top",onCancel:()=>{c(),fe(t,o)}});t.mount(o)})}const gs={success:(s,c,t)=>pe({message:s,timer:c,position:t}),error:(s,c,t)=>pe({message:s,timer:c,position:t}),info:(s,c,t)=>pe({message:s,timer:c,position:t}),show:s=>pe(s)},Rt={class:"my-modal"},Nt={class:"modal-content"},jt={class:"input-wrapper"},Dt=["placeholder"],qt={class:"modal-footer"},Ot=D({__name:"index",props:{onClose:{},input:{default:""},title:{default:"请输入"},desc:{default:""},placeholder:{default:"请输入内容"}},setup(s){re();const c=s,t=L(!1),o=L(""),r=L();Z(()=>{o.value=c.input||"",setTimeout(()=>{t.value=!0,setTimeout(()=>{var n;(n=r.value)==null||n.focus()},100)})});function e(n=""){t.value=!1,setTimeout(()=>{c.onClose(n)},300)}return(n,d)=>(u(),m("div",Rt,[U(Te,{class:R({show:t.value}),title:c.title,icon:["fas","circle-info"],onClose:e},{default:W(()=>[i("div",Nt,[i("div",jt,[ie(i("input",{ref_key:"inputRef",ref:r,type:"text","onUpdate:modelValue":d[0]||(d[0]=C=>o.value=C),placeholder:s.placeholder,class:"prompt-input"},null,8,Dt),[[Be,o.value]])])]),i("div",qt,[i("div",{class:"secondary-button",onClick:d[1]||(d[1]=C=>e())},E(n.$t("common.cancel")),1),i("div",{class:"primary-button",onClick:d[2]||(d[2]=C=>e(o.value))},E(n.$t("common.confirm")),1)])]),_:1},8,["class","title"])]))}});const Kt=q(Ot,[["__scopeId","data-v-ba3f4f99"]]);let xe=!1;function _s(s="",c="",t=""){return new Promise(o=>{if(xe){console.warn("[PromptModal] 已经有弹窗在显示，忽略新的调用"),o("");return}xe=!0;const{app:r,mountNode:e}=me(Kt,{title:s,input:c,placeholder:t,onClose:n=>{xe=!1,o(n||""),fe(r,e)}});r.mount(e)})}const Pt={key:0,class:"text-secondary"},Wt={key:0,class:"loading-container"},zt={class:"loading-text"},Ut={key:1,class:"empty-container"},Ft={class:"empty-text"},Gt={key:2,class:"table-container"},Yt={key:0,class:"selection-col"},Jt=["checked","indeterminate"],Xt=["onClick"],Zt=["checked","onChange"],Qt={key:0,class:"tools"},eo=["onClick"],to={key:1,class:"pagination-container"},oo={class:"pagination-info"},no={class:"pagination-controls"},so=["disabled"],ao={class:"pagination-page"},lo=["disabled"],io=D({__name:"CommonTable",props:{tableHeader:{},tableData:{},pagination:{type:[Object,Boolean],default:!1},rowSelection:{type:[Object,Boolean],default:!1},loading:{type:Boolean,default:!1},rowKey:{},rowClickable:{type:Boolean,default:!1},maxHeight:{default:"calc(100vh - 400px)"},typeField:{default:""},typeFieldMapping:{default:()=>({})},emptyText:{},dataSource:{default:"server"}},emits:["rowClick","pageChange","selectionChange"],setup(s,{emit:c}){const{t}=re(),o=s,r=c,e=j(()=>o.pagination?o.pagination:null),n=j(()=>e.value?Math.ceil(e.value.total/e.value.pageSize):1),d=j(()=>e.value?(e.value.current-1)*e.value.pageSize+1:1),C=j(()=>{if(!e.value)return o.tableData.length;const x=e.value.current*e.value.pageSize;return Math.min(x,e.value.total)}),b=j(()=>typeof o.emptyText=="function"?o.emptyText():o.emptyText||t("common.no_data")),v=j(()=>{if(o.dataSource==="server"||!e.value)return o.tableData;const{current:x,pageSize:T}=e.value,y=(x-1)*T,k=y+T;return o.tableData.slice(y,k)}),h=j(()=>o.rowSelection?o.rowSelection:null),f=j(()=>h.value?h.value.selectedRowKeys||[]:[]),g=j(()=>!h.value||v.value.length===0?!1:v.value.every((x,T)=>$(x,T))),S=j(()=>{if(!h.value)return!1;const x=v.value.filter((T,y)=>$(T,y)).length;return x>0&&x<v.value.length});function A(x,T){return typeof o.rowKey=="function"?o.rowKey(x,T):typeof o.rowKey=="string"?x[o.rowKey]:T}function $(x,T){if(!h.value)return!1;const y=A(x,T);return f.value.includes(y)}function a(x,T,y){if(!h.value)return;const k=y.target.checked,l=A(x,T);let _=[...f.value];k?_.includes(l)||_.push(l):_=_.filter(N=>N!==l);const M=o.tableData.filter((N,O)=>{const P=A(N,O);return _.includes(P)});h.value.onChange&&h.value.onChange(_,M),r("selectionChange",_,M)}function p(x){if(!h.value)return;const T=x.target.checked;let y=[];if(T)y=v.value.map((l,_)=>A(l,_)),y=Array.from(new Set([...f.value,...y]));else{const l=v.value.map((_,M)=>A(_,M));y=f.value.filter(_=>!l.includes(_))}const k=o.tableData.filter((l,_)=>{const M=A(l,_);return y.includes(M)});h.value.onChange&&h.value.onChange(y,k),r("selectionChange",y,k)}function w(x,T){o.rowClickable&&r("rowClick",x,T)}function I(x){e.value&&r("pageChange",x,e.value.pageSize)}return(x,T)=>(u(),m("div",{class:R(["common-table-wrapper",{"with-pagination":s.pagination}])},[x.$slots.renderHeader?(u(),m("header",Pt,[F(x.$slots,"renderHeader",{},void 0,!0)])):B("",!0),i("main",{style:X({maxHeight:s.maxHeight})},[s.loading?(u(),m("div",Wt,[i("div",zt,E(te(t)("common.loading")),1)])):v.value.length===0?(u(),m("div",Ut,[i("div",Ft,E(b.value),1)])):(u(),m("div",Gt,[i("table",null,[i("thead",null,[i("tr",null,[s.rowSelection?(u(),m("th",Yt,[i("input",{type:"checkbox",checked:g.value,indeterminate:S.value,onChange:p},null,40,Jt)])):B("",!0),(u(!0),m(K,null,G(o.tableHeader,(y,k)=>(u(),m("th",{key:k,style:X(y.width?{"min-width":y.width+"px",width:y.width+"px"}:{}),class:R({center:y.center})},E(y.title),7))),128))])]),i("tbody",null,[(u(!0),m(K,null,G(v.value,(y,k)=>(u(),m("tr",{key:A(y,k),class:R({"row-selected":$(y,k),"row-clickable":s.rowClickable}),onClick:l=>w(y,k)},[s.rowSelection?(u(),m("td",{key:0,class:"selection-col",onClick:T[0]||(T[0]=z(()=>{},["stop"]))},[i("input",{type:"checkbox",checked:$(y,k),onChange:l=>a(y,k,l)},null,40,Zt)])):B("",!0),(u(!0),m(K,null,G(o.tableHeader,(l,_)=>(u(),m("td",{key:`${k}-${_}`,style:X(l.width?{"min-width":l.width+"px",width:l.width+"px"}:{}),class:R({center:l.center})},[F(x.$slots,`cell-${l.key}`,{row:y,column:l,index:k,value:y[l.key]},()=>[l.tools?(u(),m("div",Qt,[(u(!0),m(K,null,G(y.tools,(M,N)=>(u(),m("div",{class:"tools-item clickable",key:`${k}-${_}-${N}`,onClick:O=>M.onclick(y)},E(M.name),9,eo))),128))])):(u(),m(K,{key:1},[le(E(y[l.key]),1)],64))],!0)],6))),128))],10,Xt))),128))])])]))],4),s.pagination?(u(),m("div",to,[i("div",oo,E(te(t)("common.pagination_info",{start:d.value,end:C.value,total:s.pagination.total})),1),i("div",no,[i("button",{class:"pagination-btn",disabled:s.pagination.current===1,onClick:T[1]||(T[1]=y=>I(s.pagination.current-1))},E(te(t)("common.prev_page")),9,so),i("span",ao,E(s.pagination.current)+" / "+E(n.value),1),i("button",{class:"pagination-btn",disabled:s.pagination.current>=n.value,onClick:T[2]||(T[2]=y=>I(s.pagination.current+1))},E(te(t)("common.next_page")),9,lo)])])):B("",!0)],2))}});const ys=q(io,[["__scopeId","data-v-cf0b7051"]]),ro=["onClick"],co={class:"line-container"},uo={class:"item-container"},mo=["src"],fo={class:"text"},ho={key:0,class:"checked"},po={key:1,class:"arrow text-default"},vo=D({__name:"Children",props:{show:Boolean,itemRef:Object,scrollOffset:Number,list:Object},emits:["close","mouseenter","mouseleave"],setup(s,{emit:c}){const t=s,o=c,r=L(),e=L(0),n=L(0);function d(){if(!t.itemRef||!r.value)return;const h=t.itemRef.getBoundingClientRect(),f=r.value.clientWidth,g=r.value.clientHeight,S=document.body.clientWidth,A=document.body.clientHeight;let $=h.right,a=h.top;$+f>S-5&&($=h.left-f),a+g>A-5&&(a=A-g-5),a<5&&(a=5),e.value=a,n.value=$}se(()=>t.show,h=>{h&&ne(()=>{d()})}),se(()=>t.scrollOffset,()=>{t.show&&d()});function C(){o("mouseenter")}function b(){o("mouseleave")}function v(h){h.children||(h.onclick&&h.onclick(),o("close"))}return(h,f)=>t.show?(u(),m("div",{key:0,class:"children-container",ref_key:"contextmenuRef",ref:r,style:X({top:`${e.value}px`,left:`${n.value}px`}),onClick:f[2]||(f[2]=z(()=>{},["stop"])),onMouseenter:C,onMouseleave:b},[(u(!0),m(K,null,G(t.list,(g,S)=>ie((u(),m("div",{class:"contextmenu-item bgColor-select",key:S,onClick:A=>v(g),onDblclick:f[0]||(f[0]=z(()=>{},["stop"])),onContextmenu:f[1]||(f[1]=z(()=>{},["stop"]))},[i("div",co,[i("div",uo,[g.img?(u(),m("img",{key:0,class:"img",src:g.img},null,8,mo)):B("",!0),g.icon?(u(),m("div",{key:1,class:"icon",style:X(g.iconStyle)},[i("i",{class:R(te(ue)(g.icon))},null,2)],4)):B("",!0),i("div",fo,E(g.text),1)]),g.checked?(u(),m("div",ho,[...f[3]||(f[3]=[i("i",{class:"fas fa-check"},null,-1)])])):B("",!0),g.children&&g.children.length?(u(),m("div",po,[...f[4]||(f[4]=[i("i",{class:"fas fa-angle-right"},null,-1)])])):B("",!0)])],40,ro)),[[ge,!g.hidden]])),128))],36)):B("",!0)}});const go=q(vo,[["__scopeId","data-v-b32906a2"]]),_o={class:"column"},yo=["onClick","onMouseenter","onMouseleave"],wo={class:"line-container text-default"},ko={class:"item-container"},bo=["src"],$o={key:1,class:"icon"},Co={class:"text"},xo={key:0,class:"shortcut text-secondary"},To={key:1,class:"checked"},So={key:2,class:"arrow text-secondary"},Mo=D({__name:"index",props:{x:Number,y:Number,list:Object,onCancel:Function},setup(s){const c=s,t=L(!1),o=L(),r=L(0),e=L(0),n=L(0),d=L(0),C=new Map,b=L(null);let v=null;function h(k,l){k?C.set(l,k):C.delete(l)}function f(k){v&&(clearTimeout(v),v=null),v=window.setTimeout(()=>{b.value=k},200)}function g(k){v&&(clearTimeout(v),v=null),v=window.setTimeout(()=>{b.value===k&&(b.value=null)},100)}function S(k){v&&(clearTimeout(v),v=null),b.value=k}function A(k){v&&(clearTimeout(v),v=null),v=window.setTimeout(()=>{b.value===k&&(b.value=null)},100)}function $(k){const l=new Set,_=[];return k.forEach(M=>{if(M.shortcut&&!M.children){const N=M.shortcut.toLowerCase().replace(/^ctrl\+|^shift\+|^alt\+/g,"");/^[a-z]$/.test(N)&&l.add(N)}}),k.forEach(M=>{const N={...M};if(M.children&&M.children.length>0){_.push(N);return}if(M.shortcut){_.push(N);return}let O=null;const V=(M.text||"").match(/[a-zA-Z]/);if(V){const H=V[0].toLowerCase();l.has(H)||(O=H,l.add(H))}if(!O)for(let H=0;H<26;H++){const J=String.fromCharCode(97+H);if(!l.has(J)){O=J,l.add(J);break}}O&&(N.shortcut=O),_.push(N)}),_}const a=j(()=>{const l=(c.list||[]).filter(_=>!_.hidden);return $(l)});function p(k){return k.replace(/Ctrl\+/gi,"Ctrl+").replace(/Shift\+/gi,"Shift+").replace(/Alt\+/gi,"Alt+").replace(/Delete/gi,"Del").replace(/Enter/gi,"Enter")}function w(k){const l=k.toLowerCase().split("+").map(P=>P.trim()),_=l[l.length-1],M=l.includes("ctrl"),N=l.includes("shift"),O=l.includes("alt");return P=>{if(/^[a-z]$/.test(_))return P.key.toLowerCase()===_.toLowerCase()?!M&&!N&&!O?!P.ctrlKey&&!P.shiftKey&&!P.altKey&&!P.metaKey:(!M||P.ctrlKey)&&(!N||P.shiftKey)&&(!O||P.altKey):!1;const H=P.key.toLowerCase(),J=_.toLowerCase();let Y=!1;return J==="delete"||J==="del"?Y=H==="delete"||H==="del":Y=H===J,Y&&P.ctrlKey===M&&P.shiftKey===N&&P.altKey===O}}function I(k){if(t.value&&!(k.key==="Control"||k.key==="Shift"||k.key==="Alt"||k.key==="Meta")){for(const l of a.value)if(l.shortcut&&!l.children&&l.onclick&&w(l.shortcut)(k)){k.preventDefault(),k.stopPropagation(),x(l);return}}}Z(()=>{const k=document.body.clientWidth||window.innerWidth,l=document.body.clientHeight||window.innerHeight;let _=c.y||0,M=c.x||0;o.value&&(o.value.clientHeight+_>l-5&&(_=l-o.value.clientHeight-5),o.value.clientWidth+M>k-5&&(M=k-o.value.clientWidth-5),n.value=o.value.clientWidth),r.value=_,e.value=M,setTimeout(()=>{t.value=!0}),document.addEventListener("keydown",I)}),de(()=>{document.removeEventListener("keydown",I),v&&(clearTimeout(v),v=null)});function x(k){k.children||(T(),k.onclick&&k.onclick())}function T(){t.value=!1,setTimeout(()=>{var k;(k=c.onCancel)==null||k.call(c)},100)}function y(k){const l=k.target;d.value=l.scrollTop}return(k,l)=>(u(),m("div",{class:R(["contextmenu-modal",{show:t.value}]),onClick:z(T,["stop"]),onDblclick:z(T,["stop"]),onContextmenu:z(T,["stop"])},[i("div",{class:"container",ref_key:"contextmenuRef",ref:o,style:X({top:`${r.value}px`,left:`${e.value}px`}),onClick:l[2]||(l[2]=z(()=>{},["stop"])),onScroll:y},[i("div",_o,[(u(!0),m(K,null,G(a.value,(_,M)=>ie((u(),m("div",{class:"contextmenu-item bgColor-select",key:M,onClick:N=>x(_),onDblclick:l[0]||(l[0]=z(()=>{},["stop"])),onContextmenu:l[1]||(l[1]=z(()=>{},["stop"])),ref_for:!0,ref:N=>h(N,M),onMouseenter:()=>f(M),onMouseleave:()=>g(M)},[i("div",wo,[i("div",ko,[_.img?(u(),m("img",{key:0,class:"img",src:_.img},null,8,bo)):B("",!0),_.icon?(u(),m("div",$o,[i("i",{class:R(te(ue)(_.icon))},null,2)])):B("",!0),i("div",Co,E(_.text),1),_.children&&_.children.length?(u(),oe(ve,{key:2,to:"body"},[U(go,{show:b.value===M,itemRef:te(C).get(M),scrollOffset:d.value,list:_.children,onClose:T,onMouseenter:()=>S(M),onMouseleave:()=>A(M)},null,8,["show","itemRef","scrollOffset","list","onMouseenter","onMouseleave"])])):B("",!0)]),_.shortcut&&!_.children?(u(),m("div",xo,E(p(_.shortcut)),1)):B("",!0),_.checked?(u(),m("div",To,[...l[3]||(l[3]=[i("i",{class:"fas fa-check"},null,-1)])])):B("",!0),_.children&&_.children.length?(u(),m("div",So,[...l[4]||(l[4]=[i("i",{class:"fas fa-angle-right"},null,-1)])])):B("",!0)])],40,yo)),[[ge,!_.hidden]])),128))])],36)],34))}});const Io=q(Mo,[["__scopeId","data-v-9867a233"]]);function je({x:s=0,y:c=0,list:t=[]}){const{app:o,mountNode:r}=me(Io,{x:s,y:c,list:t,onCancel:()=>{fe(o,r)}});o.mount(r)}const Lo={class:"common-type-selector"},Eo=D({__name:"CommonSelector",props:{selectorLabel:{},selectorValue:{type:[String,Number,Boolean]},options:{},placeholder:{},value:{type:[String,Number,Boolean,Array]},showSearch:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},searchThreshold:{default:10}},emits:["update:selectorLabel","update:selectorValue","update:value","change"],setup(s,{emit:c}){const t=s,o=c,r=j(()=>{var $;return t.multiple||t.showSearch||((($=t.options)==null?void 0:$.length)||0)>t.searchThreshold}),e=j(()=>t.options.map($=>({label:$.label,value:String($.value),originalValue:$.value}))),n=j(()=>{if(!r.value){if(t.selectorLabel)return t.selectorLabel;const $=t.value!==void 0?t.value:t.selectorValue;if($!==void 0){const a=f($);if(a)return a.label}return t.placeholder||"点此选择"}return""}),d=j(()=>(t.multiple,"请选择")),C=j({get:()=>{if(r.value){if(t.value!==void 0)return t.multiple&&Array.isArray(t.value)?t.value.map($=>b($)):b(t.value);if(t.selectorValue!==void 0)return b(t.selectorValue)}},set:$=>{if(!r.value)return;const a=v($);if(o("update:value",a),!t.multiple){const p=f(a);p&&(o("update:selectorLabel",p.label),o("update:selectorValue",p.value))}}});function b($){return String($)}function v($){return Array.isArray($)?$.map(a=>h(a)):h($)}function h($){const a=t.options.find(w=>b(w.value)===$);if(a)return a.value;if($==="true")return!0;if($==="false")return!1;const p=Number($);return!isNaN(p)&&$!==""?p:$}function f($){const a=b($);return t.options.find(p=>b(p.value)===a)}function g($,a){return a.label.toLowerCase().includes($.toLowerCase())}function S($){je({x:$.x,y:$.y,list:t.options.map(a=>({text:a.label,onclick:()=>{o("update:selectorLabel",a.label),o("update:selectorValue",a.value),o("update:value",a.value),o("change",a.value,a)}}))})}function A($,a){const p=v($);o("change",p,a)}return($,a)=>{const p=ee("a-select");return u(),m("div",Lo,[r.value?(u(),oe(p,{key:1,value:C.value,"onUpdate:value":a[0]||(a[0]=w=>C.value=w),placeholder:s.placeholder||d.value,"show-search":s.showSearch,mode:s.multiple?"multiple":void 0,options:e.value,"filter-option":g,class:"ant-select-mode",onChange:A},null,8,["value","placeholder","show-search","mode","options"])):(u(),m("div",{key:0,class:"contextmenu-mode text-default clickable center",onClick:S},[le(E(n.value)+"   ",1),a[1]||(a[1]=i("i",{class:"fas fa-angle-down"},null,-1))]))])}}});const ws=q(Eo,[["__scopeId","data-v-22c901a5"]]),Vo={key:0,class:"more-card-header"},Ho={class:"group-bar"},Bo=["onMousedown"],Ao={class:"more-card-item-left"},Ro={class:"more-card-item-icon"},No={class:"more-card-item-right"},jo={class:"right-div"},Do={class:"title"},qo={class:"desc"},Oo=["onMousedown"],Ko={class:"more-card-item-left"},Po={class:"more-card-item-icon"},Wo={class:"more-card-item-right"},zo={class:"right-div"},Uo={class:"title"},Fo={class:"desc"},Go=D({__name:"SDropdown",props:{width:{default:"300px"},title:{default:""},titleIcon:{default:"fas fa-cubes"},placement:{default:"bottomLeft"},menuList:{default:()=>[]},menuListGroup:{default:()=>[]}},setup(s){const c=L(!1),t=o=>{c.value=!1,o.method&&o.method()};return(o,r)=>{const e=ee("a-popover");return u(),oe(e,{open:c.value,"onUpdate:open":r[0]||(r[0]=n=>c.value=n),placement:s.placement,trigger:"hover",overlayStyle:{zIndex:999}},{content:W(()=>[i("div",{class:"more-card",style:X({width:s.width})},[s.title?(u(),m("div",Vo,[i("i",{class:R([s.titleIcon,"mr-3"])},null,2),i("span",null,E(s.title),1)])):B("",!0),s.menuListGroup?(u(!0),m(K,{key:1},G(s.menuListGroup,n=>(u(),m(K,{key:n.group_name},[i("div",Ho,E(n.group_name),1),(u(!0),m(K,null,G(n.listMenu,d=>(u(),m("div",{key:d.title,class:"more-card-item",onMousedown:z(C=>t(d),["prevent"])},[i("div",Ao,[i("div",Ro,[i("i",{class:R(d.icon)},null,2)])]),i("div",No,[i("div",jo,[i("div",Do,E(d.title),1),i("div",qo,E(d.desc),1)])])],40,Bo))),128))],64))),128)):B("",!0),s.menuList?(u(!0),m(K,{key:2},G(s.menuList,n=>(u(),m("div",{key:n.title,class:"more-card-item",onMousedown:z(d=>t(n),["prevent"])},[i("div",Ko,[i("div",Po,[i("i",{class:R(n.icon)},null,2)])]),i("div",Wo,[i("div",zo,[i("div",Uo,E(n.title),1),i("div",Fo,E(n.desc),1)])])],40,Oo))),128)):B("",!0)],4)]),default:W(()=>[F(o.$slots,"default",{},void 0,!0)]),_:3},8,["open","placement"])}}});const ks=q(Go,[["__scopeId","data-v-d5568c64"]]),Yo={key:0,class:"common-switch-wrapper"},Jo={key:0,class:"fas fa-toggle-on"},Xo={key:1,class:"fas fa-toggle-off"},Zo={class:"switch-label"},Qo={key:0,class:"fas fa-toggle-on"},en={key:1,class:"fas fa-toggle-off"},tn=D({__name:"CommonSwitch",props:{modelValue:{type:[String,Number,Boolean]},label:{},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(s,{emit:c}){const t=s,o=c,r=j(()=>typeof t.modelValue=="boolean"?t.modelValue:t.modelValue==1);function e(){if(t.disabled)return;let n;typeof t.modelValue=="boolean"?(n=!r.value,o("update:modelValue",n)):typeof t.modelValue=="number"?(n=r.value?0:1,o("update:modelValue",n)):(n=r.value?"0":"1",o("update:modelValue",n)),o("change",n)}return(n,d)=>s.label?(u(),m("div",Yo,[i("div",{class:R(["common-switch text-secondary clickable",{checked:r.value,disabled:s.disabled}]),onClick:e},[r.value?(u(),m("i",Jo)):(u(),m("i",Xo))],2),i("span",Zo,E(s.label),1)])):(u(),m("div",{key:1,class:R(["common-switch text-secondary clickable",{checked:r.value,disabled:s.disabled}]),onClick:e},[r.value?(u(),m("i",Qo)):(u(),m("i",en))],2))}});const bs=q(tn,[["__scopeId","data-v-ae08fb5d"]]),on={class:"dropdown-column"},nn=["onClick"],sn={class:"item-content"},an={key:0,class:"item-icon"},ln={class:"item-text"},$s=D({__name:"CommonDropdownMenu",props:{list:{},trigger:{default:"hover"},placement:{default:"top"},offsetX:{default:0}},emits:["select"],setup(s,{emit:c}){const t=s,o=c,r=L(!1),e=L(null),n=L({top:0,left:0});let d=null,C=!1,b=!1;const v=j(()=>{if(t.placement==="right")return{top:`${n.value.top}px`,left:`${n.value.left}px`,transform:"translateY(-50%)"};let y="-100%";return t.placement==="bottom"&&(y="0"),{top:`${n.value.top}px`,left:`${n.value.left}px`,transform:`translateX(-50%) translateY(${y})`,"--dropdown-translate-y":y}}),h=()=>{if(!e.value)return;const y=e.value.getBoundingClientRect();t.placement==="right"?n.value={top:y.top+y.height/2,left:y.right+8+t.offsetX}:t.placement==="top"?n.value={top:y.top-8,left:y.left+y.width/2+t.offsetX}:n.value={top:y.bottom+8,left:y.left+y.width/2+t.offsetX}},f=()=>{d&&(clearTimeout(d),d=null),h(),r.value=!0},g=()=>{!C&&!b&&(r.value=!1)},S=()=>{d&&clearTimeout(d),d=window.setTimeout(g,100)},A=()=>{t.trigger==="hover"&&(C=!0,f())},$=()=>{t.trigger==="hover"&&(C=!1,S())},a=()=>{t.trigger==="hover"&&(b=!0,d&&(clearTimeout(d),d=null))},p=()=>{t.trigger==="hover"&&(b=!1,S())},w=()=>{r.value?r.value=!1:(h(),r.value=!0)},I=()=>{r.value=!1},x=y=>{r.value=!1,o("select",y)},T=y=>{if(t.trigger!=="click"||!r.value)return;const k=y.target;!k.closest(".common-dropdown-menu")&&!k.closest(".dropdown-menu-container")&&(r.value=!1)};return Z(()=>{t.trigger==="click"&&document.addEventListener("click",T)}),de(()=>{d&&clearTimeout(d),document.removeEventListener("click",T)}),(y,k)=>(u(),m("div",{ref_key:"containerRef",ref:e,class:"common-dropdown-menu",onMouseenter:A,onMouseleave:$},[i("div",{class:"trigger-button",onClick:k[0]||(k[0]=l=>s.trigger==="click"&&w())},[F(y.$slots,"default",{},()=>[k[1]||(k[1]=i("div",{class:"default-trigger"},[i("i",{class:"fas fa-ellipsis"})],-1))])]),(u(),oe(ve,{to:"body"},[r.value?(u(),m("div",{key:0,class:R(["dropdown-menu-container",`placement-${t.placement}`]),style:X(v.value),onMouseenter:a,onMouseleave:p},[i("div",on,[(u(!0),m(K,null,G(s.list,(l,_)=>(u(),m("div",{class:"dropdown-item",key:_,onClick:M=>x(l)},[i("div",sn,[l.icon?(u(),m("div",an,[i("i",{class:R(te(ue)(l.icon))},null,2)])):B("",!0),i("div",ln,E(l.text),1)])],8,nn))),128))])],38)):B("",!0)])),(u(),oe(ve,{to:"body"},[r.value&&s.trigger==="click"?(u(),m("div",{key:0,class:"dropdown-overlay",onClick:I})):B("",!0)]))],544))}});const rn=["innerHTML"],cn=D({__name:"TextHighlight",props:{queries:{}},setup(s){const c=s,t=Ae(),o=j(()=>{const e=t.default?t.default():"";return Array.isArray(e)&&e.length>0&&e[0].children||""}),r=j(()=>{if(!c.queries||c.queries.length===0)return o.value;let e=o.value;return c.queries.forEach(n=>{if(!n)return;const d=new RegExp(`(${n})`,"gi");e=e.replace(d,"<mark>$1</mark>")}),e});return(e,n)=>(u(),m("span",{innerHTML:r.value},null,8,rn))}});const Cs=q(cn,[["__scopeId","data-v-3c842dc2"]]),un=D({__name:"SortableList",props:{handle:{},animate:{default:100},listClass:{},tag:{default:"div"}},emits:["drag","drop"],setup(s,{emit:c}){const t=s,o=c,r=L(null),e=L(0);let n=null;const d=()=>{var b;if(!r.value)return;const C=t.tag?r.value.querySelector(t.tag):(b=r.value)==null?void 0:b.firstElementChild;C&&(n=et.create(C,{handle:t.handle,animation:t.animate,ghostClass:"sortable-ghost",dragClass:"sortable-drag",chosenClass:"sortable-chosen",onStart:()=>{o("drag")},onEnd:v=>{const{newIndex:h,oldIndex:f}=v;o("drop",{oldIndex:f,newIndex:h})}}))};return Z(()=>{ne(()=>{d()})}),se(()=>t.handle,()=>{ne(()=>{n&&n.destroy(),d()})}),se(()=>t.animate,()=>{ne(()=>{n&&n.destroy(),d()})}),se(()=>t.tag,()=>{ne(()=>{n&&n.destroy(),d()})}),_e(()=>{n&&n.destroy()}),(C,b)=>(u(),m("div",{class:"sortable-list",ref_key:"wrapper",ref:r},[(u(),m("div",{key:e.value,class:R(s.listClass)},[F(C.$slots,"default",{},void 0,!0)],2))],512))}});const xs=q(un,[["__scopeId","data-v-0ddcf022"]]),Ts=D({__name:"Notify",props:{popup:{type:Boolean}},setup(s){const{t:c}=re(),t=We(),o=Re(),r=s,e=L(r.popup!==void 0?r.popup:!0),n=L(null);let d=L(null);const C=async()=>{try{const g=(await Ye()).data;if(g.remind&&g.remind.id&&(o.setNewMsg(1),e.value)){let S="";if(g.remind.object_type=="vip"){S=c("message.vip_expiring_notice");const p=t.resolve({path:"/user/setting"}).href;v(S,g.remind.from_uid,g.remind.message_content_id,p);return}g.remind.action_type=="comment"||g.remind.action_type=="comment_reply"?S=g.remind.message_content||g.remind.from_name+" "+c("message.publish_comment"):S=g.remind.from_name+" "+c("message.update_the_page")+" "+g.remind.page_data.page_title+" , "+c("message.click_to_view");const $=t.resolve({path:"/message/index",query:{dtab:"remindList"}}).href;v(S,g.remind.from_uid,g.remind.message_content_id,$)}if(g.announce&&g.announce.id&&(o.setNewMsg(1),e.value)){const S=c("message.you_have_unread_announcement"),$=t.resolve({path:"/message/index",query:{dtab:"announcementList"}}).href;v(S,g.announce.from_uid,g.announce.message_content_id,$)}}catch(f){console.error("[Notify] 获取未读消息失败:",f)}},b=(f,g,S,A)=>{const $=g+"_"+S;d.value=$,be.open({message:"ShowDoc "+c("message.notification"),description:f,duration:0,key:$,placement:"topRight",onClick:()=>{window.open(A,"_blank"),be.close($)},onClose:()=>{h(g,S)}})},v=(f,g,S,A)=>{if(!e.value)return!1;const $="ShowDoc "+c("message.notification"),a={dir:"auto",body:f,requireInteraction:!0,tag:g+"_"+S};if(!("Notification"in window)){console.log("浏览器不支持系统通知，使用 web 弹窗通知"),b(f,g,S,A);return}let p=null;Notification.permission==="granted"?(p=new Notification($,a),p.onclick=()=>{window.open(A,"_blank"),h(g,S),window.focus(),p.close()}):Notification.permission==="default"?(b(f,g,S,A),Notification.requestPermission().then(w=>{if(w==="granted"){console.log("用户同意授权");const I=g+"_"+S;be.close(I),p=new Notification($,a),p.onclick=()=>{window.open(A,"_blank"),h(g,S),window.focus(),p.close()}}else w==="default"?console.warn("用户关闭授权 未刷新页面之前 可以再次请求授权"):console.log("用户拒绝授权，继续使用 web 弹窗通知")})):(console.log("用户曾经拒绝显示通知，使用 web 弹窗通知"),b(f,g,S,A))},h=async(f,g)=>{o.setNewMsg(0),setTimeout(async()=>{try{await Je({from_uid:f,message_content_id:g})}catch(S){console.error("设置已读失败:",S)}},2e3)};return Z(()=>{setTimeout(()=>{C()},2e3),n.value=window.setInterval(()=>{C()},60*60*1e3)}),de(()=>{n.value&&clearInterval(n.value)}),(f,g)=>(u(),m("div"))}}),dn={class:"editor-modal-content"},mn=D({__name:"EditorModal",props:{show:{type:Boolean,default:!1},maskClosable:{type:Boolean,default:!1}},emits:["close"],setup(s,{emit:c}){const t=s,o=c;se(()=>t.show,e=>{e?document.body.style.overflow="hidden":document.body.style.overflow=""}),_e(()=>{document.body.style.overflow=""});const r=()=>{t.maskClosable&&o("close")};return(e,n)=>(u(),oe(ve,{to:"body"},[U(He,{name:"editor-modal"},{default:W(()=>[s.show?(u(),m("div",{key:0,class:"editor-modal",onWheel:n[0]||(n[0]=z(()=>{},["stop"])),onClick:z(r,["self"])},[i("div",dn,[F(e.$slots,"default",{},void 0,!0)])],32)):B("",!0)]),_:3})]))}});const Ss=q(mn,[["__scopeId","data-v-89a98573"]]),fn={class:"text"},hn=D({__name:"MenuButton",props:{text:{},theme:{default:"light"},list:{},spinning:{type:Boolean,default:!1},leftIcon:{},onClick:{}},setup(s){const c=s;function t(e){if(Array.isArray(e)){const n=e[0],d=e[1];return d.startsWith("fa-")?`${n} ${d}`:`${n} fa-${d}`}return e}function o(e){je({x:e.x,y:e.y,list:c.list})}function r(){c.onClick&&c.onClick()}return(e,n)=>{const d=ee("a-spin");return u(),m("div",null,[U(d,{spinning:c.spinning,size:"small",delay:300},{default:W(()=>[i("div",{class:R(["menu-button center",c.theme])},[i("div",{class:"main-content center clickable bgColor-select",onClick:r},[c.leftIcon?(u(),m("i",{key:0,class:R(t(c.leftIcon))},null,2)):B("",!0),i("div",fn,E(c.text),1)]),i("div",{class:"menu-handle center clickable bgColor-select",onClick:z(o,["stop"])},[...n[0]||(n[0]=[i("i",{class:"icon fas fa-angle-down"},null,-1)])])],2)]),_:1},8,["spinning"])])}}});const Ms=q(hn,[["__scopeId","data-v-88db428d"]]),pn=["id"],vn=D({__name:"index",props:{modelValue:{default:""},id:{default:()=>`editor-md-${Math.random().toString(36).substr(2,9)}`},mode:{default:"editor"},height:{default:"70vh"},taskToggle:{type:Boolean,default:!0},keyword:{default:""},editorPath:{default:""},toolbar:{default:()=>["undo","redo","|","bold","del","italic","quote","|","mindmap","plantuml","mermaid","tasklist","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","center","|","link","reference-link","image","video","code","code-block","table","datetime","html-entities","pagebreak","|","watch","fullscreen","clear","search","|","help"]},features:{default:()=>({})},theme:{default:()=>({})},upload:{default:()=>({})}},emits:["update:modelValue","change","load","task-toggle"],setup(s,{expose:c,emit:t}){const o=s,r=t;let e=null;const n=L(o.id),d=L(""),C=L(""),b=L(!1),v=new Set,h=a=>new Promise((p,w)=>{if(v.has(a)){p();return}const I=document.createElement("script");I.src=a,I.onload=()=>{v.add(a),p()},I.onerror=()=>{w(new Error(`Failed to load ${a}`))},document.head.appendChild(I)}),f=a=>{if(!a||a.length===0)return"";let p=a;return p=p.replace(/&amp;/g,"&"),p=p.replace(/&lt;/g,"<"),p=p.replace(/&gt;/g,">"),p=p.replace(/&nbsp;/g," "),p=p.replace(/&#39;/g,"'"),p=p.replace(/&quot;/g,'"'),p},g=a=>{const p=document.createElement("a");return p.href=a,{source:a,protocol:p.protocol.replace(":",""),host:p.hostname,hostname:p.hostname,port:p.port,query:p.search,params:(()=>{const w={},I=p.search.replace(/^\?/,"").split("&");for(let x=0;x<I.length;x++)if(I[x]){const T=I[x].split("=");w[T[0]]=T[1]}return w})(),hash:p.hash.replace("#",""),path:p.pathname.replace(/^([^/])/,"/$1"),pathname:p.pathname.replace(/^([^/])/,"/$1")}},S=async()=>{const a=window.$,p=`${d.value}highlight/highlight.min.js?rand=2`;try{await h(p);const w=window.hljs;if(w&&w.highlightAll)try{w.highlightAll(),await new Promise(I=>setTimeout(I,100))}catch{}}catch{}if(a&&a.each)try{a(`#${n.value} table`).each(function(){const w=a(this);w.parent().hasClass("table-wrapper")||w.wrap('<div style="width: 100%; overflow-x: auto;"></div>')})}catch{}if(a&&a(`#${n.value} a[href^="http"]`).click(function(){const I=a(this).attr("href"),x=g(I),T=window.location;return(T.hostname===x.hostname||x.hostname==="www.showdoc.cc")&&T.pathname===x.pathname?(window.location.href=I,x.hash&&window.location.reload()):window.open(I,"_blank"),!1}),a&&a.each)try{a(`#${n.value} table tbody tr`).each(function(){const w=a(this),I=w.find("td"),x=I.eq(1).html()||"",T=I.eq(2).html()||"",y=x==="object"||x==="array[object]"||T==="object"||T==="array[object]";y?w.css({"background-color":"var(--editormd-table-alt-bg)"}):w.css("background-color","var(--editormd-table-row-bg)"),w.off("mouseenter mouseleave").hover(function(){w.css("background-color","var(--editormd-table-alt-bg)")},function(){y?w.css({"background-color":"var(--editormd-table-alt-bg)"}):w.css("background-color","var(--editormd-table-row-bg)")})})}catch{}if(a)try{const w=a(`#${n.value}`).width()||722;a(`#${n.value} table`).each(function(){const I=a(this),x=I.get(0);if(x&&x.rows&&x.rows.length>0){const T=x.rows.item(0);if(T){const y=T.cells.length,k=Math.floor(w/y)-2;y<=5&&I.find("th").css("width",k.toString()+"px")}}})}catch{}if(a){const w=a(`#${n.value}`);w.data("viewer")&&(w.data("viewer").destroy(),w.removeData("viewer"));const I=new tt(w.get(0),{url:"src",title:!1,toolbar:{zoomIn:1,zoomOut:1,oneToOne:1,reset:1,prev:1,play:!1,next:1,rotateLeft:1,rotateRight:1,flipHorizontal:1,flipVertical:1}});w.data("viewer",I)}if(o.keyword&&a&&a.fn&&a.fn.mark)try{const w=a(`#${n.value}`);w.unmark(),w.mark(o.keyword,{separateWordSearch:!0,caseSensitive:!1,accuracy:"partially",ignoreJoiners:!0})}catch{}if(a&&a.fn)try{a(`#${n.value} pre:has(> code)`).each(function(){const I=a(this);I.find(".code-copy-btn").length===0&&a('<span class="code-copy-btn">复制</span>').prependTo(I)}),a(`#${n.value}`).off("click",".code-copy-btn").on("click",".code-copy-btn",function(){const I=a(this),T=I.parent().text().trim();navigator.clipboard.writeText(T).then(()=>{I.text("复制成功"),setTimeout(()=>{I.text("复制")},1500)}).catch(()=>{})})}catch{}if((o.mode==="html"||o.mode==="preview")&&a&&a.each){const w=a(`#${n.value}`),I=w.find('input[type="checkbox"]').filter(function(){return a(this).closest("pre, code, .editormd-code-block, .hljs").length===0});w.off("change.tasklist"),o.taskToggle?(I.each(function(x){const T=a(this);T.prop("disabled",!1),T.attr("data-task-index",x.toString())}),w.on("change.tasklist",'input[type="checkbox"]',function(){const x=a(this);if(x.closest("pre, code, .editormd-code-block, .hljs").length>0)return;const T=parseInt(x.attr("data-task-index")||"-1");if(isNaN(T))return;const y=x.is(":checked");r("task-toggle",{index:T,checked:y})})):I.prop("disabled",!0)}},A=async a=>{try{await Promise.all([h(`${a}jquery.min.js`),h(`${a}lib/raphael.min.js`)]),await Promise.all([h(`${a}lib/d3@5.min.js`),h(`${a}lib/flowchart.min.js?v=2`)]),await Promise.all([h(`${a}xss.min.js`),h(`${a}lib/marked.min.js`),h(`${a}lib/underscore.min.js`),h(`${a}lib/sequence-diagram.min.js`),h(`${a}lib/jquery.flowchart.min.js`),h(`${a}lib/jquery.mark.min.js`),h(`${a}lib/plantuml.js?v=2`),h(`${a}lib/view.min.js`),h(`${a}lib/transform.min.js`)]);const p=`${a}editormd.js?v=46`;if(await h(p),!window.editormd)throw new Error("editormd object not found after loading script")}catch(p){throw p}},$=async()=>{try{const a=await Xe();a&&(C.value=a.user_token||"");const p=Ze();d.value=o.editorPath||`${p}editor.md/`,await A(d.value);const w=window.editormd;if(!w)return;const I=o.modelValue||"",x=o.mode==="editor"?I:I.replace(/\[TOC\]\s*/gi,""),T={path:`${d.value}lib/`,height:o.height,markdown:x,taskList:!0,atLink:!1,emailLink:!1,tex:!0,flowChart:!0,sequenceDiagram:!0,toc:!1,tocm:!1,tocDropdown:!1,syncScrolling:"single",htmlDecode:"style,script,iframe|filterXSS",imageUpload:!0,imageFormats:["jpg","jpeg","gif","png","bmp","webp","JPG","JPEG","GIF","PNG","BMP","WEBP"],toolbar:o.toolbar,toolbarIcons:()=>o.toolbar,toolbarIconsClass:{toc:"fa-bars ",mindmap:"fa-sitemap ",plantuml:"fa-random ",mermaid:"fa-pie-chart ",video:"fa-file-video-o",center:"fa-align-center",tasklist:"fa-check-square-o"},toolbarHandlers:{video:function(l,_,M,N){l.replaceSelection(`\r
<video src="http://your-site.com/your.mp4" style="width: 100%; height: 100%;" controls="controls"></video>\r
`),N===""&&l.setCursor(M.line,M.ch+1)},tasklist:function(l,_,M,N){const O=`## 任务清单
### 今日
- [ ] 整理站内消息与通知
- [ ] 跟进两条用户反馈
- [x] 合并并审核一个 PR

### 本周
- [ ] 完成文档目录整理与迁移
- [ ] 优化图片加载与懒加载策略

### 待办
- [ ] 编写部署与备份说明
- [ ] 补充接口错误码表
`;l.replaceSelection(O),N===""&&l.setCursor(M.line,M.ch+1)},mindmap:function(l,_,M,N){const O=`\`\`\`mindmap
# 一级
## 二级分支1
### 三级分支1
### 三级分支2
## 二级分支2
### 三级分支3
### 三级分支4
\`\`\``;l.replaceSelection(O),N===""&&l.setCursor(M.line,M.ch+1)},plantuml:function(l,_,M,N){const O="```plantuml\n@startuml\nactor 用户\n用户 -> 系统: 请求\n系统 --> 用户: 响应\n@enduml\n```";l.replaceSelection(O),N===""&&l.setCursor(M.line,M.ch+1)},mermaid:function(l,_,M,N){const O="```mermaid\ngraph LR\n    A[开始] --> B{判断}\n    B -->|是| C[执行]\n    B -->|否| D[结束]\n    C --> D\n```";l.replaceSelection(O),N===""&&l.setCursor(M.line,M.ch+1)},center:function(l,_,M,N){l.replaceSelection("<center>"+N+"</center>"),N===""&&l.setCursor(M.line,M.ch+1)}},lang:{toolbar:{mindmap:"插入思维导图",plantuml:"插入UML图",mermaid:"插入Mermaid图表",video:"插入视频",center:"居中",tasklist:"插入任务列表"}},onchange:()=>{if(e&&e.getMarkdown){const l=e.getMarkdown();r("update:modelValue",l),r("change",l)}S()},previewCodeHighlight:!1,katexURL:{css:"",js:""},onload:()=>{ne(()=>{ne(()=>{S()})})}},y=Ne();if(y.indexOf("?")>-1?T.imageUploadURL=`${y}/api/page/uploadImg&user_token=${C.value}`:T.imageUploadURL=`${y}/api/page/uploadImg?user_token=${C.value}`,T.katexURL={css:`${d.value}katex/katex.min`,js:`${d.value}katex/katex.min`},await ne(),!document.getElementById(n.value)){console.error(`[EditormdEditor] Editor element #${n.value} not found`);return}o.mode==="editor"?(b.value||(await h(`${d.value}lib/mermaid.min.js`),b.value=!0),e=w(n.value,T)):((o.modelValue||"").toLowerCase().indexOf("mermaid")>-1&&!b.value&&(await h(`${d.value}lib/mermaid.min.js`),b.value=!0),e=w.markdownToHTML(n.value,T),setTimeout(()=>{S()},50)),r("load",e)}catch{}};return Z(async()=>{try{await $()}catch{}}),_e(()=>{const a=window.$;if(a&&n.value){const p=a(`#${n.value}`);p.data("viewer")&&(p.data("viewer").destroy(),p.removeData("viewer"))}if(e){try{const p=document.getElementById(n.value);p&&(p.innerHTML="")}catch{}e=null}}),c({getMarkdown:()=>(e==null?void 0:e.getMarkdown())||"",insertValue:a=>{e&&e.insertValue(f(a))},editorUnwatch:()=>{var a;return(a=e==null?void 0:e.unwatch)==null?void 0:a.call(e)},editorWatch:()=>{var a;return(a=e==null?void 0:e.watch)==null?void 0:a.call(e)},setCursorToTop:()=>{var a;return(a=e==null?void 0:e.setCursor)==null?void 0:a.call(e,{line:0,ch:0})},clear:()=>{var a;return(a=e==null?void 0:e.clear)==null?void 0:a.call(e)},getSelection:()=>{var a;return((a=e==null?void 0:e.getSelection)==null?void 0:a.call(e))||""},setCursor:a=>{var p;return(p=e==null?void 0:e.setCursor)==null?void 0:p.call(e,a)},focus:()=>{e!=null&&e.focus?e.focus():e!=null&&e.cm&&e.cm.focus()},blur:()=>{var a;return(a=e==null?void 0:e.blur)==null?void 0:a.call(e)},preview:()=>{var a;return(a=e==null?void 0:e.previewing)==null?void 0:a.call(e)},fullscreen:()=>{var a;return(a=e==null?void 0:e.fullscreen)==null?void 0:a.call(e)},fullscreenExit:()=>{var a;return(a=e==null?void 0:e.fullscreenExit)==null?void 0:a.call(e)},getInstance:()=>e}),(a,p)=>(u(),m("div",{id:n.value,class:"main-editor"},null,8,pn))}});const gn=q(vn,[["__scopeId","data-v-1e00127e"]]),_n={syncScroll:!0,toc:!0,autoInsertToc:!0,fullscreen:!0,mermaid:!0,plantuml:!0,mindmap:!0,flowchart:!0,sequenceDiagram:!0,tex:!0,taskList:!0,codeHighlight:!0,imageUpload:!0,video:!0},yn=["undo","redo","|","bold","del","italic","quote","|","toc","mindmap","plantuml","mermaid","tasklist","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","center","|","link","reference-link","image","video","code","code-block","table","datetime","html-entities","pagebreak","|","watch","fullscreen","clear","search","|","help"],wn={class:"editormd-editor-adapter showdoc"},kn={class:"editor-wrapper"},bn=D({__name:"ShowdocAdapter",props:{modelValue:{default:""},id:{default:()=>`editor-md-${Math.random().toString(36).substr(2,9)}`},mode:{default:"editor"},height:{default:"70vh"},taskToggle:{type:Boolean,default:!0},keyword:{default:""},editorPath:{default:""},features:{default:()=>({})},theme:{default:()=>({editor:"light",preview:"light"})},toolbar:{default:()=>yn},upload:{}},emits:["update:modelValue","change","input","load","task-toggle"],setup(s,{expose:c,emit:t}){const o=s,r=t,e=L(),n=L(o.modelValue),d=j(()=>o.id),C=j(()=>({..._n,autoInsertToc:!0,...o.features})),b=j(()=>{const l=document.documentElement.getAttribute("data-theme")==="dark";return{editor:l?"dark":"light",preview:l?"dark":"light",...o.theme}}),v=l=>{r("load",l)},h=l=>{r("update:modelValue",l),r("change",l),r("input",l)},f=l=>{r("task-toggle",l)};return se(()=>o.modelValue,l=>{l!==n.value&&(n.value=l)}),se(()=>document.documentElement.getAttribute("data-theme"),l=>{console.log("Theme changed to:",l==="dark"?"dark":"light")}),c({getValue:()=>{var l;return((l=e.value)==null?void 0:l.getMarkdown())||""},setValue:l=>{var _;(_=e.value)==null||_.setValue(l)},insertValue:l=>{var _;(_=e.value)==null||_.insertValue(l)},getSelection:()=>{var l;return((l=e.value)==null?void 0:l.getSelection())||""},clear:()=>{var l;(l=e.value)==null||l.clear()},setCursor:l=>{var _;(_=e.value)==null||_.setCursor(l)},focus:()=>{var _;const l=(_=e.value)==null?void 0:_.getInstance();l!=null&&l.editor&&l.editor.focus()},blur:()=>{console.log("Editormd blur not implemented")},preview:()=>{var l;return(l=e.value)==null?void 0:l.preview()},unwatch:()=>{var l;return(l=e.value)==null?void 0:l.unwatch()},watch:()=>{var l;return(l=e.value)==null?void 0:l.watch()},getInstance:()=>{var l;return(l=e.value)==null?void 0:l.getInstance()}}),(l,_)=>(u(),m("div",wn,[i("div",kn,[U(gn,{ref_key:"editormdEditorRef",ref:e,modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=M=>n.value=M),id:d.value,mode:s.mode,height:s.height,taskToggle:s.taskToggle,keyword:s.keyword,editorPath:s.editorPath,features:C.value,theme:b.value,toolbar:s.toolbar,upload:l.uploadConfig,onLoad:v,onChange:h,onTaskToggle:f},null,8,["modelValue","id","mode","height","taskToggle","keyword","editorPath","features","theme","toolbar","upload"])])]))}});const Is=q(bn,[["__scopeId","data-v-29535ee4"]]),$n=["placeholder","disabled","rows"],Cn=D({__name:"CommonTextarea",props:{modelValue:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},rows:{default:5}},emits:["update:modelValue"],setup(s,{expose:c,emit:t}){const o=s,r=t,e=L("");ze(()=>{e.value=o.modelValue});function n(p){const w=p.target;r("update:modelValue",w.value)}const d=L(!0);function C(){d.value=!0}function b(){d.value=!1}const v=L(!1),h=L("top: 0px; left: 0px;");let f;function g(p){clearTimeout(f),f=setTimeout(()=>{v.value=!0},300)}function S(p){h.value=`top: ${p.offsetY}px; left: ${p.offsetX}px;`}function A(p){clearTimeout(f),v.value=!1}const $=L();function a(){ne(()=>{var w,I;const p=o.modelValue.length;(w=$.value)==null||w.focus(),(I=$.value)==null||I.setSelectionRange(p,p)})}return c({focusAtLast:a}),(p,w)=>(u(),m("div",{class:"common-textarea",style:X({minHeight:`${o.rows*20+26}px`})},[ie(i("textarea",{ref_key:"textareaRef",ref:$,placeholder:o.placeholder,disabled:o.disabled,rows:o.rows,onInput:n,onFocus:C,onBlur:b,onMouseenter:g,onMousemove:S,onMouseout:A,"onUpdate:modelValue":w[0]||(w[0]=I=>e.value=I)},null,40,$n),[[Be,e.value]]),ie(i("div",{class:"common-textarea-tooltips",style:X(h.value)}," 点击编辑 ",4),[[ge,v.value&&!d.value]])],4))}});const Ls=q(Cn,[["__scopeId","data-v-f5b2d512"]]),xn={class:"tab-header"},Tn={class:"tab-container"},Sn=["onClick"],Mn={class:"tab-content"},In={key:0,class:"tab-icon"},Ln={class:"tab-text"},En={class:"tab-content-wrapper"},Vn=D({__name:"CommonTab",props:{items:{},value:{},type:{default:"segmented"},disabled:{type:Boolean,default:!1}},emits:["updateValue","change"],setup(s,{expose:c,emit:t}){const o=s,r=t,e=j({get:()=>o.value,set:v=>r("updateValue",v)}),n=Ae();j(()=>n.default?Object.keys(n).some(v=>v!=="default"):!1),c({setActive:v=>{r("updateValue",v)}});const C=v=>{o.disabled||v.disabled||(r("updateValue",v.value),r("change",v))};function b(v){if(Array.isArray(v)){const h=v[0],f=v[1];return f.startsWith("fa-")?`${h} ${f}`:`${h} fa-${f}`}return v}return(v,h)=>(u(),m("div",{class:R(["common-tab",[`type-${s.type}`,{disabled:s.disabled}]])},[i("div",xn,[i("div",Tn,[(u(!0),m(K,null,G(s.items,(f,g)=>(u(),m("div",{key:f.value,class:R(["tab-item",{active:e.value===f.value,disabled:f.disabled}]),onClick:S=>C(f)},[i("div",Mn,[f.icon?(u(),m("div",In,[i("i",{class:R(b(f.icon))},null,2)])):B("",!0),i("div",Ln,E(f.text),1)])],10,Sn))),128))])]),i("div",En,[F(v.$slots,"default",{},void 0,!0),(u(!0),m(K,null,G(s.items,f=>(u(),m(K,{key:f.value},[e.value===f.value?F(v.$slots,String(f.value),{key:0},void 0,!0):B("",!0)],64))),128))])],2))}});const Es=q(Vn,[["__scopeId","data-v-4403fa5e"]]),Hn={key:0,class:"toc-container"},Bn={class:"toc-header"},An={class:"toc-content"},Rn=["onClick"],Nn={key:0,class:"toc-empty"},jn={key:1,class:"toc-loading"},Dn=D({__name:"Toc",setup(s){const c=L(!1),t=L(""),o=L([]),r=L(!0),e=()=>{r.value=!0;const v=[".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6",".editormd-preview h1, .editormd-preview h2, .editormd-preview h3, .editormd-preview h4, .editormd-preview h5, .editormd-preview h6",".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6","#page-content-main h1, #page-content-main h2, #page-content-main h3, #page-content-main h4, #page-content-main h5, #page-content-main h6"];let h=null;for(const f of v)if(h=document.querySelectorAll(f),h.length>0)break;if((!h||h.length===0)&&(h=document.querySelectorAll(".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6")),o.value=[],h.forEach(f=>{let g=f.getAttribute("id");g||(g=`heading-${f.tagName.charAt(1)}-${Math.random().toString(36).substr(2,9)}`,f.setAttribute("id",g));const S=f.textContent||"",A=parseInt(f.tagName.charAt(1));g&&S&&o.value.push({id:g,text:S,level:A})}),r.value=!1,o.value.length>0&&(c.value=!0),o.value.length===0){const f=[document.querySelector(".vditor-reset"),document.querySelector(".vditor-preview"),document.querySelector("#page-content-main")];for(const g of f)if(g&&g.innerHTML.trim())break}},n=v=>{const h=document.getElementById(v);if(h){const S=h.getBoundingClientRect().top+window.pageYOffset-120;window.scrollTo({top:S,behavior:"smooth"})}},d=()=>{c.value=!c.value},C=()=>{const v=[".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6",".editormd-preview h1, .editormd-preview h2, .editormd-preview h3, .editormd-preview h4, .editormd-preview h5, .editormd-preview h6",".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6",".vditor-reset h1, .vditor-reset h2, .vditor-reset h3, .vditor-reset h4, .vditor-reset h5, .vditor-reset h6",".vditor-preview h1, .vditor-preview h2, .vditor-preview h3, .vditor-preview h4, .vditor-preview h5, .vditor-preview h6","#page-content-main h1, #page-content-main h2, #page-content-main h3, #page-content-main h4, #page-content-main h5, #page-content-main h6"];let h=null;for(const S of v)if(h=document.querySelectorAll(S),h.length>0)break;(!h||h.length===0)&&(h=document.querySelectorAll(".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6"));const f=window.pageYOffset+150;let g=null;h.forEach(S=>{S.getBoundingClientRect().top+window.pageYOffset<=f&&(g=S)}),g&&(t.value=g.getAttribute("id")||"")};let b=null;return Z(()=>{const v=h=>{setTimeout(()=>{e()},h)};v(500),v(1e3),v(1500),v(2e3),v(3e3),window.addEventListener("scroll",C,{passive:!0}),b=new MutationObserver(()=>{setTimeout(()=>{e()},300)}),setTimeout(()=>{const h=[".editormd-preview-container",".editormd-preview",".markdown-body",".vditor-reset",".vditor-preview","#page-content-main"];let f=null;for(const g of h)if(f=document.querySelector(g),f&&f.innerHTML.trim())break;f&&b?b.observe(f,{childList:!0,subtree:!0}):setTimeout(()=>{for(const g of h)if(f=document.querySelector(g),f&&f.innerHTML.trim())break;f&&b&&b.observe(f,{childList:!0,subtree:!0})},1e3)},500),setTimeout(()=>{const h=[".editormd-preview-container",".editormd-preview",".markdown-body",".vditor-reset",".vditor-preview","#page-content-main"];let f=null;for(const g of h)if(f=document.querySelector(g),f)break;f&&f.querySelectorAll("img").forEach(S=>{const A=S;A.complete?e():A.addEventListener("load",e)})},800)}),_e(()=>{window.removeEventListener("scroll",C),b&&b.disconnect()}),(v,h)=>{const f=ee("a-spin");return o.value.length>0||r.value?(u(),m("div",Hn,[i("div",{class:"toc-toggle",onClick:d},[...h[0]||(h[0]=[i("i",{class:"fas fa-list"},null,-1)])]),i("div",{class:R(["toc-list",{"is-open":c.value}])},[i("div",Bn,[i("span",null,E(v.$t("page.catalog")),1),i("i",{class:"fas fa-times",onClick:d})]),i("div",An,[(u(!0),m(K,null,G(o.value,(g,S)=>(u(),m("div",{key:S,class:R(["toc-item",`toc-level-${g.level}`,{"is-active":t.value===g.id}]),onClick:A=>n(g.id)},[i("span",null,E(g.text),1)],10,Rn))),128)),o.value.length===0&&!r.value?(u(),m("div",Nn,E(v.$t("page.no_catalog")),1)):B("",!0),r.value?(u(),m("div",jn,[U(f,{size:"small"})])):B("",!0)])],2)])):B("",!0)}}});const Vs=q(Dn,[["__scopeId","data-v-dd6166ab"]]),qn={key:0,class:"search-breadcrumb"},On={class:"search-label"},Kn={class:"search-keyword"},Pn=D({__name:"SearchBreadcrumb",props:{keyword:{default:""},pageInfo:{default:()=>({})},itemInfo:{default:()=>({})}},setup(s){return(c,t)=>{const o=ee("router-link"),r=ee("a-breadcrumb-item"),e=ee("a-breadcrumb");return s.keyword?(u(),m("div",qn,[U(e,null,{default:W(()=>[U(r,null,{default:W(()=>{var n,d;return[U(o,{to:`/${((n=s.itemInfo)==null?void 0:n.item_domain)||((d=s.itemInfo)==null?void 0:d.item_id)}`},{default:W(()=>{var C;return[le(E((C=s.itemInfo)==null?void 0:C.item_name),1)]}),_:1},8,["to"])]}),_:1}),U(r,null,{default:W(()=>[i("span",On,E(c.$t("search")),1),i("span",Kn,'"'+E(s.keyword)+'"',1)]),_:1}),s.pageInfo&&s.pageInfo.full_path&&s.pageInfo.full_path.length>0?(u(!0),m(K,{key:0},G(s.pageInfo.full_path,(n,d)=>(u(),oe(r,{key:d},{default:W(()=>[n.cat_name?(u(),m(K,{key:0},[le(E(n.cat_name),1)],64)):n.page_title?(u(),m(K,{key:1},[le(E(n.page_title),1)],64)):B("",!0)]),_:2},1024))),128)):B("",!0),s.pageInfo&&s.pageInfo.page_title&&(!s.pageInfo.full_path||s.pageInfo.full_path.length===0)?(u(),oe(r,{key:1,class:"current-page"},{default:W(()=>[le(E(s.pageInfo.page_title),1)]),_:1})):B("",!0)]),_:1})])):B("",!0)}}});const Hs=q(Pn,[["__scopeId","data-v-f6037437"]]),Wn=["title"],zn={key:1,class:"chat-window"},Un={class:"chat-header"},Fn={class:"header-title"},Gn={class:"header-actions"},Yn=["title"],Jn=["title"],Xn={class:"chat-container"},Zn={class:"message-avatar"},Qn={class:"message-content"},es=["innerHTML"],ts={key:0,class:"message-sources"},os=["onClick"],ns={class:"relevance"},ss={key:0,class:"message assistant"},as={class:"input-area"},ls={class:"input-actions"},is=D({__name:"AiChatDialog",props:{itemId:{},itemName:{default:""}},setup(s,{emit:c}){const t=s,{t:o}=re(),r=Re(),e=L(!1),n=L(!1),d=L([]),C=L(""),b=L(!1),v=L(null),h=L(null),f=L({dialog_collapsed:!0,welcome_message:""}),g=L(null),S=L(!1),A=j(()=>(t.itemName||o("item.project"))+" - "+o("ai.ai_chat_assistant")),$=j(()=>S.value?100:40),a=()=>{const V=window.pageYOffset||document.documentElement.scrollTop,H=S.value;S.value=V>100,!H&&S.value&&setTimeout(()=>{O()},300)},p=async()=>{try{const V=await Qe("/api/item/getAiKnowledgeBaseConfig",{item_id:t.itemId});V.error_code===0&&V.data?(f.value=V.data,V.data.enabled?(e.value=!0,n.value=!!f.value.dialog_collapsed,n.value||x()):e.value=!1):e.value=!1}catch{e.value=!1}},w=()=>{n.value=!n.value,!n.value&&d.value.length===0&&x(),n.value||setTimeout(()=>{O()},100)},I=()=>{P(),n.value=!0},x=()=>{d.value=[];const V=f.value.welcome_message||o("ai.ai_welcome_message_default");V&&d.value.push({role:"assistant",content:V,sources:[]}),setTimeout(()=>{O()},100)},T=V=>{(V.ctrlKey||V.metaKey)&&V.key==="Enter"&&(V.preventDefault(),y())},y=async()=>{if(!C.value.trim()||b.value)return;const V=C.value.trim();C.value="",d.value.push({role:"user",content:V,sources:[]});const H={role:"assistant",content:"",sources:[]};d.value.push(H),b.value=!0,O();try{await k(V,H)}catch{H.content=o("ai.ai_error_message"),Ue.error(o("ai.ai_error_message"))}finally{b.value=!1,O()}},k=(V,H)=>new Promise(async(J,Y)=>{try{P(),h.value=new AbortController;const ae={item_id:t.itemId,question:V,stream:1};v.value&&(ae.conversation_id=v.value),r.userToken&&(ae.user_token=r.userToken);const ye=Ne()+"/api/ai/chat",ce=await fetch(ye,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"},body:JSON.stringify(ae),signal:h.value.signal});if(!ce.ok)throw new Error(`HTTP ${ce.status}: ${ce.statusText}`);const De=ce.body.getReader(),qe=new TextDecoder("utf-8");let we="";const Se=async()=>{try{const{value:ke,done:Oe}=await De.read();if(Oe){J();return}const Ke=qe.decode(ke,{stream:!0});we+=Ke;const Me=we.split(`

`);we=Me.pop()||"";for(const Ie of Me){if(!Ie.trim())continue;const Le=Ie.match(/^data: (.+)$/m);if(!Le)continue;const Ee=Le[1].trim();if(Ee)try{const Q=JSON.parse(Ee);if(Q.type==="token")H.content+=Q.content||"",O();else if(Q.type==="sources")H.sources=Q.sources||[];else if(Q.type==="done"){Q.conversation_id&&(v.value=Q.conversation_id),J();return}else if(Q.type==="error"){H.content=Q.message||o("ai.ai_error_message"),Y(new Error(Q.message||o("ai.ai_service_error")));return}}catch{}}await Se()}catch(ke){H.content===""&&(H.content=o("ai.ai_error_message")),Y(ke)}};await Se()}catch(ae){H.content===""&&(H.content=o("ai.ai_error_message")),Y(ae)}}),l=V=>V?V.replace(/```(\w*)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/^#\s+(.*)$/gm,"<h1>$1</h1>").replace(/^##\s+(.*)$/gm,"<h2>$1</h2>").replace(/^###\s+(.*)$/gm,"<h3>$1</h3>").replace(/^####\s+(.*)$/gm,"<h4>$1</h4>").replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>").replace(/^######\s+(.*)$/gm,"<h6>$1</h6>").replace(/\n/g,"<br>"):"",_=V=>{if(!V)return"";const H=Math.round(V*5);return"★".repeat(H)+"☆".repeat(5-H)},M=V=>{if(V.page_id&&t.itemId){const H=`/${t.itemId}/${V.page_id}`,J=window.location.origin+H;window.open(J,"_blank")}},N=()=>{d.value=[],v.value=null,x()},O=()=>{setTimeout(()=>{const V=g.value;V&&(V.scrollTop=V.scrollHeight)},100)},P=()=>{h.value&&(h.value.abort(),h.value=null)};return se(()=>t.itemId,V=>{V&&p()}),Z(()=>{t.itemId&&p(),window.addEventListener("scroll",a)}),de(()=>{P(),window.removeEventListener("scroll",a)}),(V,H)=>{const J=ee("a-textarea");return e.value?(u(),m("div",{key:0,class:R(["ai-chat-widget",{collapsed:n.value}]),style:X({bottom:`${$.value}px`})},[n.value?(u(),m("div",{key:0,class:"chat-button",onClick:w,title:V.$t("ai.ai_assistant_tooltip")},[...H[1]||(H[1]=[i("i",{class:"far fa-question-circle"},null,-1)])],8,Wn)):(u(),m("div",zn,[i("div",Un,[i("div",Fn,[H[2]||(H[2]=i("i",{class:"far fa-question-circle"},null,-1)),i("span",null,E(A.value),1)]),i("div",Gn,[i("i",{class:"fas fa-minus",onClick:w,title:V.$t("common.minimize")},null,8,Yn),i("i",{class:"fas fa-times",onClick:I,title:V.$t("common.close")},null,8,Jn)])]),i("div",Xn,[i("div",{class:"messages",ref_key:"messagesContainer",ref:g},[(u(!0),m(K,null,G(d.value,(Y,ae)=>(u(),m("div",{key:ae,class:R(["message",Y.role])},[i("div",Zn,[i("i",{class:R(Y.role==="user"?"fas fa-user":"fas fa-comments")},null,2)]),i("div",Qn,[i("div",{class:"message-text",innerHTML:l(Y.content)},null,8,es),Y.sources&&Y.sources.length>0?(u(),m("div",ts,[(u(!0),m(K,null,G(Y.sources,(he,ye)=>(u(),m("div",{key:ye,class:"source-item",onClick:ce=>M(he)},[H[3]||(H[3]=i("i",{class:"fas fa-file-alt"},null,-1)),i("span",null,E(he.page_title),1),i("span",ns,E(V.$t("ai.ai_relevance"))+": "+E(_(he.relevance)),1),H[4]||(H[4]=i("i",{class:"fas fa-external-link-alt"},null,-1))],8,os))),128))])):B("",!0)])],2))),128)),b.value?(u(),m("div",ss,[...H[5]||(H[5]=[i("div",{class:"message-avatar"},[i("i",{class:"far fa-question-circle"})],-1),i("div",{class:"message-content"},[i("div",{class:"typing-indicator"},[i("span"),i("span"),i("span")])],-1)])])):B("",!0)],512),i("div",as,[U(J,{value:C.value,"onUpdate:value":H[0]||(H[0]=Y=>C.value=Y),rows:3,placeholder:V.$t("ai.ai_input_placeholder"),onKeydown:T,"auto-size":{minRows:3,maxRows:6}},null,8,["value","placeholder"]),i("div",ls,[U(Ve,{theme:"dark",spinning:b.value,onClick:y,disabled:!C.value.trim()},{default:W(()=>[le(E(V.$t("common.send")),1)]),_:1},8,["spinning","disabled"]),U(Ve,{theme:"light",onClick:N},{default:W(()=>[le(E(V.$t("ai.ai_clear_history")),1)]),_:1})])])])]))],6)):B("",!0)}}});const Bs=q(is,[["__scopeId","data-v-86d35262"]]);export{ds as A,ms as C,Is as E,hs as L,gs as M,_s as P,ks as S,fs as T,q as _,ps as a,Ve as b,Vt as c,Te as d,ys as e,ws as f,bs as g,$s as h,Cs as i,xs as j,Ts as k,Ls as l,Es as m,Ms as n,Ss as o,Vs as p,je as q,Hs as r,Bs as s,vs as t};
