import{d as O,r as X,o as d,c as f,a as l,n as N,u as te,b as A,t as V,e as F,f as U,w as P,g as D,F as W,h as G,i as z,j as Y,k as ee,l as E,m as Z,p as me,q as ce,v as _e,T as Be,s as re,x as ze,y as Ae,z as ae,A as se,B as ne,C as ge,D as Re,E as ye,G as Ne,H as $e,I as Ue,J as Fe}from"./vendor-vue-f1f9849c.js";import{g as de,c as fe,d as pe,u as Ge,a as Ye,b as je,e as Je,s as Xe,f as Ze,h as Qe,i as De,j as et,r as tt}from"./core-16c66ae2.js";import{S as ot,V as nt}from"./vendor-8fa27e24.js";const st={class:"header-left"},at={key:0,class:"icon"},lt={class:"header-right"},it=O({__name:"ModalHeader",props:{icon:{},title:{},useClose:{type:Boolean,default:!0},useLine:{type:Boolean,default:!0}},emits:["close"],setup(n,{emit:c}){const t=n,o=c;return(a,i)=>{const e=X("a-tooltip");return d(),f("div",{class:N(["modal-header text-default",{"use-line":t.useLine}])},[l("div",st,[t.icon?(d(),f("div",at,[l("i",{class:N(te(de)(t.icon))},null,2)])):A("",!0),t.title?(d(),f("span",{key:1,class:N({marginLeftDefault:!t.icon})},V(t.title),3)):A("",!0),F(a.$slots,"left",{},void 0,!0)]),l("div",lt,[F(a.$slots,"right",{},void 0,!0),U(e,{mouseEnterDelay:.3,destroyTooltipOnHide:!0,title:"关闭"},{default:P(()=>[l("div",{class:"icon clickable",onClick:i[0]||(i[0]=r=>o("close"))},[l("i",{class:N(te(de)(["fas","xmark"]))},null,2)])]),_:1})])],2)}}});const K=(n,c)=>{const t=n.__vccOpts||n;for(const[o,a]of c)t[o]=a;return t},rt=K(it,[["__scopeId","data-v-7fbd3215"]]),ct={key:0,class:"header-buttons"},ut={class:"modal-body"},dt={key:0,class:"modal-footer"},mt=O({__name:"CommonModal",props:{show:{type:Boolean,default:!1},icon:{},title:{},useClose:{type:Boolean,default:!0},useLine:{type:Boolean,default:!0},width:{},maxWidth:{},minWidth:{},height:{},headerButtons:{}},emits:["close"],setup(n,{emit:c}){const t=n,o=c,a=D(()=>{const e={};return t.width?e.width=t.width:(t.maxWidth&&(e["--max-width"]=t.maxWidth),t.minWidth&&(e["--min-width"]=t.minWidth)),t.height&&(e.height=t.height),e});function i(e){if(Array.isArray(e)){const r=e[0],b=e[1];return b.startsWith("fa-")?`${r} ${b}`:`${r} fa-${b}`}return e}return(e,r)=>{const b=X("a-button");return d(),f("div",{class:N(["common-modal",{show:n.show}]),onWheel:r[2]||(r[2]=z(()=>{},["stop"]))},[l("div",{class:"modal-content",onClick:r[1]||(r[1]=z(()=>{},["stop"])),style:Y(a.value)},[U(rt,{icon:t.icon,title:t.title,useClose:t.useClose,useLine:t.useLine,onClose:r[0]||(r[0]=$=>o("close"))},{left:P(()=>[F(e.$slots,"left",{},void 0,!0)]),right:P(()=>[n.headerButtons&&n.headerButtons.length>0?(d(),f("div",ct,[(d(!0),f(W,null,G(n.headerButtons,($,p)=>(d(),ee(b,{key:p,type:$.type||"default",size:$.size||"small",danger:$.danger,onClick:z($.onClick,["stop"])},{default:P(()=>[$.icon?(d(),f("i",{key:0,class:N(i($.icon))},null,2)):A("",!0),$.text?(d(),f("span",{key:1,class:N({"ml-1":$.icon})},V($.text),3)):A("",!0)]),_:2},1032,["type","size","danger","onClick"]))),128))])):A("",!0),F(e.$slots,"right",{},void 0,!0)]),_:3},8,["icon","title","useClose","useLine"]),l("div",ut,[F(e.$slots,"default",{},void 0,!0)]),e.$slots.footer?(d(),f("div",dt,[F(e.$slots,"footer",{},void 0,!0)])):A("",!0)],4)],34)}}});const Se=K(mt,[["__scopeId","data-v-03b82cdb"]]),ft={class:"my-modal"},pt={class:"modal-content"},ht=["innerHTML"],vt={class:"modal-footer"},gt=O({__name:"index",props:{onClose:{type:Function},msg:{},dangerouslyUseHTMLString:{type:Boolean}},setup(n){const c=n,t=E(!1);Z(()=>{setTimeout(()=>{t.value=!0})});function o(){t.value=!1,setTimeout(()=>{c.onClose()},300)}return(a,i)=>(d(),f("div",ft,[U(Se,{class:N({show:t.value}),title:a.$t("common.tips"),icon:["fas","circle-info"],onClose:o},{default:P(()=>[l("div",pt,[l("div",{class:"text",innerHTML:(n.dangerouslyUseHTMLString,n.msg)},null,8,ht)]),l("div",vt,[l("div",{class:"primary-button",onClick:o},V(a.$t("common.confirm")),1)])]),_:1},8,["class","title"])]))}});const _t=K(gt,[["__scopeId","data-v-da82f992"]]);let Ce=!1;function fs(n="",c){return new Promise(t=>{if(Ce){t();return}Ce=!0;const{app:o,mountNode:a}=fe(_t,{msg:n,dangerouslyUseHTMLString:c==null?void 0:c.dangerouslyUseHTMLString,onClose:()=>{c!=null&&c.callback&&c.callback(),Ce=!1,t(),pe(o,a)}});o.mount(a)})}const yt=O({__name:"CommonTop",props:{visibilityHeight:{default:100},right:{default:40},bottom:{default:40},target:{type:[String,Function],default:()=>window}},setup(n){const c=n,t=E(!1),o=()=>typeof c.target=="function"?c.target():typeof c.target=="string"&&document.querySelector(c.target)||window,a=()=>{const e=o();e===window?window.scrollTo({top:0,behavior:"smooth"}):e.scrollTo({top:0,behavior:"smooth"})},i=()=>{const e=o();let r=0;e===window?r=window.pageYOffset||document.documentElement.scrollTop:r=e.scrollTop,t.value=r>=c.visibilityHeight};return Z(()=>{o().addEventListener("scroll",i)}),me(()=>{o().removeEventListener("scroll",i)}),(e,r)=>(d(),ee(Be,{name:"fade-up"},{default:P(()=>[ce(l("div",{class:"common-top",style:Y({right:`${n.right}px`,bottom:`${n.bottom}px`}),onClick:a},[...r[0]||(r[0]=[l("i",{class:"fas fa-arrow-up"},null,-1)])],4),[[_e,t.value]])]),_:1}))}});const ps=K(yt,[["__scopeId","data-v-16ea6f08"]]),wt=O({__name:"ThemeToggle",setup(n,{expose:c}){const t=Ge(),o=()=>{t.toggleTheme()};return c({appStore:t,handleToggle:o}),(a,i)=>(d(),f("div",{class:"theme-toggle",onClick:o},[F(a.$slots,"default",{},()=>[i[0]||(i[0]=l("i",{class:"fas fa-circle-half-stroke theme-icon"},null,-1))],!0)]))}});const hs=K(wt,[["__scopeId","data-v-315fcfff"]]),kt={class:"language-text"},bt=O({__name:"LanguageToggle",setup(n,{expose:c}){const{locale:t}=re(),o=D(()=>t.value==="zh-CN"?"中":"EN"),a=()=>{t.value=t.value==="zh-CN"?"en-US":"zh-CN",localStorage.setItem("locale",t.value),document.documentElement.lang=t.value},i=()=>{const e=localStorage.getItem("locale");if(e){t.value=e,document.documentElement.lang=e;return}const r=Ye();t.value=r,localStorage.setItem("locale",t.value),document.documentElement.lang=t.value};return i(),c({locale:t,handleToggle:a,initLanguage:i}),(e,r)=>(d(),f("div",{class:"language-toggle",onClick:a},[F(e.$slots,"default",{},()=>[r[0]||(r[0]=l("i",{class:"fas fa-globe language-icon"},null,-1)),l("span",kt,V(o.value),1)],!0)]))}});const vs=K(bt,[["__scopeId","data-v-1b987677"]]),$t=["value"],Ct=O({__name:"CommonInput",props:{modelValue:{}},emits:["update:modelValue"],setup(n,{emit:c}){const t=n,o=c;function a(i){const e=i.target;o("update:modelValue",e.value)}return(i,e)=>(d(),f("input",ze({class:"common-input",type:"text",value:t.modelValue},i.$attrs,{onInput:a}),null,16,$t))}});const gs=K(Ct,[["__scopeId","data-v-e2094272"]]),xt={class:"common-button-text"},Tt={key:1},St=O({__name:"CommonButton",props:{text:{},theme:{default:"light"},leftIcon:{},rightIcon:{},disabled:{type:Boolean,default:!1},spinning:{type:Boolean,default:!1},bold:{type:Boolean,default:!0},fullWidth:{type:Boolean,default:!1},type:{default:"default"},danger:{type:Boolean,default:!1}},setup(n){const c=n;function t(o){if(Array.isArray(o)){const a=o[0],i=o[1];return i.startsWith("fa-")?`${a} ${i}`:`${a} fa-${i}`}return o}return(o,a)=>{const i=X("a-spin");return d(),f("div",null,[U(i,{spinning:c.spinning,size:"small",delay:300},{default:P(()=>[l("div",{class:N(["common-button center",[c.theme,{disabled:c.disabled,"full-width":c.fullWidth}]]),style:Y({fontWeight:c.bold?"600":"normal"})},[c.leftIcon?(d(),f("i",{key:0,class:N(["icon",t(c.leftIcon)])},null,2)):A("",!0),l("div",xt,[o.$slots.default?F(o.$slots,"default",{key:0},void 0,!0):(d(),f("span",Tt,V(c.text),1))]),c.rightIcon?(d(),f("i",{key:1,class:N(["icon",t(c.rightIcon)])},null,2)):A("",!0)],6)]),_:3},8,["spinning"])])}}});const He=K(St,[["__scopeId","data-v-3b4674b2"]]),Mt={class:"my-modal"},It={class:"modal-content"},Lt={class:"text"},Et={class:"modal-footer"},Vt=O({__name:"index",props:{onClose:{type:Function},msg:{},title:{},OkText:{},cancelText:{},maxWidth:{}},setup(n){const{t:c}=re(),t=n,o=D(()=>t.OkText||c("common.confirm")),a=D(()=>t.cancelText||c("common.cancel")),i=E(!1);Z(()=>{setTimeout(()=>{i.value=!0})});function e(r){i.value=!1,setTimeout(()=>{t.onClose(r)},300)}return(r,b)=>(d(),f("div",Mt,[U(Se,{class:N({show:i.value}),title:t.title||r.$t("common.tips"),icon:["fas","circle-info"],maxWidth:t.maxWidth||"450px",onClose:e},{default:P(()=>[l("div",It,[l("div",Lt,V(n.msg),1)]),l("div",Et,[l("div",{class:"secondary-button",onClick:b[0]||(b[0]=$=>e(!1))},V(a.value),1),l("div",{class:"primary-button",onClick:b[1]||(b[1]=$=>e(!0))},V(o.value),1)])]),_:1},8,["class","title","maxWidth"])]))}});const Ht=K(Vt,[["__scopeId","data-v-834cb563"]]);let xe=!1;function Bt(n,c){let t="",o,a,i;return typeof n=="string"?(t=n,a=c):(t=n.msg,o=n.title,a=n.confirmText,i=n.cancelText),new Promise(e=>{if(xe){console.warn("[ConfirmModal] 已经有弹窗在显示，忽略新的调用"),e(!1);return}xe=!0;const{app:r,mountNode:b}=fe(Ht,{msg:t,title:o,OkText:a,cancelText:i,onClose:($=!1)=>{xe=!1,e($),pe(r,b)}});r.mount(b)})}const _s=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"})),At=["innerHTML"],Rt=O({__name:"Index",props:{message:{},timer:{},position:{},onCancel:{type:Function}},setup(n,{expose:c}){const t=n,o=E(!1);let a=null;Z(()=>{setTimeout(()=>{o.value=!0,t.timer&&(a=setTimeout(()=>{i()},t.timer))})});function i(){a&&(clearTimeout(a),a=null),o.value=!1,setTimeout(()=>{var e;(e=t.onCancel)==null||e.call(t)},300)}return c({hide:i}),(e,r)=>(d(),f("div",{class:N(["message",{show:o.value,"message-top":n.position==="top","message-bottom":n.position==="bottom"}]),onClick:i},[l("span",{class:"message-text",innerHTML:n.message},null,8,At),l("div",{class:"close-icon",onClick:z(i,["stop"])},[...r[0]||(r[0]=[l("i",{class:"fas fa-xmark"},null,-1)])])],2))}});const Nt=K(Rt,[["__scopeId","data-v-c8c79a20"]]);function ve(n){return new Promise(c=>{const{app:t,mountNode:o}=fe(Nt,{message:n.message,timer:n.timer??3e3,position:n.position??"top",onCancel:()=>{c(),pe(t,o)}});t.mount(o)})}const ys={success:(n,c,t)=>ve({message:n,timer:c,position:t}),error:(n,c,t)=>ve({message:n,timer:c,position:t}),info:(n,c,t)=>ve({message:n,timer:c,position:t}),show:n=>ve(n)},jt={class:"my-modal"},Dt={class:"modal-content"},qt={class:"input-wrapper"},Ot=["placeholder"],Kt={class:"modal-footer"},Pt=O({__name:"index",props:{onClose:{},input:{default:""},title:{default:"请输入"},desc:{default:""},placeholder:{default:"请输入内容"}},setup(n){re();const c=n,t=E(!1),o=E(""),a=E();Z(()=>{o.value=c.input||"",setTimeout(()=>{t.value=!0,setTimeout(()=>{var e;(e=a.value)==null||e.focus()},100)})});function i(e=""){t.value=!1,setTimeout(()=>{c.onClose(e)},300)}return(e,r)=>(d(),f("div",jt,[U(Se,{class:N({show:t.value}),title:c.title,icon:["fas","circle-info"],onClose:i},{default:P(()=>[l("div",Dt,[l("div",qt,[ce(l("input",{ref_key:"inputRef",ref:a,type:"text","onUpdate:modelValue":r[0]||(r[0]=b=>o.value=b),placeholder:n.placeholder,class:"prompt-input"},null,8,Ot),[[Ae,o.value]])])]),l("div",Kt,[l("div",{class:"secondary-button",onClick:r[1]||(r[1]=b=>i())},V(e.$t("common.cancel")),1),l("div",{class:"primary-button",onClick:r[2]||(r[2]=b=>i(o.value))},V(e.$t("common.confirm")),1)])]),_:1},8,["class","title"])]))}});const Wt=K(Pt,[["__scopeId","data-v-ba3f4f99"]]);let Te=!1;function ws(n="",c="",t=""){return new Promise(o=>{if(Te){console.warn("[PromptModal] 已经有弹窗在显示，忽略新的调用"),o("");return}Te=!0;const{app:a,mountNode:i}=fe(Wt,{title:n,input:c,placeholder:t,onClose:e=>{Te=!1,o(e||""),pe(a,i)}});a.mount(i)})}const zt={key:0,class:"text-secondary"},Ut={key:0,class:"loading-container"},Ft={class:"loading-text"},Gt={key:1,class:"empty-container"},Yt={class:"empty-text"},Jt={key:2,class:"table-container"},Xt={key:0,class:"selection-col"},Zt=["checked","indeterminate"],Qt=["onClick"],eo=["checked","onChange"],to={key:0,class:"tools"},oo=["onClick"],no={key:1,class:"pagination-container"},so={class:"pagination-info"},ao={class:"pagination-controls"},lo=["disabled"],io={class:"pagination-page"},ro=["disabled"],co=O({__name:"CommonTable",props:{tableHeader:{},tableData:{},pagination:{type:[Object,Boolean],default:!1},rowSelection:{type:[Object,Boolean],default:!1},loading:{type:Boolean,default:!1},rowKey:{},rowClickable:{type:Boolean,default:!1},maxHeight:{default:"calc(100vh - 400px)"},typeField:{default:""},typeFieldMapping:{default:()=>({})},emptyText:{},dataSource:{default:"server"}},emits:["rowClick","pageChange","selectionChange"],setup(n,{emit:c}){const{t}=re(),o=n,a=c,i=D(()=>o.pagination?o.pagination:null),e=D(()=>i.value?Math.ceil(i.value.total/i.value.pageSize):1),r=D(()=>i.value?(i.value.current-1)*i.value.pageSize+1:1),b=D(()=>{if(!i.value)return o.tableData.length;const k=i.value.current*i.value.pageSize;return Math.min(k,i.value.total)}),$=D(()=>typeof o.emptyText=="function"?o.emptyText():o.emptyText||t("common.no_data")),p=D(()=>{if(o.dataSource==="server"||!i.value)return o.tableData;const{current:k,pageSize:x}=i.value,v=(k-1)*x,g=v+x;return o.tableData.slice(v,g)}),_=D(()=>o.rowSelection?o.rowSelection:null),m=D(()=>_.value?_.value.selectedRowKeys||[]:[]),h=D(()=>!_.value||p.value.length===0?!1:p.value.every((k,x)=>C(k,x))),S=D(()=>{if(!_.value)return!1;const k=p.value.filter((x,v)=>C(x,v)).length;return k>0&&k<p.value.length});function H(k,x){return typeof o.rowKey=="function"?o.rowKey(k,x):typeof o.rowKey=="string"?k[o.rowKey]:x}function C(k,x){if(!_.value)return!1;const v=H(k,x);return m.value.includes(v)}function L(k,x,v){if(!_.value)return;const g=v.target.checked,u=H(k,x);let y=[...m.value];g?y.includes(u)||y.push(u):y=y.filter(B=>B!==u);const M=o.tableData.filter((B,q)=>{const j=H(B,q);return y.includes(j)});_.value.onChange&&_.value.onChange(y,M),a("selectionChange",y,M)}function s(k){if(!_.value)return;const x=k.target.checked;let v=[];if(x)v=p.value.map((u,y)=>H(u,y)),v=Array.from(new Set([...m.value,...v]));else{const u=p.value.map((y,M)=>H(y,M));v=m.value.filter(y=>!u.includes(y))}const g=o.tableData.filter((u,y)=>{const M=H(u,y);return v.includes(M)});_.value.onChange&&_.value.onChange(v,g),a("selectionChange",v,g)}function w(k,x){o.rowClickable&&a("rowClick",k,x)}function T(k){i.value&&a("pageChange",k,i.value.pageSize)}return(k,x)=>(d(),f("div",{class:N(["common-table-wrapper",{"with-pagination":n.pagination}])},[k.$slots.renderHeader?(d(),f("header",zt,[F(k.$slots,"renderHeader",{},void 0,!0)])):A("",!0),l("main",{style:Y({maxHeight:n.maxHeight})},[n.loading?(d(),f("div",Ut,[l("div",Ft,V(te(t)("common.loading")),1)])):p.value.length===0?(d(),f("div",Gt,[l("div",Yt,V($.value),1)])):(d(),f("div",Jt,[l("table",null,[l("thead",null,[l("tr",null,[n.rowSelection?(d(),f("th",Xt,[l("input",{type:"checkbox",checked:h.value,indeterminate:S.value,onChange:s},null,40,Zt)])):A("",!0),(d(!0),f(W,null,G(o.tableHeader,(v,g)=>(d(),f("th",{key:g,style:Y(v.width?{"min-width":v.width+"px",width:v.width+"px"}:{}),class:N({center:v.center})},V(v.title),7))),128))])]),l("tbody",null,[(d(!0),f(W,null,G(p.value,(v,g)=>(d(),f("tr",{key:H(v,g),class:N({"row-selected":C(v,g),"row-clickable":n.rowClickable}),onClick:u=>w(v,g)},[n.rowSelection?(d(),f("td",{key:0,class:"selection-col",onClick:x[0]||(x[0]=z(()=>{},["stop"]))},[l("input",{type:"checkbox",checked:C(v,g),onChange:u=>L(v,g,u)},null,40,eo)])):A("",!0),(d(!0),f(W,null,G(o.tableHeader,(u,y)=>(d(),f("td",{key:`${g}-${y}`,style:Y(u.width?{"min-width":u.width+"px",width:u.width+"px"}:{}),class:N({center:u.center})},[F(k.$slots,`cell-${u.key}`,{row:v,column:u,index:g,value:v[u.key]},()=>[u.tools?(d(),f("div",to,[(d(!0),f(W,null,G(v.tools,(M,B)=>(d(),f("div",{class:"tools-item clickable",key:`${g}-${y}-${B}`,onClick:q=>M.onclick(v)},V(M.name),9,oo))),128))])):(d(),f(W,{key:1},[ae(V(v[u.key]),1)],64))],!0)],6))),128))],10,Qt))),128))])])]))],4),n.pagination?(d(),f("div",no,[l("div",so,V(te(t)("common.pagination_info",{start:r.value,end:b.value,total:n.pagination.total})),1),l("div",ao,[l("button",{class:"pagination-btn",disabled:n.pagination.current===1,onClick:x[1]||(x[1]=v=>T(n.pagination.current-1))},V(te(t)("common.prev_page")),9,lo),l("span",io,V(n.pagination.current)+" / "+V(e.value),1),l("button",{class:"pagination-btn",disabled:n.pagination.current>=e.value,onClick:x[2]||(x[2]=v=>T(n.pagination.current+1))},V(te(t)("common.next_page")),9,ro)])])):A("",!0)],2))}});const ks=K(co,[["__scopeId","data-v-cf0b7051"]]),uo=["onClick"],mo={class:"line-container"},fo={class:"item-container"},po=["src"],ho={class:"text"},vo={key:0,class:"checked"},go={key:1,class:"arrow text-default"},_o=O({__name:"Children",props:{show:Boolean,itemRef:Object,scrollOffset:Number,list:Object},emits:["close","mouseenter","mouseleave"],setup(n,{emit:c}){const t=n,o=c,a=E(),i=E(0),e=E(0);function r(){if(!t.itemRef||!a.value)return;const _=t.itemRef.getBoundingClientRect(),m=a.value.clientWidth,h=a.value.clientHeight,S=document.body.clientWidth,H=document.body.clientHeight;let C=_.right,L=_.top;C+m>S-5&&(C=_.left-m),L+h>H-5&&(L=H-h-5),L<5&&(L=5),i.value=L,e.value=C}se(()=>t.show,_=>{_&&ne(()=>{r()})}),se(()=>t.scrollOffset,()=>{t.show&&r()});function b(){o("mouseenter")}function $(){o("mouseleave")}function p(_){_.children||(_.onclick&&_.onclick(),o("close"))}return(_,m)=>t.show?(d(),f("div",{key:0,class:"children-container",ref_key:"contextmenuRef",ref:a,style:Y({top:`${i.value}px`,left:`${e.value}px`}),onClick:m[2]||(m[2]=z(()=>{},["stop"])),onMouseenter:b,onMouseleave:$},[(d(!0),f(W,null,G(t.list,(h,S)=>ce((d(),f("div",{class:"contextmenu-item bgColor-select",key:S,onClick:H=>p(h),onDblclick:m[0]||(m[0]=z(()=>{},["stop"])),onContextmenu:m[1]||(m[1]=z(()=>{},["stop"]))},[l("div",mo,[l("div",fo,[h.img?(d(),f("img",{key:0,class:"img",src:h.img},null,8,po)):A("",!0),h.icon?(d(),f("div",{key:1,class:"icon",style:Y(h.iconStyle)},[l("i",{class:N(te(de)(h.icon))},null,2)],4)):A("",!0),l("div",ho,V(h.text),1)]),h.checked?(d(),f("div",vo,[...m[3]||(m[3]=[l("i",{class:"fas fa-check"},null,-1)])])):A("",!0),h.children&&h.children.length?(d(),f("div",go,[...m[4]||(m[4]=[l("i",{class:"fas fa-angle-right"},null,-1)])])):A("",!0)])],40,uo)),[[_e,!h.hidden]])),128))],36)):A("",!0)}});const yo=K(_o,[["__scopeId","data-v-b32906a2"]]),wo={class:"column"},ko=["onClick","onMouseenter","onMouseleave"],bo={class:"line-container text-default"},$o={class:"item-container"},Co=["src"],xo={key:1,class:"icon"},To={class:"text"},So={key:0,class:"shortcut text-secondary"},Mo={key:1,class:"checked"},Io={key:2,class:"arrow text-secondary"},Lo=O({__name:"index",props:{x:Number,y:Number,list:Object,onCancel:Function},setup(n){const c=n,t=E(!1),o=E(),a=E(0),i=E(0),e=E(0),r=E(0),b=new Map,$=E(null);let p=null;function _(g,u){g?b.set(u,g):b.delete(u)}function m(g){p&&(clearTimeout(p),p=null),p=window.setTimeout(()=>{$.value=g},200)}function h(g){p&&(clearTimeout(p),p=null),p=window.setTimeout(()=>{$.value===g&&($.value=null)},100)}function S(g){p&&(clearTimeout(p),p=null),$.value=g}function H(g){p&&(clearTimeout(p),p=null),p=window.setTimeout(()=>{$.value===g&&($.value=null)},100)}function C(g){const u=new Set,y=[];return g.forEach(M=>{if(M.shortcut&&!M.children){const B=M.shortcut.toLowerCase().replace(/^ctrl\+|^shift\+|^alt\+/g,"");/^[a-z]$/.test(B)&&u.add(B)}}),g.forEach(M=>{const B={...M};if(M.children&&M.children.length>0){y.push(B);return}if(M.shortcut){y.push(B);return}let q=null;const le=(M.text||"").match(/[a-zA-Z]/);if(le){const I=le[0].toLowerCase();u.has(I)||(q=I,u.add(I))}if(!q)for(let I=0;I<26;I++){const R=String.fromCharCode(97+I);if(!u.has(R)){q=R,u.add(R);break}}q&&(B.shortcut=q),y.push(B)}),y}const L=D(()=>{const u=(c.list||[]).filter(y=>!y.hidden);return C(u)});function s(g){return g.replace(/Ctrl\+/gi,"Ctrl+").replace(/Shift\+/gi,"Shift+").replace(/Alt\+/gi,"Alt+").replace(/Delete/gi,"Del").replace(/Enter/gi,"Enter")}function w(g){const u=g.toLowerCase().split("+").map(j=>j.trim()),y=u[u.length-1],M=u.includes("ctrl"),B=u.includes("shift"),q=u.includes("alt");return j=>{if(/^[a-z]$/.test(y))return j.key.toLowerCase()===y.toLowerCase()?!M&&!B&&!q?!j.ctrlKey&&!j.shiftKey&&!j.altKey&&!j.metaKey:(!M||j.ctrlKey)&&(!B||j.shiftKey)&&(!q||j.altKey):!1;const I=j.key.toLowerCase(),R=y.toLowerCase();let oe=!1;return R==="delete"||R==="del"?oe=I==="delete"||I==="del":oe=I===R,oe&&j.ctrlKey===M&&j.shiftKey===B&&j.altKey===q}}function T(g){if(t.value&&!(g.key==="Control"||g.key==="Shift"||g.key==="Alt"||g.key==="Meta")){for(const u of L.value)if(u.shortcut&&!u.children&&u.onclick&&w(u.shortcut)(g)){g.preventDefault(),g.stopPropagation(),k(u);return}}}Z(()=>{const g=document.body.clientWidth||window.innerWidth,u=document.body.clientHeight||window.innerHeight;let y=c.y||0,M=c.x||0;o.value&&(o.value.clientHeight+y>u-5&&(y=u-o.value.clientHeight-5),o.value.clientWidth+M>g-5&&(M=g-o.value.clientWidth-5),e.value=o.value.clientWidth),a.value=y,i.value=M,setTimeout(()=>{t.value=!0}),document.addEventListener("keydown",T)}),me(()=>{document.removeEventListener("keydown",T),p&&(clearTimeout(p),p=null)});function k(g){g.children||(x(),g.onclick&&g.onclick())}function x(){t.value=!1,setTimeout(()=>{var g;(g=c.onCancel)==null||g.call(c)},100)}function v(g){const u=g.target;r.value=u.scrollTop}return(g,u)=>{const y=X("a-tooltip");return d(),f("div",{class:N(["contextmenu-modal",{show:t.value}]),onClick:z(x,["stop"]),onDblclick:z(x,["stop"]),onContextmenu:z(x,["stop"])},[l("div",{class:"container",ref_key:"contextmenuRef",ref:o,style:Y({top:`${a.value}px`,left:`${i.value}px`}),onClick:u[2]||(u[2]=z(()=>{},["stop"])),onScroll:v},[l("div",wo,[(d(!0),f(W,null,G(L.value,(M,B)=>(d(),ee(y,{key:B,title:M.tooltip,placement:"right","mouse-enter-delay":.5},{default:P(()=>[ce(l("div",{class:"contextmenu-item bgColor-select",onClick:q=>k(M),onDblclick:u[0]||(u[0]=z(()=>{},["stop"])),onContextmenu:u[1]||(u[1]=z(()=>{},["stop"])),ref_for:!0,ref:q=>_(q,B),onMouseenter:()=>m(B),onMouseleave:()=>h(B)},[l("div",bo,[l("div",$o,[M.img?(d(),f("img",{key:0,class:"img",src:M.img},null,8,Co)):A("",!0),M.icon?(d(),f("div",xo,[l("i",{class:N(te(de)(M.icon))},null,2)])):A("",!0),l("div",To,V(M.text),1),M.children&&M.children.length?(d(),ee(ge,{key:2,to:"body"},[U(yo,{show:$.value===B,itemRef:te(b).get(B),scrollOffset:r.value,list:M.children,onClose:x,onMouseenter:()=>S(B),onMouseleave:()=>H(B)},null,8,["show","itemRef","scrollOffset","list","onMouseenter","onMouseleave"])])):A("",!0)]),M.shortcut&&!M.children?(d(),f("div",So,V(s(M.shortcut)),1)):A("",!0),M.checked?(d(),f("div",Mo,[...u[3]||(u[3]=[l("i",{class:"fas fa-check"},null,-1)])])):A("",!0),M.children&&M.children.length?(d(),f("div",Io,[...u[4]||(u[4]=[l("i",{class:"fas fa-angle-right"},null,-1)])])):A("",!0)])],40,ko),[[_e,!M.hidden]])]),_:2},1032,["title"]))),128))])],36)],34)}}});const Eo=K(Lo,[["__scopeId","data-v-380fc989"]]);function qe({x:n=0,y:c=0,list:t=[]}){const{app:o,mountNode:a}=fe(Eo,{x:n,y:c,list:t,onCancel:()=>{pe(o,a)}});o.mount(a)}const Vo={class:"common-type-selector"},Ho=O({__name:"CommonSelector",props:{selectorLabel:{},selectorValue:{type:[String,Number,Boolean]},options:{},placeholder:{},value:{type:[String,Number,Boolean,Array]},showSearch:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},searchThreshold:{default:10}},emits:["update:selectorLabel","update:selectorValue","update:value","change"],setup(n,{emit:c}){const t=n,o=c,a=D(()=>{var C;return t.multiple||t.showSearch||(((C=t.options)==null?void 0:C.length)||0)>t.searchThreshold}),i=D(()=>t.options.map(C=>({label:C.label,value:String(C.value),originalValue:C.value}))),e=D(()=>{if(!a.value){if(t.selectorLabel)return t.selectorLabel;const C=t.value!==void 0?t.value:t.selectorValue;if(C!==void 0){const L=m(C);if(L)return L.label}return t.placeholder||"点此选择"}return""}),r=D(()=>(t.multiple,"请选择")),b=D({get:()=>{if(a.value){if(t.value!==void 0)return t.multiple&&Array.isArray(t.value)?t.value.map(C=>$(C)):$(t.value);if(t.selectorValue!==void 0)return $(t.selectorValue)}},set:C=>{if(!a.value)return;const L=p(C);if(o("update:value",L),!t.multiple){const s=m(L);s&&(o("update:selectorLabel",s.label),o("update:selectorValue",s.value))}}});function $(C){return String(C)}function p(C){return Array.isArray(C)?C.map(L=>_(L)):_(C)}function _(C){const L=t.options.find(w=>$(w.value)===C);if(L)return L.value;if(C==="true")return!0;if(C==="false")return!1;const s=Number(C);return!isNaN(s)&&C!==""?s:C}function m(C){const L=$(C);return t.options.find(s=>$(s.value)===L)}function h(C,L){return L.label.toLowerCase().includes(C.toLowerCase())}function S(C){qe({x:C.x,y:C.y,list:t.options.map(L=>({text:L.label,onclick:()=>{o("update:selectorLabel",L.label),o("update:selectorValue",L.value),o("update:value",L.value),o("change",L.value,L)}}))})}function H(C,L){const s=p(C);o("change",s,L)}return(C,L)=>{const s=X("a-select");return d(),f("div",Vo,[a.value?(d(),ee(s,{key:1,value:b.value,"onUpdate:value":L[0]||(L[0]=w=>b.value=w),placeholder:n.placeholder||r.value,"show-search":n.showSearch,mode:n.multiple?"multiple":void 0,options:i.value,"filter-option":h,class:"ant-select-mode",onChange:H},null,8,["value","placeholder","show-search","mode","options"])):(d(),f("div",{key:0,class:"contextmenu-mode text-default clickable center",onClick:S},[ae(V(e.value)+"   ",1),L[1]||(L[1]=l("i",{class:"fas fa-angle-down"},null,-1))]))])}}});const bs=K(Ho,[["__scopeId","data-v-22c901a5"]]),Bo={key:0,class:"more-card-header"},Ao={class:"group-bar"},Ro=["onMousedown"],No={class:"more-card-item-left"},jo={class:"more-card-item-icon"},Do={class:"more-card-item-right"},qo={class:"right-div"},Oo={class:"title"},Ko={class:"desc"},Po=["onMousedown"],Wo={class:"more-card-item-left"},zo={class:"more-card-item-icon"},Uo={class:"more-card-item-right"},Fo={class:"right-div"},Go={class:"title"},Yo={class:"desc"},Jo=O({__name:"SDropdown",props:{width:{default:"300px"},title:{default:""},titleIcon:{default:"fas fa-cubes"},placement:{default:"bottomLeft"},menuList:{default:()=>[]},menuListGroup:{default:()=>[]}},setup(n){const c=E(!1),t=o=>{c.value=!1,o.method&&o.method()};return(o,a)=>{const i=X("a-popover");return d(),ee(i,{open:c.value,"onUpdate:open":a[0]||(a[0]=e=>c.value=e),placement:n.placement,trigger:"hover",overlayStyle:{zIndex:999}},{content:P(()=>[l("div",{class:"more-card",style:Y({width:n.width})},[n.title?(d(),f("div",Bo,[l("i",{class:N([n.titleIcon,"mr-3"])},null,2),l("span",null,V(n.title),1)])):A("",!0),n.menuListGroup?(d(!0),f(W,{key:1},G(n.menuListGroup,e=>(d(),f(W,{key:e.group_name},[l("div",Ao,V(e.group_name),1),(d(!0),f(W,null,G(e.listMenu,r=>(d(),f("div",{key:r.title,class:"more-card-item",onMousedown:z(b=>t(r),["prevent"])},[l("div",No,[l("div",jo,[l("i",{class:N(r.icon)},null,2)])]),l("div",Do,[l("div",qo,[l("div",Oo,V(r.title),1),l("div",Ko,V(r.desc),1)])])],40,Ro))),128))],64))),128)):A("",!0),n.menuList?(d(!0),f(W,{key:2},G(n.menuList,e=>(d(),f("div",{key:e.title,class:"more-card-item",onMousedown:z(r=>t(e),["prevent"])},[l("div",Wo,[l("div",zo,[l("i",{class:N(e.icon)},null,2)])]),l("div",Uo,[l("div",Fo,[l("div",Go,V(e.title),1),l("div",Yo,V(e.desc),1)])])],40,Po))),128)):A("",!0)],4)]),default:P(()=>[F(o.$slots,"default",{},void 0,!0)]),_:3},8,["open","placement"])}}});const $s=K(Jo,[["__scopeId","data-v-d5568c64"]]),Xo={key:0,class:"common-switch-wrapper"},Zo={key:0,class:"fas fa-toggle-on"},Qo={key:1,class:"fas fa-toggle-off"},en={class:"switch-label"},tn={key:0,class:"fas fa-toggle-on"},on={key:1,class:"fas fa-toggle-off"},nn=O({__name:"CommonSwitch",props:{modelValue:{type:[String,Number,Boolean]},label:{},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(n,{emit:c}){const t=n,o=c,a=D(()=>typeof t.modelValue=="boolean"?t.modelValue:t.modelValue==1);function i(){if(t.disabled)return;let e;typeof t.modelValue=="boolean"?(e=!a.value,o("update:modelValue",e)):typeof t.modelValue=="number"?(e=a.value?0:1,o("update:modelValue",e)):(e=a.value?"0":"1",o("update:modelValue",e)),o("change",e)}return(e,r)=>n.label?(d(),f("div",Xo,[l("div",{class:N(["common-switch text-secondary clickable",{checked:a.value,disabled:n.disabled}]),onClick:i},[a.value?(d(),f("i",Zo)):(d(),f("i",Qo))],2),l("span",en,V(n.label),1)])):(d(),f("div",{key:1,class:N(["common-switch text-secondary clickable",{checked:a.value,disabled:n.disabled}]),onClick:i},[a.value?(d(),f("i",tn)):(d(),f("i",on))],2))}});const Cs=K(nn,[["__scopeId","data-v-ae08fb5d"]]),sn={class:"dropdown-column"},an=["onClick"],ln={class:"item-content"},rn={key:0,class:"item-icon"},cn={class:"item-text"},xs=O({__name:"CommonDropdownMenu",props:{list:{},trigger:{default:"hover"},placement:{default:"top"},offsetX:{default:0}},emits:["select"],setup(n,{emit:c}){const t=n,o=c,a=E(!1),i=E(null),e=E({top:0,left:0});let r=null,b=!1,$=!1;const p=D(()=>{if(t.placement==="right")return{top:`${e.value.top}px`,left:`${e.value.left}px`,transform:"translateY(-50%)"};let v="-100%";return t.placement==="bottom"&&(v="0"),{top:`${e.value.top}px`,left:`${e.value.left}px`,transform:`translateX(-50%) translateY(${v})`,"--dropdown-translate-y":v}}),_=()=>{if(!i.value)return;const v=i.value.getBoundingClientRect();t.placement==="right"?e.value={top:v.top+v.height/2,left:v.right+8+t.offsetX}:t.placement==="top"?e.value={top:v.top-8,left:v.left+v.width/2+t.offsetX}:e.value={top:v.bottom+8,left:v.left+v.width/2+t.offsetX}},m=()=>{r&&(clearTimeout(r),r=null),_(),a.value=!0},h=()=>{!b&&!$&&(a.value=!1)},S=()=>{r&&clearTimeout(r),r=window.setTimeout(h,100)},H=()=>{t.trigger==="hover"&&(b=!0,m())},C=()=>{t.trigger==="hover"&&(b=!1,S())},L=()=>{t.trigger==="hover"&&($=!0,r&&(clearTimeout(r),r=null))},s=()=>{t.trigger==="hover"&&($=!1,S())},w=()=>{a.value?a.value=!1:(_(),a.value=!0)},T=()=>{a.value=!1},k=v=>{a.value=!1,o("select",v)},x=v=>{if(t.trigger!=="click"||!a.value)return;const g=v.target;!g.closest(".common-dropdown-menu")&&!g.closest(".dropdown-menu-container")&&(a.value=!1)};return Z(()=>{t.trigger==="click"&&document.addEventListener("click",x)}),me(()=>{r&&clearTimeout(r),document.removeEventListener("click",x)}),(v,g)=>(d(),f("div",{ref_key:"containerRef",ref:i,class:"common-dropdown-menu",onMouseenter:H,onMouseleave:C},[l("div",{class:"trigger-button",onClick:g[0]||(g[0]=u=>n.trigger==="click"&&w())},[F(v.$slots,"default",{},()=>[g[1]||(g[1]=l("div",{class:"default-trigger"},[l("i",{class:"fas fa-ellipsis"})],-1))])]),(d(),ee(ge,{to:"body"},[a.value?(d(),f("div",{key:0,class:N(["dropdown-menu-container",`placement-${t.placement}`]),style:Y(p.value),onMouseenter:L,onMouseleave:s},[l("div",sn,[(d(!0),f(W,null,G(n.list,(u,y)=>(d(),f("div",{class:"dropdown-item",key:y,onClick:M=>k(u)},[l("div",ln,[u.icon?(d(),f("div",rn,[l("i",{class:N(te(de)(u.icon))},null,2)])):A("",!0),l("div",cn,V(u.text),1)])],8,an))),128))])],38)):A("",!0)])),(d(),ee(ge,{to:"body"},[a.value&&n.trigger==="click"?(d(),f("div",{key:0,class:"dropdown-overlay",onClick:T})):A("",!0)]))],544))}});const un=["innerHTML"],dn=O({__name:"TextHighlight",props:{queries:{}},setup(n){const c=n,t=Re(),o=D(()=>{const i=t.default?t.default():"";return Array.isArray(i)&&i.length>0&&i[0].children||""}),a=D(()=>{if(!c.queries||c.queries.length===0)return o.value;let i=o.value;return c.queries.forEach(e=>{if(!e)return;const r=new RegExp(`(${e})`,"gi");i=i.replace(r,"<mark>$1</mark>")}),i});return(i,e)=>(d(),f("span",{innerHTML:a.value},null,8,un))}});const Ts=K(dn,[["__scopeId","data-v-3c842dc2"]]),mn=O({__name:"SortableList",props:{handle:{},animate:{default:100},listClass:{},tag:{default:"div"}},emits:["drag","drop"],setup(n,{emit:c}){const t=n,o=c,a=E(null),i=E(0);let e=null;const r=()=>{var $;if(!a.value)return;const b=t.tag?a.value.querySelector(t.tag):($=a.value)==null?void 0:$.firstElementChild;b&&(e=ot.create(b,{handle:t.handle,animation:t.animate,ghostClass:"sortable-ghost",dragClass:"sortable-drag",chosenClass:"sortable-chosen",onStart:()=>{o("drag")},onEnd:p=>{const{newIndex:_,oldIndex:m}=p;o("drop",{oldIndex:m,newIndex:_})}}))};return Z(()=>{ne(()=>{r()})}),se(()=>t.handle,()=>{ne(()=>{e&&e.destroy(),r()})}),se(()=>t.animate,()=>{ne(()=>{e&&e.destroy(),r()})}),se(()=>t.tag,()=>{ne(()=>{e&&e.destroy(),r()})}),ye(()=>{e&&e.destroy()}),(b,$)=>(d(),f("div",{class:"sortable-list",ref_key:"wrapper",ref:a},[(d(),f("div",{key:i.value,class:N(n.listClass)},[F(b.$slots,"default",{},void 0,!0)],2))],512))}});const Ss=K(mn,[["__scopeId","data-v-0ddcf022"]]),Ms=O({__name:"Notify",props:{popup:{type:Boolean}},setup(n){const{t:c}=re(),t=Ne(),o=je(),a=n,i=E(a.popup!==void 0?a.popup:!0),e=E(null);let r=E(null);const b=async()=>{try{const h=(await Je()).data;if(h.remind&&h.remind.id&&(o.setNewMsg(1),i.value)){let S="";if(h.remind.object_type=="vip"){S=c("message.vip_expiring_notice");const s=t.resolve({path:"/user/setting"}).href;p(S,h.remind.from_uid,h.remind.message_content_id,s);return}h.remind.action_type=="comment"||h.remind.action_type=="comment_reply"?S=h.remind.message_content||h.remind.from_name+" "+c("message.publish_comment"):S=h.remind.from_name+" "+c("message.update_the_page")+" "+h.remind.page_data.page_title+" , "+c("message.click_to_view");const C=t.resolve({path:"/message/index",query:{dtab:"remindList"}}).href;p(S,h.remind.from_uid,h.remind.message_content_id,C)}if(h.announce&&h.announce.id&&(o.setNewMsg(1),i.value)){const S=c("message.you_have_unread_announcement"),C=t.resolve({path:"/message/index",query:{dtab:"announcementList"}}).href;p(S,h.announce.from_uid,h.announce.message_content_id,C)}}catch(m){console.error("[Notify] 获取未读消息失败:",m)}},$=(m,h,S,H)=>{const C=h+"_"+S;r.value=C,$e.open({message:"ShowDoc "+c("message.notification"),description:m,duration:0,key:C,placement:"topRight",onClick:()=>{window.open(H,"_blank"),$e.close(C)},onClose:()=>{_(h,S)}})},p=(m,h,S,H)=>{if(!i.value)return!1;const C="ShowDoc "+c("message.notification"),L={dir:"auto",body:m,requireInteraction:!0,tag:h+"_"+S};if(!("Notification"in window)){console.log("浏览器不支持系统通知，使用 web 弹窗通知"),$(m,h,S,H);return}let s=null;Notification.permission==="granted"?(s=new Notification(C,L),s.onclick=()=>{window.open(H,"_blank"),_(h,S),window.focus(),s.close()}):Notification.permission==="default"?($(m,h,S,H),Notification.requestPermission().then(w=>{if(w==="granted"){console.log("用户同意授权");const T=h+"_"+S;$e.close(T),s=new Notification(C,L),s.onclick=()=>{window.open(H,"_blank"),_(h,S),window.focus(),s.close()}}else w==="default"?console.warn("用户关闭授权 未刷新页面之前 可以再次请求授权"):console.log("用户拒绝授权，继续使用 web 弹窗通知")})):(console.log("用户曾经拒绝显示通知，使用 web 弹窗通知"),$(m,h,S,H))},_=async(m,h)=>{o.setNewMsg(0),setTimeout(async()=>{try{await Xe({from_uid:m,message_content_id:h})}catch(S){console.error("设置已读失败:",S)}},2e3)};return Z(()=>{setTimeout(()=>{b()},2e3),e.value=window.setInterval(()=>{b()},60*60*1e3)}),me(()=>{e.value&&clearInterval(e.value)}),(m,h)=>(d(),f("div"))}}),fn={class:"editor-modal-content"},pn=O({__name:"EditorModal",props:{show:{type:Boolean,default:!1},maskClosable:{type:Boolean,default:!1}},emits:["close"],setup(n,{emit:c}){const t=n,o=c;se(()=>t.show,i=>{i?document.body.style.overflow="hidden":document.body.style.overflow=""}),ye(()=>{document.body.style.overflow=""});const a=()=>{t.maskClosable&&o("close")};return(i,e)=>(d(),ee(ge,{to:"body"},[U(Be,{name:"editor-modal"},{default:P(()=>[n.show?(d(),f("div",{key:0,class:"editor-modal",onWheel:e[0]||(e[0]=z(()=>{},["stop"])),onClick:z(a,["self"])},[l("div",fn,[F(i.$slots,"default",{},void 0,!0)])],32)):A("",!0)]),_:3})]))}});const Is=K(pn,[["__scopeId","data-v-89a98573"]]),hn={class:"text"},vn=O({__name:"MenuButton",props:{text:{},theme:{default:"light"},list:{},spinning:{type:Boolean,default:!1},leftIcon:{},onClick:{}},setup(n){const c=n;function t(i){if(Array.isArray(i)){const e=i[0],r=i[1];return r.startsWith("fa-")?`${e} ${r}`:`${e} fa-${r}`}return i}function o(i){qe({x:i.x,y:i.y,list:c.list})}function a(){c.onClick&&c.onClick()}return(i,e)=>{const r=X("a-spin");return d(),f("div",null,[U(r,{spinning:c.spinning,size:"small",delay:300},{default:P(()=>[l("div",{class:N(["menu-button center",c.theme])},[l("div",{class:"main-content center clickable bgColor-select",onClick:a},[c.leftIcon?(d(),f("i",{key:0,class:N(t(c.leftIcon))},null,2)):A("",!0),l("div",hn,V(c.text),1)]),l("div",{class:"menu-handle center clickable bgColor-select",onClick:z(o,["stop"])},[...e[0]||(e[0]=[l("i",{class:"icon fas fa-angle-down"},null,-1)])])],2)]),_:1},8,["spinning"])])}}});const Ls=K(vn,[["__scopeId","data-v-88db428d"]]),gn=["id"],_n=O({__name:"index",props:{modelValue:{default:""},id:{default:()=>`editor-md-${Math.random().toString(36).substr(2,9)}`},mode:{default:"editor"},height:{default:"70vh"},taskToggle:{type:Boolean,default:!0},keyword:{default:""},editorPath:{default:""},toolbar:{default:()=>["undo","redo","|","bold","del","italic","quote","|","mindmap","plantuml","mermaid","tasklist","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","center","|","link","reference-link","image","video","code","code-block","table","datetime","html-entities","pagebreak","|","watch","fullscreen","clear","search","|","help"]},features:{default:()=>({})},theme:{default:()=>({})},upload:{default:()=>({})}},emits:["update:modelValue","change","load","task-toggle"],setup(n,{expose:c,emit:t}){const{t:o}=re(),a=n,i=t;let e=null;const r=E(a.id),b=E(""),$=E(""),p=E(!1),_=new Set,m=s=>new Promise((w,T)=>{if(_.has(s)){w();return}const k=document.createElement("script");k.src=s,k.onload=()=>{_.add(s),w()},k.onerror=()=>{T(new Error(`Failed to load ${s}`))},document.head.appendChild(k)}),h=s=>{if(!s||s.length===0)return"";let w=s;return w=w.replace(/&amp;/g,"&"),w=w.replace(/&lt;/g,"<"),w=w.replace(/&gt;/g,">"),w=w.replace(/&nbsp;/g," "),w=w.replace(/&#39;/g,"'"),w=w.replace(/&quot;/g,'"'),w},S=s=>{const w=document.createElement("a");return w.href=s,{source:s,protocol:w.protocol.replace(":",""),host:w.hostname,hostname:w.hostname,port:w.port,query:w.search,params:(()=>{const T={},k=w.search.replace(/^\?/,"").split("&");for(let x=0;x<k.length;x++)if(k[x]){const v=k[x].split("=");T[v[0]]=v[1]}return T})(),hash:w.hash.replace("#",""),path:w.pathname.replace(/^([^/])/,"/$1"),pathname:w.pathname.replace(/^([^/])/,"/$1")}},H=async()=>{const s=window.$,w=`${b.value}highlight/highlight.min.js?rand=2`;try{await m(w);const T=window.hljs;if(T&&T.highlightAll)try{T.highlightAll(),await new Promise(k=>setTimeout(k,100))}catch{}}catch{}if(s&&s.each)try{s(`#${r.value} table`).each(function(){const T=s(this);T.parent().hasClass("table-wrapper")||T.wrap('<div style="width: 100%; overflow-x: auto;"></div>')})}catch{}if(s&&s(`#${r.value} a[href^="http"]`).click(function(){const k=s(this).attr("href"),x=S(k),v=window.location;return(v.hostname===x.hostname||x.hostname==="www.showdoc.cc")&&v.pathname===x.pathname?(window.location.href=k,x.hash&&window.location.reload()):window.open(k,"_blank"),!1}),s&&s.each)try{s(`#${r.value} table tbody tr`).each(function(){const T=s(this),k=T.find("td"),x=k.eq(1).html()||"",v=k.eq(2).html()||"",g=x==="object"||x==="array[object]"||v==="object"||v==="array[object]";g?T.css({"background-color":"var(--editormd-table-alt-bg)"}):T.css("background-color","var(--editormd-table-row-bg)"),T.off("mouseenter mouseleave").hover(function(){T.css("background-color","var(--editormd-table-alt-bg)")},function(){g?T.css({"background-color":"var(--editormd-table-alt-bg)"}):T.css("background-color","var(--editormd-table-row-bg)")})})}catch{}if(s)try{const T=s(`#${r.value}`).width()||722;s(`#${r.value} table`).each(function(){const k=s(this),x=k.get(0);if(x&&x.rows&&x.rows.length>0){const v=x.rows.item(0);if(v){const g=v.cells.length,u=Math.floor(T/g)-2;g<=5&&k.find("th").css("width",u.toString()+"px")}}})}catch{}if(s){const T=s(`#${r.value}`);T.data("viewer")&&(T.data("viewer").destroy(),T.removeData("viewer"));const k=new nt(T.get(0),{url:"src",title:!1,toolbar:{zoomIn:1,zoomOut:1,oneToOne:1,reset:1,prev:1,play:!1,next:1,rotateLeft:1,rotateRight:1,flipHorizontal:1,flipVertical:1}});T.data("viewer",k)}if(a.keyword&&s&&s.fn&&s.fn.mark)try{const T=s(`#${r.value}`);T.unmark(),T.mark(a.keyword,{separateWordSearch:!0,caseSensitive:!1,accuracy:"partially",ignoreJoiners:!0})}catch{}if(s&&s.fn)try{s(`#${r.value} pre:has(> code)`).each(function(){const k=s(this);k.find(".code-copy-btn").length===0&&s(`<span class="code-copy-btn">${o("common.copy")}</span>`).prependTo(k)}),s(`#${r.value}`).off("click",".code-copy-btn").on("click",".code-copy-btn",async function(){const k=s(this),v=k.parent().find("> code").text().trim();await et(v)&&(k.text(o("common.copy_success")),setTimeout(()=>{k.text(o("common.copy"))},1500))})}catch{}if((a.mode==="html"||a.mode==="preview")&&s&&s.each){const T=s(`#${r.value}`),k=T.find('input[type="checkbox"]').filter(function(){return s(this).closest("pre, code, .editormd-code-block, .hljs").length===0});T.off("change.tasklist"),a.taskToggle?(k.each(function(x){const v=s(this);v.prop("disabled",!1),v.attr("data-task-index",x.toString())}),T.on("change.tasklist",'input[type="checkbox"]',function(){const x=s(this);if(x.closest("pre, code, .editormd-code-block, .hljs").length>0)return;const v=parseInt(x.attr("data-task-index")||"-1");if(isNaN(v))return;const g=x.is(":checked");i("task-toggle",{index:v,checked:g})})):k.prop("disabled",!0)}},C=async s=>{try{await Promise.all([m(`${s}jquery.min.js`),m(`${s}lib/raphael.min.js`)]),await Promise.all([m(`${s}lib/d3@5.min.js`),m(`${s}lib/flowchart.min.js?v=2`)]),await Promise.all([m(`${s}xss.min.js`),m(`${s}lib/marked.min.js`),m(`${s}lib/underscore.min.js`),m(`${s}lib/sequence-diagram.min.js`),m(`${s}lib/jquery.flowchart.min.js`),m(`${s}lib/jquery.mark.min.js`),m(`${s}lib/plantuml.js?v=2`),m(`${s}lib/view.min.js`),m(`${s}lib/transform.min.js`)]);const w=`${s}editormd.js?v=46`;if(await m(w),!window.editormd)throw new Error("editormd object not found after loading script")}catch(w){throw w}},L=async()=>{try{const s=await Ze();s&&($.value=s.user_token||"");const w=Qe();b.value=a.editorPath||`${w}editor.md/`,await C(b.value);const T=window.editormd;if(!T)return;const k=a.modelValue||"",x=a.mode==="editor"?k:k.replace(/\[TOC\]\s*/gi,""),v={path:`${b.value}lib/`,height:a.height,markdown:x,taskList:!0,atLink:!1,emailLink:!1,tex:!0,flowChart:!0,sequenceDiagram:!0,toc:!1,tocm:!1,tocDropdown:!1,syncScrolling:"single",htmlDecode:"style,script,iframe|filterXSS",imageUpload:!0,imageFormats:["jpg","jpeg","gif","png","bmp","webp","JPG","JPEG","GIF","PNG","BMP","WEBP"],toolbar:a.toolbar,toolbarIcons:()=>a.toolbar,toolbarIconsClass:{toc:"fa-bars ",mindmap:"fa-sitemap ",plantuml:"fa-random ",mermaid:"fa-pie-chart ",video:"fa-file-video-o",center:"fa-align-center",tasklist:"fa-check-square-o"},toolbarHandlers:{video:function(y,M,B,q){y.replaceSelection(`\r
<video src="http://your-site.com/your.mp4" style="width: 100%; height: 100%;" controls="controls"></video>\r
`),q===""&&y.setCursor(B.line,B.ch+1)},tasklist:function(y,M,B,q){const j=`## 任务清单
### 今日
- [ ] 整理站内消息与通知
- [ ] 跟进两条用户反馈
- [x] 合并并审核一个 PR

### 本周
- [ ] 完成文档目录整理与迁移
- [ ] 优化图片加载与懒加载策略

### 待办
- [ ] 编写部署与备份说明
- [ ] 补充接口错误码表
`;y.replaceSelection(j),q===""&&y.setCursor(B.line,B.ch+1)},mindmap:function(y,M,B,q){const j=`\`\`\`mindmap
# 一级
## 二级分支1
### 三级分支1
### 三级分支2
## 二级分支2
### 三级分支3
### 三级分支4
\`\`\``;y.replaceSelection(j),q===""&&y.setCursor(B.line,B.ch+1)},plantuml:function(y,M,B,q){const j="```plantuml\n@startuml\nactor 用户\n用户 -> 系统: 请求\n系统 --> 用户: 响应\n@enduml\n```";y.replaceSelection(j),q===""&&y.setCursor(B.line,B.ch+1)},mermaid:function(y,M,B,q){const j="```mermaid\ngraph LR\n    A[开始] --> B{判断}\n    B -->|是| C[执行]\n    B -->|否| D[结束]\n    C --> D\n```";y.replaceSelection(j),q===""&&y.setCursor(B.line,B.ch+1)},center:function(y,M,B,q){y.replaceSelection("<center>"+q+"</center>"),q===""&&y.setCursor(B.line,B.ch+1)}},lang:{toolbar:{mindmap:"插入思维导图",plantuml:"插入UML图",mermaid:"插入Mermaid图表",video:"插入视频",center:"居中",tasklist:"插入任务列表"}},onchange:()=>{if(e&&e.getMarkdown){const y=e.getMarkdown();i("update:modelValue",y),i("change",y)}H()},previewCodeHighlight:!1,katexURL:{css:"",js:""},onload:()=>{ne(()=>{ne(()=>{H()})})}},g=De();if(g.indexOf("?")>-1?v.imageUploadURL=`${g}/api/page/uploadImg&user_token=${$.value}`:v.imageUploadURL=`${g}/api/page/uploadImg?user_token=${$.value}`,v.katexURL={css:`${b.value}katex/katex.min`,js:`${b.value}katex/katex.min`},await ne(),!document.getElementById(r.value)){console.error(`[EditormdEditor] Editor element #${r.value} not found`);return}a.mode==="editor"?(p.value||(await m(`${b.value}lib/mermaid.min.js`),p.value=!0),e=T(r.value,v)):((a.modelValue||"").toLowerCase().indexOf("mermaid")>-1&&!p.value&&(await m(`${b.value}lib/mermaid.min.js`),p.value=!0),e=T.markdownToHTML(r.value,v),setTimeout(()=>{H()},50)),i("load",e)}catch{}};return Z(async()=>{try{await L()}catch{}}),ye(()=>{const s=window.$;if(s&&r.value){const w=s(`#${r.value}`);w.data("viewer")&&(w.data("viewer").destroy(),w.removeData("viewer"))}if(e){try{const w=document.getElementById(r.value);w&&(w.innerHTML="")}catch{}e=null}}),c({getMarkdown:()=>(e==null?void 0:e.getMarkdown())||"",insertValue:s=>{e&&e.insertValue(h(s))},editorUnwatch:()=>{var s;return(s=e==null?void 0:e.unwatch)==null?void 0:s.call(e)},editorWatch:()=>{var s;return(s=e==null?void 0:e.watch)==null?void 0:s.call(e)},setCursorToTop:()=>{var s;return(s=e==null?void 0:e.setCursor)==null?void 0:s.call(e,{line:0,ch:0})},clear:()=>{var s;return(s=e==null?void 0:e.clear)==null?void 0:s.call(e)},getSelection:()=>{var s;return((s=e==null?void 0:e.getSelection)==null?void 0:s.call(e))||""},setCursor:s=>{var w;return(w=e==null?void 0:e.setCursor)==null?void 0:w.call(e,s)},focus:()=>{e!=null&&e.focus?e.focus():e!=null&&e.cm&&e.cm.focus()},blur:()=>{var s;return(s=e==null?void 0:e.blur)==null?void 0:s.call(e)},preview:()=>{var s;return(s=e==null?void 0:e.previewing)==null?void 0:s.call(e)},fullscreen:()=>{var s;return(s=e==null?void 0:e.fullscreen)==null?void 0:s.call(e)},fullscreenExit:()=>{var s;return(s=e==null?void 0:e.fullscreenExit)==null?void 0:s.call(e)},getInstance:()=>e}),(s,w)=>(d(),f("div",{id:r.value,class:"main-editor"},null,8,gn))}});const yn=K(_n,[["__scopeId","data-v-e782ce85"]]),wn={syncScroll:!0,toc:!0,autoInsertToc:!0,fullscreen:!0,mermaid:!0,plantuml:!0,mindmap:!0,flowchart:!0,sequenceDiagram:!0,tex:!0,taskList:!0,codeHighlight:!0,imageUpload:!0,video:!0},kn=["undo","redo","|","bold","del","italic","quote","|","toc","mindmap","plantuml","mermaid","tasklist","h1","h2","h3","h4","h5","h6","|","list-ul","list-ol","hr","center","|","link","reference-link","image","video","code","code-block","table","datetime","html-entities","pagebreak","|","watch","fullscreen","clear","search","|","help"],bn={class:"editormd-editor-adapter showdoc"},$n={class:"editor-wrapper"},Cn=O({__name:"ShowdocAdapter",props:{modelValue:{default:""},id:{default:()=>`editor-md-${Math.random().toString(36).substr(2,9)}`},mode:{default:"editor"},height:{default:"70vh"},taskToggle:{type:Boolean,default:!0},keyword:{default:""},editorPath:{default:""},features:{default:()=>({})},theme:{default:()=>({editor:"light",preview:"light"})},toolbar:{default:()=>kn},upload:{}},emits:["update:modelValue","change","input","load","task-toggle"],setup(n,{expose:c,emit:t}){const o=n,a=t,i=E(),e=E(o.modelValue),r=D(()=>o.id),b=D(()=>({...wn,autoInsertToc:!0,...o.features})),$=D(()=>{const u=document.documentElement.getAttribute("data-theme")==="dark";return{editor:u?"dark":"light",preview:u?"dark":"light",...o.theme}}),p=u=>{a("load",u)},_=u=>{a("update:modelValue",u),a("change",u),a("input",u)},m=u=>{a("task-toggle",u)};return se(()=>o.modelValue,u=>{u!==e.value&&(e.value=u)}),se(()=>document.documentElement.getAttribute("data-theme"),u=>{console.log("Theme changed to:",u==="dark"?"dark":"light")}),c({getValue:()=>{var u;return((u=i.value)==null?void 0:u.getMarkdown())||""},setValue:u=>{var y;(y=i.value)==null||y.setValue(u)},insertValue:u=>{var y;(y=i.value)==null||y.insertValue(u)},getSelection:()=>{var u;return((u=i.value)==null?void 0:u.getSelection())||""},clear:()=>{var u;(u=i.value)==null||u.clear()},setCursor:u=>{var y;(y=i.value)==null||y.setCursor(u)},focus:()=>{var y;const u=(y=i.value)==null?void 0:y.getInstance();u!=null&&u.editor&&u.editor.focus()},blur:()=>{console.log("Editormd blur not implemented")},preview:()=>{var u;return(u=i.value)==null?void 0:u.preview()},unwatch:()=>{var u;return(u=i.value)==null?void 0:u.unwatch()},watch:()=>{var u;return(u=i.value)==null?void 0:u.watch()},getInstance:()=>{var u;return(u=i.value)==null?void 0:u.getInstance()}}),(u,y)=>(d(),f("div",bn,[l("div",$n,[U(yn,{ref_key:"editormdEditorRef",ref:i,modelValue:e.value,"onUpdate:modelValue":y[0]||(y[0]=M=>e.value=M),id:r.value,mode:n.mode,height:n.height,taskToggle:n.taskToggle,keyword:n.keyword,editorPath:n.editorPath,features:b.value,theme:$.value,toolbar:n.toolbar,upload:u.uploadConfig,onLoad:p,onChange:_,onTaskToggle:m},null,8,["modelValue","id","mode","height","taskToggle","keyword","editorPath","features","theme","toolbar","upload"])])]))}});const Es=K(Cn,[["__scopeId","data-v-18a0855e"]]),xn=["placeholder","disabled","rows"],Tn=O({__name:"CommonTextarea",props:{modelValue:{},placeholder:{default:""},disabled:{type:Boolean,default:!1},rows:{default:5}},emits:["update:modelValue"],setup(n,{expose:c,emit:t}){const o=n,a=t,i=E("");Ue(()=>{i.value=o.modelValue});function e(s){const w=s.target;a("update:modelValue",w.value)}const r=E(!0);function b(){r.value=!0}function $(){r.value=!1}const p=E(!1),_=E("top: 0px; left: 0px;");let m;function h(s){clearTimeout(m),m=setTimeout(()=>{p.value=!0},300)}function S(s){_.value=`top: ${s.offsetY}px; left: ${s.offsetX}px;`}function H(s){clearTimeout(m),p.value=!1}const C=E();function L(){ne(()=>{var w,T;const s=o.modelValue.length;(w=C.value)==null||w.focus(),(T=C.value)==null||T.setSelectionRange(s,s)})}return c({focusAtLast:L}),(s,w)=>(d(),f("div",{class:"common-textarea",style:Y({minHeight:`${o.rows*20+26}px`})},[ce(l("textarea",{ref_key:"textareaRef",ref:C,placeholder:o.placeholder,disabled:o.disabled,rows:o.rows,onInput:e,onFocus:b,onBlur:$,onMouseenter:h,onMousemove:S,onMouseout:H,"onUpdate:modelValue":w[0]||(w[0]=T=>i.value=T)},null,40,xn),[[Ae,i.value]]),ce(l("div",{class:"common-textarea-tooltips",style:Y(_.value)}," 点击编辑 ",4),[[_e,p.value&&!r.value]])],4))}});const Vs=K(Tn,[["__scopeId","data-v-f5b2d512"]]),Sn={class:"tab-header"},Mn={class:"tab-container"},In=["onClick"],Ln={class:"tab-content"},En={key:0,class:"tab-icon"},Vn={class:"tab-text"},Hn={class:"tab-content-wrapper"},Bn=O({__name:"CommonTab",props:{items:{},value:{},type:{default:"segmented"},disabled:{type:Boolean,default:!1}},emits:["updateValue","change"],setup(n,{expose:c,emit:t}){const o=n,a=t,i=D({get:()=>o.value,set:p=>a("updateValue",p)}),e=Re();D(()=>e.default?Object.keys(e).some(p=>p!=="default"):!1),c({setActive:p=>{a("updateValue",p)}});const b=p=>{o.disabled||p.disabled||(a("updateValue",p.value),a("change",p))};function $(p){if(Array.isArray(p)){const _=p[0],m=p[1];return m.startsWith("fa-")?`${_} ${m}`:`${_} fa-${m}`}return p}return(p,_)=>(d(),f("div",{class:N(["common-tab",[`type-${n.type}`,{disabled:n.disabled}]])},[l("div",Sn,[l("div",Mn,[(d(!0),f(W,null,G(n.items,(m,h)=>(d(),f("div",{key:m.value,class:N(["tab-item",{active:i.value===m.value,disabled:m.disabled}]),onClick:S=>b(m)},[l("div",Ln,[m.icon?(d(),f("div",En,[l("i",{class:N($(m.icon))},null,2)])):A("",!0),l("div",Vn,V(m.text),1)])],10,In))),128))])]),l("div",Hn,[F(p.$slots,"default",{},void 0,!0),(d(!0),f(W,null,G(n.items,m=>(d(),f(W,{key:m.value},[i.value===m.value?F(p.$slots,String(m.value),{key:0},void 0,!0):A("",!0)],64))),128))])],2))}});const Hs=K(Bn,[["__scopeId","data-v-4403fa5e"]]),An={key:0,class:"toc-container"},Rn={class:"toc-header"},Nn={class:"toc-content"},jn=["onClick"],Dn={key:0,class:"toc-empty"},qn={key:1,class:"toc-loading"},On=O({__name:"Toc",setup(n){const c=E(!1),t=E(""),o=E([]),a=E(!0),i=()=>{a.value=!0;const p=[".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6",".editormd-preview h1, .editormd-preview h2, .editormd-preview h3, .editormd-preview h4, .editormd-preview h5, .editormd-preview h6",".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6","#page-content-main h1, #page-content-main h2, #page-content-main h3, #page-content-main h4, #page-content-main h5, #page-content-main h6"];let _=null;for(const m of p)if(_=document.querySelectorAll(m),_.length>0)break;if((!_||_.length===0)&&(_=document.querySelectorAll(".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6")),o.value=[],_.forEach(m=>{let h=m.getAttribute("id");h||(h=`heading-${m.tagName.charAt(1)}-${Math.random().toString(36).substr(2,9)}`,m.setAttribute("id",h));const S=m.textContent||"",H=parseInt(m.tagName.charAt(1));h&&S&&o.value.push({id:h,text:S,level:H})}),a.value=!1,o.value.length>0&&(c.value=!0),o.value.length===0){const m=[document.querySelector(".vditor-reset"),document.querySelector(".vditor-preview"),document.querySelector("#page-content-main")];for(const h of m)if(h&&h.innerHTML.trim())break}},e=p=>{const _=document.getElementById(p);if(_){const S=_.getBoundingClientRect().top+window.pageYOffset-120;window.scrollTo({top:S,behavior:"smooth"})}},r=()=>{c.value=!c.value},b=()=>{const p=[".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6",".editormd-preview h1, .editormd-preview h2, .editormd-preview h3, .editormd-preview h4, .editormd-preview h5, .editormd-preview h6",".markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4, .markdown-body h5, .markdown-body h6",".vditor-reset h1, .vditor-reset h2, .vditor-reset h3, .vditor-reset h4, .vditor-reset h5, .vditor-reset h6",".vditor-preview h1, .vditor-preview h2, .vditor-preview h3, .vditor-preview h4, .vditor-preview h5, .vditor-preview h6","#page-content-main h1, #page-content-main h2, #page-content-main h3, #page-content-main h4, #page-content-main h5, #page-content-main h6"];let _=null;for(const S of p)if(_=document.querySelectorAll(S),_.length>0)break;(!_||_.length===0)&&(_=document.querySelectorAll(".editormd-preview-container h1, .editormd-preview-container h2, .editormd-preview-container h3, .editormd-preview-container h4, .editormd-preview-container h5, .editormd-preview-container h6"));const m=window.pageYOffset+150;let h=null;_.forEach(S=>{S.getBoundingClientRect().top+window.pageYOffset<=m&&(h=S)}),h&&(t.value=h.getAttribute("id")||"")};let $=null;return Z(()=>{const p=_=>{setTimeout(()=>{i()},_)};p(500),p(1e3),p(1500),p(2e3),p(3e3),window.addEventListener("scroll",b,{passive:!0}),$=new MutationObserver(()=>{setTimeout(()=>{i()},300)}),setTimeout(()=>{const _=[".editormd-preview-container",".editormd-preview",".markdown-body",".vditor-reset",".vditor-preview","#page-content-main"];let m=null;for(const h of _)if(m=document.querySelector(h),m&&m.innerHTML.trim())break;m&&$?$.observe(m,{childList:!0,subtree:!0}):setTimeout(()=>{for(const h of _)if(m=document.querySelector(h),m&&m.innerHTML.trim())break;m&&$&&$.observe(m,{childList:!0,subtree:!0})},1e3)},500),setTimeout(()=>{const _=[".editormd-preview-container",".editormd-preview",".markdown-body",".vditor-reset",".vditor-preview","#page-content-main"];let m=null;for(const h of _)if(m=document.querySelector(h),m)break;m&&m.querySelectorAll("img").forEach(S=>{const H=S;H.complete?i():H.addEventListener("load",i)})},800)}),ye(()=>{window.removeEventListener("scroll",b),$&&$.disconnect()}),(p,_)=>{const m=X("a-spin");return o.value.length>0||a.value?(d(),f("div",An,[l("div",{class:"toc-toggle",onClick:r},[..._[0]||(_[0]=[l("i",{class:"fas fa-list"},null,-1)])]),l("div",{class:N(["toc-list",{"is-open":c.value}])},[l("div",Rn,[l("span",null,V(p.$t("page.catalog")),1),l("i",{class:"fas fa-times",onClick:r})]),l("div",Nn,[(d(!0),f(W,null,G(o.value,(h,S)=>(d(),f("div",{key:S,class:N(["toc-item",`toc-level-${h.level}`,{"is-active":t.value===h.id}]),onClick:H=>e(h.id)},[l("span",null,V(h.text),1)],10,jn))),128)),o.value.length===0&&!a.value?(d(),f("div",Dn,V(p.$t("page.no_catalog")),1)):A("",!0),a.value?(d(),f("div",qn,[U(m,{size:"small"})])):A("",!0)])],2)])):A("",!0)}}});const Bs=K(On,[["__scopeId","data-v-dd6166ab"]]),Kn={key:0,class:"search-breadcrumb"},Pn={class:"search-label"},Wn={class:"search-keyword"},zn=O({__name:"SearchBreadcrumb",props:{keyword:{default:""},pageInfo:{default:()=>({})},itemInfo:{default:()=>({})}},setup(n){return(c,t)=>{const o=X("router-link"),a=X("a-breadcrumb-item"),i=X("a-breadcrumb");return n.keyword?(d(),f("div",Kn,[U(i,null,{default:P(()=>[U(a,null,{default:P(()=>{var e,r;return[U(o,{to:`/${((e=n.itemInfo)==null?void 0:e.item_domain)||((r=n.itemInfo)==null?void 0:r.item_id)}`},{default:P(()=>{var b;return[ae(V((b=n.itemInfo)==null?void 0:b.item_name),1)]}),_:1},8,["to"])]}),_:1}),U(a,null,{default:P(()=>[l("span",Pn,V(c.$t("search")),1),l("span",Wn,'"'+V(n.keyword)+'"',1)]),_:1}),n.pageInfo&&n.pageInfo.full_path&&n.pageInfo.full_path.length>0?(d(!0),f(W,{key:0},G(n.pageInfo.full_path,(e,r)=>(d(),ee(a,{key:r},{default:P(()=>[e.cat_name?(d(),f(W,{key:0},[ae(V(e.cat_name),1)],64)):e.page_title?(d(),f(W,{key:1},[ae(V(e.page_title),1)],64)):A("",!0)]),_:2},1024))),128)):A("",!0),n.pageInfo&&n.pageInfo.page_title&&(!n.pageInfo.full_path||n.pageInfo.full_path.length===0)?(d(),ee(a,{key:1,class:"current-page"},{default:P(()=>[ae(V(n.pageInfo.page_title),1)]),_:1})):A("",!0)]),_:1})])):A("",!0)}}});const As=K(zn,[["__scopeId","data-v-f6037437"]]),Un=["title"],Fn={key:1,class:"chat-window"},Gn={class:"chat-header"},Yn={class:"header-title"},Jn={class:"header-actions"},Xn=["title"],Zn=["title"],Qn={class:"chat-container"},es={class:"message-avatar"},ts={class:"message-content"},os=["innerHTML"],ns={key:0,class:"message-sources"},ss=["onClick"],as={class:"relevance"},ls={key:0,class:"message assistant"},is={class:"input-area"},rs={class:"input-actions"},cs=O({__name:"AiChatDialog",props:{itemId:{},itemName:{default:""}},setup(n,{emit:c}){const t=n,{t:o}=re(),a=Ne(),i=je(),e=E(!1),r=E(!1),b=E([]),$=E(""),p=E(!1),_=E(null),m=E(null),h=E({dialog_collapsed:!0,welcome_message:""}),S=E(null),H=E(!1),C=D(()=>(t.itemName||o("item.project"))+" - "+o("ai.ai_chat_assistant")),L=D(()=>H.value?100:40),s=()=>{const I=window.pageYOffset||document.documentElement.scrollTop,R=H.value;H.value=I>100,!R&&H.value&&setTimeout(()=>{j()},300)},w=async()=>{try{const I=await tt("/api/item/getAiKnowledgeBaseConfig",{item_id:t.itemId});I.error_code===0&&I.data?(h.value=I.data,I.data.enabled?(e.value=!0,r.value=!!h.value.dialog_collapsed,r.value||x()):e.value=!1):e.value=!1}catch{e.value=!1}},T=()=>{r.value=!r.value,!r.value&&b.value.length===0&&x(),r.value||setTimeout(()=>{j()},100)},k=()=>{le(),r.value=!0},x=()=>{b.value=[];const I=h.value.welcome_message||o("ai.ai_welcome_message_default");I&&b.value.push({role:"assistant",content:I,sources:[]}),setTimeout(()=>{j()},100)},v=I=>{(I.ctrlKey||I.metaKey)&&I.key==="Enter"&&(I.preventDefault(),g())},g=async()=>{if(!$.value.trim()||p.value)return;const I=$.value.trim();$.value="",b.value.push({role:"user",content:I,sources:[]});const R={role:"assistant",content:"",sources:[]};b.value.push(R),p.value=!0,j();try{await u(I,R)}catch{R.content=o("ai.ai_error_message"),Fe.error(o("ai.ai_error_message"))}finally{p.value=!1,j()}},u=(I,R)=>new Promise(async(oe,J)=>{try{le(),m.value=new AbortController;const ie={item_id:t.itemId,question:I,stream:1};_.value&&(ie.conversation_id=_.value),i.userToken&&(ie.user_token=i.userToken);const we=De()+"/api/ai/chat",ue=await fetch(we,{method:"POST",headers:{"Content-Type":"application/json",Accept:"text/event-stream","Cache-Control":"no-cache"},body:JSON.stringify(ie),signal:m.value.signal});if(!ue.ok)throw new Error(`HTTP ${ue.status}: ${ue.statusText}`);const Oe=ue.body.getReader(),Ke=new TextDecoder("utf-8");let ke="";const Me=async()=>{try{const{value:be,done:Pe}=await Oe.read();if(Pe){oe();return}const We=Ke.decode(be,{stream:!0});ke+=We;const Ie=ke.split(`

`);ke=Ie.pop()||"";for(const Le of Ie){if(!Le.trim())continue;const Ee=Le.match(/^data: (.+)$/m);if(!Ee)continue;const Ve=Ee[1].trim();if(Ve)try{const Q=JSON.parse(Ve);if(Q.type==="token")R.content+=Q.content||"",j();else if(Q.type==="sources")R.sources=Q.sources||[];else if(Q.type==="done"){Q.conversation_id&&(_.value=Q.conversation_id),oe();return}else if(Q.type==="error"){R.content=Q.message||o("ai.ai_error_message"),J(new Error(Q.message||o("ai.ai_service_error")));return}}catch{}}await Me()}catch(be){R.content===""&&(R.content=o("ai.ai_error_message")),J(be)}};await Me()}catch(ie){R.content===""&&(R.content=o("ai.ai_error_message")),J(ie)}}),y=I=>I?I.replace(/```(\w*)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/^#\s+(.*)$/gm,"<h1>$1</h1>").replace(/^##\s+(.*)$/gm,"<h2>$1</h2>").replace(/^###\s+(.*)$/gm,"<h3>$1</h3>").replace(/^####\s+(.*)$/gm,"<h4>$1</h4>").replace(/^#####\s+(.*)$/gm,"<h5>$1</h5>").replace(/^######\s+(.*)$/gm,"<h6>$1</h6>").replace(/\n/g,"<br>"):"",M=I=>{if(!I)return"";const R=Math.round(I*5);return"★".repeat(R)+"☆".repeat(5-R)},B=I=>{if(I.page_id&&t.itemId){const R=a.resolve({name:"ItemShowPage",params:{item_id:t.itemId,page_id:I.page_id}});window.open(R.href,"_blank")}},q=()=>{b.value=[],_.value=null,x()},j=()=>{setTimeout(()=>{const I=S.value;I&&(I.scrollTop=I.scrollHeight)},100)},le=()=>{m.value&&(m.value.abort(),m.value=null)};return se(()=>t.itemId,I=>{I&&w()}),Z(()=>{t.itemId&&w(),window.addEventListener("scroll",s)}),me(()=>{le(),window.removeEventListener("scroll",s)}),(I,R)=>{const oe=X("a-textarea");return e.value?(d(),f("div",{key:0,class:N(["ai-chat-widget",{collapsed:r.value}]),style:Y({bottom:`${L.value}px`})},[r.value?(d(),f("div",{key:0,class:"chat-button",onClick:T,title:I.$t("ai.ai_assistant_tooltip")},[...R[1]||(R[1]=[l("i",{class:"far fa-question-circle"},null,-1)])],8,Un)):(d(),f("div",Fn,[l("div",Gn,[l("div",Yn,[R[2]||(R[2]=l("i",{class:"far fa-question-circle"},null,-1)),l("span",null,V(C.value),1)]),l("div",Jn,[l("i",{class:"fas fa-minus",onClick:T,title:I.$t("common.minimize")},null,8,Xn),l("i",{class:"fas fa-times",onClick:k,title:I.$t("common.close")},null,8,Zn)])]),l("div",Qn,[l("div",{class:"messages",ref_key:"messagesContainer",ref:S},[(d(!0),f(W,null,G(b.value,(J,ie)=>(d(),f("div",{key:ie,class:N(["message",J.role])},[l("div",es,[l("i",{class:N(J.role==="user"?"fas fa-user":"fas fa-comments")},null,2)]),l("div",ts,[l("div",{class:"message-text",innerHTML:y(J.content)},null,8,os),J.sources&&J.sources.length>0?(d(),f("div",ns,[(d(!0),f(W,null,G(J.sources,(he,we)=>(d(),f("div",{key:we,class:"source-item",onClick:ue=>B(he)},[R[3]||(R[3]=l("i",{class:"fas fa-file-alt"},null,-1)),l("span",null,V(he.page_title),1),l("span",as,V(I.$t("ai.ai_relevance"))+": "+V(M(he.relevance)),1),R[4]||(R[4]=l("i",{class:"fas fa-external-link-alt"},null,-1))],8,ss))),128))])):A("",!0)])],2))),128)),p.value?(d(),f("div",ls,[...R[5]||(R[5]=[l("div",{class:"message-avatar"},[l("i",{class:"far fa-question-circle"})],-1),l("div",{class:"message-content"},[l("div",{class:"typing-indicator"},[l("span"),l("span"),l("span")])],-1)])])):A("",!0)],512),l("div",is,[U(oe,{value:$.value,"onUpdate:value":R[0]||(R[0]=J=>$.value=J),rows:3,placeholder:I.$t("ai.ai_input_placeholder"),onKeydown:v,"auto-size":{minRows:3,maxRows:6}},null,8,["value","placeholder"]),l("div",rs,[U(He,{theme:"dark",spinning:p.value,onClick:g,disabled:!$.value.trim()},{default:P(()=>[ae(V(I.$t("common.send")),1)]),_:1},8,["spinning","disabled"]),U(He,{theme:"light",onClick:q},{default:P(()=>[ae(V(I.$t("ai.ai_clear_history")),1)]),_:1})])])])]))],6)):A("",!0)}}});const Rs=K(cs,[["__scopeId","data-v-db888bb5"]]);export{fs as A,ps as C,Es as E,vs as L,ys as M,ws as P,$s as S,hs as T,K as _,gs as a,He as b,Bt as c,Se as d,ks as e,bs as f,Cs as g,xs as h,Ts as i,Ss as j,Ms as k,Vs as l,Hs as m,Ls as n,Is as o,Bs as p,qe as q,As as r,Rs as s,_s as t};
